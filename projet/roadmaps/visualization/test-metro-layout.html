<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test du Moteur de Layout Automatique pour Carte de Métro</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    
    h1 {
      color: #2c3e50;
      margin-bottom: 20px;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 15px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
      min-width: 200px;
    }
    
    label {
      font-weight: 600;
      font-size: 14px;
    }
    
    select, input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    button {
      padding: 8px 16px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: #2980b9;
    }
    
    .visualization {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 20px;
      height: 600px;
      position: relative;
    }
    
    #metro-map {
      width: 100%;
      height: 100%;
      overflow: hidden;
      position: relative;
    }
    
    .station {
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: white;
      border: 3px solid #333;
      transform: translate(-50%, -50%);
      z-index: 10;
      transition: all 0.3s ease;
    }
    
    .station.junction {
      width: 24px;
      height: 24px;
      background-color: #f8f8f8;
    }
    
    .station-label {
      position: absolute;
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
      transform: translate(-50%, 15px);
      text-align: center;
    }
    
    .line {
      position: absolute;
      height: 6px;
      transform-origin: 0 0;
      z-index: 5;
    }
    
    .debug-info {
      margin-top: 20px;
      padding: 15px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      font-family: monospace;
      white-space: pre-wrap;
      font-size: 14px;
      max-height: 300px;
      overflow: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Test du Moteur de Layout Automatique pour Carte de Métro</h1>
    
    <div class="controls">
      <div class="control-group">
        <label for="algorithm">Algorithme de layout:</label>
        <select id="algorithm">
          <option value="metro" selected>Metro (personnalisé)</option>
          <option value="dagre">Dagre</option>
          <option value="cose-bilkent">Cose-Bilkent</option>
          <option value="klay">Klay</option>
        </select>
      </div>
      
      <div class="control-group">
        <label for="direction">Direction préférée:</label>
        <select id="direction">
          <option value="horizontal" selected>Horizontale</option>
          <option value="vertical">Verticale</option>
        </select>
      </div>
      
      <div class="control-group">
        <label for="node-separation">Séparation des nœuds:</label>
        <input type="range" id="node-separation" min="20" max="100" value="50" step="5">
        <span id="node-separation-value">50</span>
      </div>
      
      <div class="control-group">
        <label for="rank-separation">Séparation des rangs:</label>
        <input type="range" id="rank-separation" min="50" max="200" value="100" step="10">
        <span id="rank-separation-value">100</span>
      </div>
      
      <div class="control-group">
        <label for="test-graph">Graphe de test:</label>
        <select id="test-graph">
          <option value="simple" selected>Simple (ligne unique)</option>
          <option value="fork">Bifurcation</option>
          <option value="loop">Boucle</option>
          <option value="multi">Multi-lignes</option>
          <option value="complex">Complexe</option>
        </select>
      </div>
      
      <button id="apply-layout">Appliquer le layout</button>
    </div>
    
    <div class="visualization">
      <div id="metro-map"></div>
    </div>
    
    <div class="debug-info" id="debug-info"></div>
  </div>
  
  <!-- Importation du moteur de layout -->
  <script type="module">
    import MetroMapLayoutEngine from './MetroMapLayoutEngine.js';
    
    // Graphes de test
    const testGraphs = {
      // Ligne simple
      simple: {
        nodes: [
          { id: 'A', name: 'Station A', lines: ['L1'] },
          { id: 'B', name: 'Station B', lines: ['L1'] },
          { id: 'C', name: 'Station C', lines: ['L1'] },
          { id: 'D', name: 'Station D', lines: ['L1'] },
          { id: 'E', name: 'Station E', lines: ['L1'] }
        ],
        edges: [
          { source: 'A', target: 'B', line: 'L1' },
          { source: 'B', target: 'C', line: 'L1' },
          { source: 'C', target: 'D', line: 'L1' },
          { source: 'D', target: 'E', line: 'L1' }
        ],
        lines: [
          { id: 'L1', name: 'Ligne 1', color: '#FF6B6B' }
        ]
      },
      
      // Bifurcation
      fork: {
        nodes: [
          { id: 'A', name: 'Station A', lines: ['L1'] },
          { id: 'B', name: 'Station B', lines: ['L1'] },
          { id: 'C', name: 'Station C', lines: ['L1', 'L2'] },
          { id: 'D', name: 'Station D', lines: ['L1'] },
          { id: 'E', name: 'Station E', lines: ['L1'] },
          { id: 'F', name: 'Station F', lines: ['L2'] },
          { id: 'G', name: 'Station G', lines: ['L2'] }
        ],
        edges: [
          { source: 'A', target: 'B', line: 'L1' },
          { source: 'B', target: 'C', line: 'L1' },
          { source: 'C', target: 'D', line: 'L1' },
          { source: 'D', target: 'E', line: 'L1' },
          { source: 'C', target: 'F', line: 'L2' },
          { source: 'F', target: 'G', line: 'L2' }
        ],
        lines: [
          { id: 'L1', name: 'Ligne 1', color: '#FF6B6B' },
          { id: 'L2', name: 'Ligne 2', color: '#4ECDC4' }
        ]
      },
      
      // Boucle
      loop: {
        nodes: [
          { id: 'A', name: 'Station A', lines: ['L1'] },
          { id: 'B', name: 'Station B', lines: ['L1'] },
          { id: 'C', name: 'Station C', lines: ['L1'] },
          { id: 'D', name: 'Station D', lines: ['L1'] },
          { id: 'E', name: 'Station E', lines: ['L1'] },
          { id: 'F', name: 'Station F', lines: ['L1'] }
        ],
        edges: [
          { source: 'A', target: 'B', line: 'L1' },
          { source: 'B', target: 'C', line: 'L1' },
          { source: 'C', target: 'D', line: 'L1' },
          { source: 'D', target: 'E', line: 'L1' },
          { source: 'E', target: 'F', line: 'L1' },
          { source: 'F', target: 'A', line: 'L1' }
        ],
        lines: [
          { id: 'L1', name: 'Ligne 1', color: '#FF6B6B' }
        ]
      },
      
      // Multi-lignes
      multi: {
        nodes: [
          { id: 'A', name: 'Station A', lines: ['L1'] },
          { id: 'B', name: 'Station B', lines: ['L1', 'L2'] },
          { id: 'C', name: 'Station C', lines: ['L1', 'L3'] },
          { id: 'D', name: 'Station D', lines: ['L1'] },
          { id: 'E', name: 'Station E', lines: ['L2'] },
          { id: 'F', name: 'Station F', lines: ['L2', 'L3'] },
          { id: 'G', name: 'Station G', lines: ['L3'] },
          { id: 'H', name: 'Station H', lines: ['L3'] }
        ],
        edges: [
          { source: 'A', target: 'B', line: 'L1' },
          { source: 'B', target: 'C', line: 'L1' },
          { source: 'C', target: 'D', line: 'L1' },
          { source: 'E', target: 'B', line: 'L2' },
          { source: 'B', target: 'F', line: 'L2' },
          { source: 'G', target: 'C', line: 'L3' },
          { source: 'C', target: 'F', line: 'L3' },
          { source: 'F', target: 'H', line: 'L3' }
        ],
        lines: [
          { id: 'L1', name: 'Ligne 1', color: '#FF6B6B' },
          { id: 'L2', name: 'Ligne 2', color: '#4ECDC4' },
          { id: 'L3', name: 'Ligne 3', color: '#F9C74F' }
        ]
      },
      
      // Complexe
      complex: {
        nodes: [
          { id: 'A', name: 'Station A', lines: ['L1'] },
          { id: 'B', name: 'Station B', lines: ['L1', 'L2'] },
          { id: 'C', name: 'Station C', lines: ['L1', 'L3'] },
          { id: 'D', name: 'Station D', lines: ['L1', 'L4'] },
          { id: 'E', name: 'Station E', lines: ['L1'] },
          { id: 'F', name: 'Station F', lines: ['L2'] },
          { id: 'G', name: 'Station G', lines: ['L2', 'L5'] },
          { id: 'H', name: 'Station H', lines: ['L2'] },
          { id: 'I', name: 'Station I', lines: ['L3'] },
          { id: 'J', name: 'Station J', lines: ['L3', 'L5'] },
          { id: 'K', name: 'Station K', lines: ['L3'] },
          { id: 'L', name: 'Station L', lines: ['L4'] },
          { id: 'M', name: 'Station M', lines: ['L4', 'L5'] },
          { id: 'N', name: 'Station N', lines: ['L4'] },
          { id: 'O', name: 'Station O', lines: ['L5'] },
          { id: 'P', name: 'Station P', lines: ['L5'] }
        ],
        edges: [
          { source: 'A', target: 'B', line: 'L1' },
          { source: 'B', target: 'C', line: 'L1' },
          { source: 'C', target: 'D', line: 'L1' },
          { source: 'D', target: 'E', line: 'L1' },
          { source: 'F', target: 'B', line: 'L2' },
          { source: 'B', target: 'G', line: 'L2' },
          { source: 'G', target: 'H', line: 'L2' },
          { source: 'I', target: 'C', line: 'L3' },
          { source: 'C', target: 'J', line: 'L3' },
          { source: 'J', target: 'K', line: 'L3' },
          { source: 'L', target: 'D', line: 'L4' },
          { source: 'D', target: 'M', line: 'L4' },
          { source: 'M', target: 'N', line: 'L4' },
          { source: 'O', target: 'G', line: 'L5' },
          { source: 'G', target: 'J', line: 'L5' },
          { source: 'J', target: 'M', line: 'L5' },
          { source: 'M', target: 'P', line: 'L5' }
        ],
        lines: [
          { id: 'L1', name: 'Ligne 1', color: '#FF6B6B' },
          { id: 'L2', name: 'Ligne 2', color: '#4ECDC4' },
          { id: 'L3', name: 'Ligne 3', color: '#F9C74F' },
          { id: 'L4', name: 'Ligne 4', color: '#90BE6D' },
          { id: 'L5', name: 'Ligne 5', color: '#577590' }
        ]
      }
    };
    
    // Éléments DOM
    const algorithmSelect = document.getElementById('algorithm');
    const directionSelect = document.getElementById('direction');
    const nodeSeparationInput = document.getElementById('node-separation');
    const nodeSeparationValue = document.getElementById('node-separation-value');
    const rankSeparationInput = document.getElementById('rank-separation');
    const rankSeparationValue = document.getElementById('rank-separation-value');
    const testGraphSelect = document.getElementById('test-graph');
    const applyLayoutButton = document.getElementById('apply-layout');
    const metroMapContainer = document.getElementById('metro-map');
    const debugInfo = document.getElementById('debug-info');
    
    // Mettre à jour les valeurs affichées
    nodeSeparationInput.addEventListener('input', () => {
      nodeSeparationValue.textContent = nodeSeparationInput.value;
    });
    
    rankSeparationInput.addEventListener('input', () => {
      rankSeparationValue.textContent = rankSeparationInput.value;
    });
    
    // Appliquer le layout
    applyLayoutButton.addEventListener('click', applyLayout);
    
    // Fonction pour appliquer le layout
    function applyLayout() {
      // Récupérer les options
      const options = {
        layoutAlgorithm: algorithmSelect.value,
        preferredDirection: directionSelect.value,
        nodeSeparation: parseInt(nodeSeparationInput.value),
        rankSeparation: parseInt(rankSeparationInput.value)
      };
      
      // Récupérer le graphe de test
      const graph = testGraphs[testGraphSelect.value];
      
      // Créer le moteur de layout
      const layoutEngine = new MetroMapLayoutEngine(options);
      
      // Appliquer le layout
      const result = layoutEngine.applyLayout(graph);
      
      // Afficher le résultat
      renderMetroMap(result, graph.lines);
      
      // Afficher les informations de débogage
      debugInfo.textContent = JSON.stringify(result, null, 2);
    }
    
    // Fonction pour rendre la carte de métro
    function renderMetroMap(layoutResult, lines) {
      // Vider le conteneur
      metroMapContainer.innerHTML = '';
      
      // Créer un dictionnaire des lignes par ID
      const linesById = {};
      lines.forEach(line => {
        linesById[line.id] = line;
      });
      
      // Dessiner les lignes
      layoutResult.edges.forEach(edge => {
        const line = linesById[edge.line];
        if (!line) return;
        
        // Créer un élément pour la ligne
        const lineElement = document.createElement('div');
        lineElement.className = 'line';
        lineElement.style.backgroundColor = line.color;
        
        // Calculer la position et la rotation
        const sourceX = edge.sourcePoint.x;
        const sourceY = edge.sourcePoint.y;
        const targetX = edge.targetPoint.x;
        const targetY = edge.targetPoint.y;
        
        const dx = targetX - sourceX;
        const dy = targetY - sourceY;
        const length = Math.sqrt(dx * dx + dy * dy);
        const angle = Math.atan2(dy, dx) * 180 / Math.PI;
        
        lineElement.style.width = `${length}px`;
        lineElement.style.left = `${sourceX}px`;
        lineElement.style.top = `${sourceY}px`;
        lineElement.style.transform = `rotate(${angle}deg)`;
        
        metroMapContainer.appendChild(lineElement);
      });
      
      // Dessiner les stations
      layoutResult.nodes.forEach(node => {
        // Créer un élément pour la station
        const stationElement = document.createElement('div');
        stationElement.className = 'station';
        if (node.isJunction) {
          stationElement.classList.add('junction');
        }
        
        // Définir la position
        stationElement.style.left = `${node.position.x}px`;
        stationElement.style.top = `${node.position.y}px`;
        
        // Définir la couleur de la bordure
        if (node.lines && node.lines.length > 0) {
          const line = linesById[node.lines[0]];
          if (line) {
            stationElement.style.borderColor = line.color;
          }
        }
        
        // Créer un élément pour le label
        const labelElement = document.createElement('div');
        labelElement.className = 'station-label';
        labelElement.textContent = node.name;
        labelElement.style.left = `${node.position.x}px`;
        labelElement.style.top = `${node.position.y}px`;
        
        metroMapContainer.appendChild(stationElement);
        metroMapContainer.appendChild(labelElement);
      });
    }
    
    // Appliquer le layout initial
    applyLayout();
  </script>
</body>
</html>
