<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cognitive Architecture Cosmos Visualization</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #121212;
      color: #f0f0f0;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    
    .header {
      padding: 1rem;
      background-color: #1a1a1a;
      border-bottom: 1px solid #333;
    }
    
    .header h1 {
      margin: 0;
      font-size: 1.5rem;
    }
    
    .controls {
      display: flex;
      gap: 1rem;
      padding: 0.5rem 1rem;
      background-color: #1a1a1a;
      border-bottom: 1px solid #333;
    }
    
    .controls button {
      padding: 0.5rem 1rem;
      background-color: #333;
      color: #f0f0f0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .controls button:hover {
      background-color: #444;
    }
    
    .controls select {
      padding: 0.5rem;
      background-color: #333;
      color: #f0f0f0;
      border: none;
      border-radius: 4px;
    }
    
    .visualization-container {
      flex: 1;
      overflow: hidden;
      position: relative;
    }
    
    .cosmos-visualization {
      width: 100%;
      height: 100%;
      background-color: #121212;
    }
    
    .cosmos-tooltip {
      position: absolute;
      visibility: hidden;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px;
      border-radius: 4px;
      pointer-events: none;
      max-width: 300px;
    }
    
    .cosmos-context-menu {
      position: absolute;
      visibility: hidden;
      background-color: #1a1a1a;
      border: 1px solid #333;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      padding: 4px 0;
      z-index: 1000;
    }
    
    .context-menu-item {
      padding: 8px 12px;
      cursor: pointer;
    }
    
    .context-menu-item:hover {
      background-color: #333;
    }
    
    .orbits circle {
      opacity: 0.3;
    }
    
    .nodes circle {
      transition: all 0.3s;
    }
    
    .nodes circle:hover {
      filter: brightness(1.2);
    }
    
    .labels text {
      fill: #f0f0f0;
      font-size: 12px;
      pointer-events: none;
    }
    
    .details-panel {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 300px;
      background-color: rgba(26, 26, 26, 0.9);
      border: 1px solid #333;
      border-radius: 4px;
      padding: 1rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      display: none;
    }
    
    .details-panel.visible {
      display: block;
    }
    
    .details-panel h2 {
      margin-top: 0;
      font-size: 1.2rem;
      border-bottom: 1px solid #333;
      padding-bottom: 0.5rem;
    }
    
    .details-panel .close-button {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: none;
      border: none;
      color: #f0f0f0;
      cursor: pointer;
      font-size: 1.2rem;
    }
    
    .details-panel dl {
      margin: 0;
    }
    
    .details-panel dt {
      font-weight: bold;
      margin-top: 0.5rem;
    }
    
    .details-panel dd {
      margin-left: 0;
      margin-bottom: 0.5rem;
    }
    
    .dimension-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 4px;
    }
    
    .dimension-temporal { background-color: #2196f3; }
    .dimension-cognitive { background-color: #9c27b0; }
    .dimension-organizational { background-color: #4caf50; }
    .dimension-strategic { background-color: #f44336; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Cognitive Architecture Cosmos Visualization</h1>
    </div>
    
    <div class="controls">
      <button id="reset-view">Reset View</button>
      <button id="toggle-labels">Toggle Labels</button>
      <select id="filter-level">
        <option value="all">All Levels</option>
        <option value="cosmos">COSMOS</option>
        <option value="galaxy">GALAXIES</option>
        <option value="stellar_system">SYSTÈMES STELLAIRES</option>
        <option value="planet">PLANÈTES</option>
        <option value="continent">CONTINENTS</option>
        <option value="region">RÉGIONS</option>
        <option value="locality">LOCALITÉS</option>
        <option value="district">QUARTIERS</option>
        <option value="building">BÂTIMENTS</option>
        <option value="foundation">FONDATIONS</option>
      </select>
      <select id="color-by">
        <option value="level">Color by Level</option>
        <option value="temporal">Color by Temporal</option>
        <option value="cognitive">Color by Cognitive</option>
        <option value="organizational">Color by Organizational</option>
        <option value="strategic">Color by Strategic</option>
        <option value="status">Color by Status</option>
      </select>
    </div>
    
    <div class="visualization-container">
      <div id="cosmos-vis" class="cosmos-visualization"></div>
      
      <div class="details-panel" id="details-panel">
        <button class="close-button" id="close-details">&times;</button>
        <h2 id="details-title">Node Details</h2>
        <dl>
          <dt>Type</dt>
          <dd id="details-type"></dd>
          
          <dt>Status</dt>
          <dd id="details-status"></dd>
          
          <dt>Description</dt>
          <dd id="details-description"></dd>
          
          <dt>Dimensions</dt>
          <dd id="details-dimensions">
            <div><span class="dimension-indicator dimension-temporal"></span> Temporal: <span id="details-temporal">-</span></div>
            <div><span class="dimension-indicator dimension-cognitive"></span> Cognitive: <span id="details-cognitive">-</span></div>
            <div><span class="dimension-indicator dimension-organizational"></span> Organizational: <span id="details-organizational">-</span></div>
            <div><span class="dimension-indicator dimension-strategic"></span> Strategic: <span id="details-strategic">-</span></div>
          </dd>
        </dl>
      </div>
    </div>
  </div>
  
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    // Sample data (will be replaced with actual data from the converter)
    const sampleData = {
      id: 'root',
      title: 'Email Sender Cognitive Architecture',
      type: 'cosmos',
      status: 'in_progress',
      description: 'Représentation holistique de l\'écosystème complet du projet Email Sender',
      metadata: {
        temporal: { horizon: 'long_term' },
        cognitive: { complexity: 'systemic' },
        organizational: { responsibility: 'organizational' },
        strategic: { priority: 'high' }
      },
      children: [
        {
          id: 'galaxy-1',
          title: 'Automatisation des Processus',
          type: 'galaxy',
          status: 'in_progress',
          description: 'Branche stratégique couvrant tous les aspects d\'automatisation',
          metadata: {
            temporal: { horizon: 'medium_term' },
            strategic: { value: 'high' }
          },
          children: [
            {
              id: 'system-1',
              title: 'Backend Intelligent',
              type: 'stellar_system',
              status: 'in_progress',
              description: 'Système principal pour le traitement intelligent des emails',
              metadata: {
                cognitive: { complexity: 'complex' },
                organizational: { responsibility: 'team' }
              },
              children: [
                {
                  id: 'planet-1',
                  title: 'Module d\'Analyse Sémantique',
                  type: 'planet',
                  status: 'planned',
                  description: 'Composant majeur pour l\'analyse sémantique des emails',
                  metadata: {
                    cognitive: { complexity: 'complex' },
                    strategic: { value: 'high' }
                  },
                  children: []
                }
              ]
            }
          ]
        },
        {
          id: 'galaxy-2',
          title: 'Interface Utilisateur',
          type: 'galaxy',
          status: 'planned',
          description: 'Branche stratégique pour l\'expérience utilisateur',
          metadata: {
            temporal: { horizon: 'short_term' },
            strategic: { priority: 'medium' }
          },
          children: []
        }
      ]
    };
    
    // Load the visualization module
    // In a real application, this would be loaded from a file
    // For this example, we'll use the D3.js library directly
    
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize the visualization
      const container = document.getElementById('cosmos-vis');
      
      // Create the visualization
      const visualization = createCosmosVisualization('#cosmos-vis', sampleData);
      
      // Set up event handlers
      document.getElementById('reset-view').addEventListener('click', function() {
        visualization.svg.transition()
          .duration(750)
          .call(visualization.zoom.transform, d3.zoomIdentity);
      });
      
      document.getElementById('toggle-labels').addEventListener('click', function() {
        const labels = d3.selectAll('.labels');
        const currentVisibility = labels.style('display');
        labels.style('display', currentVisibility === 'none' ? 'block' : 'none');
      });
      
      document.getElementById('filter-level').addEventListener('change', function() {
        const level = this.value;
        if (level === 'all') {
          d3.selectAll('.node').style('display', 'block');
        } else {
          d3.selectAll('.node').style('display', 'none');
          d3.selectAll(`.node-${level}`).style('display', 'block');
        }
      });
      
      document.getElementById('color-by').addEventListener('change', function() {
        const colorBy = this.value;
        
        if (colorBy === 'level') {
          // Reset to default colors
          d3.selectAll('.node circle').each(function(d) {
            const levelStyle = visualization.config.levelStyles[d.data.type] || visualization.config.levelStyles.locality;
            d3.select(this).attr('fill', levelStyle.color);
          });
        } else if (colorBy === 'status') {
          // Color by status
          const statusColors = {
            planned: '#2196f3',
            in_progress: '#ff9800',
            completed: '#4caf50',
            blocked: '#f44336',
            cancelled: '#9e9e9e'
          };
          
          d3.selectAll('.node circle').each(function(d) {
            const status = d.data.status || 'planned';
            d3.select(this).attr('fill', statusColors[status]);
          });
        } else {
          // Color by dimension
          const dimensionColors = {
            temporal: d3.scaleOrdinal()
              .domain(['immediate', 'short_term', 'medium_term', 'long_term'])
              .range(['#b3e5fc', '#4fc3f7', '#0288d1', '#01579b']),
            cognitive: d3.scaleOrdinal()
              .domain(['simple', 'moderate', 'complex', 'systemic'])
              .range(['#e1bee7', '#ba68c8', '#8e24aa', '#4a148c']),
            organizational: d3.scaleOrdinal()
              .domain(['individual', 'team', 'inter_team', 'organizational'])
              .range(['#c8e6c9', '#81c784', '#43a047', '#1b5e20']),
            strategic: d3.scaleOrdinal()
              .domain(['low', 'medium', 'high', 'critical'])
              .range(['#ffcdd2', '#ef9a9a', '#e57373', '#c62828'])
          };
          
          d3.selectAll('.node circle').each(function(d) {
            const dimension = d.data.metadata && d.data.metadata[colorBy];
            let color = '#9e9e9e'; // Default gray
            
            if (dimension) {
              // Find the first non-empty dimension value
              const dimensionValue = Object.values(dimension)[0];
              if (dimensionValue && dimensionColors[colorBy]) {
                color = dimensionColors[colorBy](dimensionValue);
              }
            }
            
            d3.select(this).attr('fill', color);
          });
        }
      });
      
      // Details panel functionality
      function showNodeDetails(d) {
        const panel = document.getElementById('details-panel');
        document.getElementById('details-title').textContent = d.data.title;
        document.getElementById('details-type').textContent = d.data.type.toUpperCase();
        document.getElementById('details-status').textContent = d.data.status || 'planned';
        document.getElementById('details-description').textContent = d.data.description || 'No description';
        
        // Display dimension values
        const dimensions = ['temporal', 'cognitive', 'organizational', 'strategic'];
        dimensions.forEach(dim => {
          const element = document.getElementById(`details-${dim}`);
          const metadata = d.data.metadata && d.data.metadata[dim];
          
          if (metadata && Object.keys(metadata).length > 0) {
            element.textContent = Object.entries(metadata)
              .map(([key, value]) => `${key}: ${value}`)
              .join(', ');
          } else {
            element.textContent = '-';
          }
        });
        
        panel.classList.add('visible');
      }
      
      document.getElementById('close-details').addEventListener('click', function() {
        document.getElementById('details-panel').classList.remove('visible');
      });
      
      // Override the showNodeDetails function in the visualization
      visualization.showNodeDetails = showNodeDetails;
    });
    
    // Simplified version of the createCosmosVisualization function for the example
    function createCosmosVisualization(selector, data) {
      // Configuration
      const config = {
        width: 1200,
        height: 800,
        levelStyles: {
          cosmos: { radius: 50, color: '#1a237e', orbitRadius: 0 },
          galaxy: { radius: 30, color: '#7b1fa2', orbitRadius: 150 },
          stellar_system: { radius: 20, color: '#d32f2f', orbitRadius: 250 },
          planet: { radius: 15, color: '#ff9800', orbitRadius: 350 },
          continent: { radius: 10, color: '#ffc107', orbitRadius: 420 },
          region: { radius: 8, color: '#4caf50', orbitRadius: 480 },
          locality: { radius: 6, color: '#00bcd4', orbitRadius: 530 },
          district: { radius: 4, color: '#2196f3', orbitRadius: 570 },
          building: { radius: 3, color: '#3f51b5', orbitRadius: 600 },
          foundation: { radius: 2, color: '#212121', orbitRadius: 625 }
        },
        animation: {
          orbitSpeed: 0.001,
          zoomDuration: 750,
          nodeClickDuration: 500
        }
      };
      
      // Select the container element
      const container = d3.select(selector);
      
      // Create the SVG element
      const svg = container
        .append('svg')
        .attr('width', '100%')
        .attr('height', '100%')
        .attr('viewBox', `0 0 ${config.width} ${config.height}`)
        .attr('preserveAspectRatio', 'xMidYMid meet');
      
      // Create a group for the visualization
      const vis = svg
        .append('g')
        .attr('transform', `translate(${config.width / 2}, ${config.height / 2})`);
      
      // Create zoom behavior
      const zoom = d3.zoom()
        .scaleExtent([0.1, 10])
        .on('zoom', (event) => {
          vis.attr('transform', event.transform);
        });
      
      // Apply zoom behavior to SVG
      svg.call(zoom);
      
      // Create groups for orbits, nodes, and labels
      const orbitsGroup = vis.append('g').attr('class', 'orbits');
      const nodesGroup = vis.append('g').attr('class', 'nodes');
      const labelsGroup = vis.append('g').attr('class', 'labels');
      
      // Create a tooltip
      const tooltip = container.select('.cosmos-tooltip');
      
      // Function to render the visualization
      function render() {
        // Create hierarchical layout
        const root = d3.hierarchy(data);
        
        // Draw orbits
        Object.entries(config.levelStyles).forEach(([type, style]) => {
          if (style.orbitRadius > 0) {
            orbitsGroup
              .append('circle')
              .attr('r', style.orbitRadius)
              .attr('fill', 'none')
              .attr('stroke', 'rgba(255, 255, 255, 0.1)')
              .attr('stroke-width', 1)
              .attr('stroke-dasharray', '3,3')
              .attr('class', `orbit-${type}`);
          }
        });
        
        // Function to position nodes based on their level
        function positionNode(d) {
          const levelStyle = config.levelStyles[d.data.type] || config.levelStyles.locality;
          const orbitRadius = levelStyle.orbitRadius;
          
          // Position based on orbit and index within level
          const siblings = root.descendants().filter(node => node.depth === d.depth);
          const index = siblings.indexOf(d);
          const angle = (index / Math.max(1, siblings.length)) * 2 * Math.PI;
          
          return {
            x: orbitRadius * Math.cos(angle),
            y: orbitRadius * Math.sin(angle)
          };
        }
        
        // Draw nodes
        const nodes = nodesGroup
          .selectAll('.node')
          .data(root.descendants())
          .enter()
          .append('g')
          .attr('class', d => `node node-${d.data.type}`)
          .attr('transform', d => {
            const pos = positionNode(d);
            return `translate(${pos.x}, ${pos.y})`;
          });
        
        // Add circles for nodes
        nodes
          .append('circle')
          .attr('r', d => {
            const levelStyle = config.levelStyles[d.data.type] || config.levelStyles.locality;
            return levelStyle.radius;
          })
          .attr('fill', d => {
            const levelStyle = config.levelStyles[d.data.type] || config.levelStyles.locality;
            return levelStyle.color;
          })
          .attr('stroke', 'white')
          .attr('stroke-width', 1);
        
        // Add labels
        labelsGroup
          .selectAll('.label')
          .data(root.descendants().filter(d => d.depth <= 2)) // Only show labels for top 3 levels
          .enter()
          .append('text')
          .attr('class', 'label')
          .attr('transform', d => {
            const pos = positionNode(d);
            return `translate(${pos.x}, ${pos.y + 20})`;
          })
          .attr('text-anchor', 'middle')
          .attr('font-size', d => {
            const levelStyle = config.levelStyles[d.data.type] || config.levelStyles.locality;
            return levelStyle.radius * 0.8;
          })
          .text(d => d.data.title);
        
        // Add interactions
        nodes
          .on('mouseover', function(event, d) {
            // Show tooltip
            const tooltipContent = `
              <div><strong>${d.data.title}</strong></div>
              <div>${d.data.type.toUpperCase()}</div>
              ${d.data.description ? `<div>${d.data.description}</div>` : ''}
              <div>Status: ${d.data.status || 'planned'}</div>
            `;
            
            d3.select('.cosmos-tooltip')
              .html(tooltipContent)
              .style('visibility', 'visible')
              .style('left', `${event.pageX + 10}px`)
              .style('top', `${event.pageY + 10}px`);
            
            // Highlight node
            d3.select(this).select('circle')
              .attr('stroke', 'yellow')
              .attr('stroke-width', 2);
          })
          .on('mousemove', function(event) {
            d3.select('.cosmos-tooltip')
              .style('left', `${event.pageX + 10}px`)
              .style('top', `${event.pageY + 10}px`);
          })
          .on('mouseout', function() {
            // Hide tooltip
            d3.select('.cosmos-tooltip').style('visibility', 'hidden');
            
            // Remove highlight
            d3.select(this).select('circle')
              .attr('stroke', 'white')
              .attr('stroke-width', 1);
          })
          .on('click', function(event, d) {
            // Show details
            showNodeDetails(d);
            
            // Center and zoom to node
            const pos = positionNode(d);
            const transform = d3.zoomIdentity
              .translate(config.width / 2 - pos.x * 2, config.height / 2 - pos.y * 2)
              .scale(2);
            
            svg.transition()
              .duration(config.animation.zoomDuration)
              .call(zoom.transform, transform);
          });
      }
      
      // Initial render
      render();
      
      // Function to show node details (will be overridden)
      function showNodeDetails(d) {
        console.log('Show details for:', d);
      }
      
      // Return the visualization API
      return {
        render,
        svg,
        zoom,
        config,
        showNodeDetails
      };
    }
  </script>
</body>
</html>
