<% /*
  Générateur récursif de table des matières avec numéros de page
  Utilisation :
  - Inclure ce fichier dans plan-dev.ejs avec la syntaxe EJS :
    <%~ include('toc.ejs', { tasks: tasks, level: 0 }) %>
  - 'tasks' doit être un tableau d'objets comme pour subtasks.ejs
*/ %>
<% function renderTOC(tasks, level) { %>
<% tasks.forEach(function(task) { %>
<%= '  '.repeat(level) %>- [<%= task.label %>](#<%= task.label.toLowerCase().replace(/[^a-z0-9]+/g,'-') %>) (Page <%= task.page || '?' %>)
<%   if (task.subtasks && task.subtasks.length > 0) { %>
<%= renderTOC(task.subtasks, level + 1) %>
<%   } %>
<% }) %>
<% } %>
<%= renderTOC(typeof tasks !== 'undefined' ? tasks : [], typeof level !== 'undefined' ? level : 0) %>
