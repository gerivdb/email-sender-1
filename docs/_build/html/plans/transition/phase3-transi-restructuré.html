

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plan de Développement Détaillé - Phase 3 : Intégration avec le Plan Magistral V5 &mdash; EMAIL_SENDER_1 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            EMAIL_SENDER_1
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenu:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Documentation des API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EMAIL_SENDER_1</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Plan de Développement Détaillé - Phase 3 : Intégration avec le Plan Magistral V5</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/plans/transition/phase3-transi-restructuré.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="plan-de-developpement-detaille-phase-3-integration-avec-le-plan-magistral-v5">
<h1>Plan de Développement Détaillé - Phase 3 : Intégration avec le Plan Magistral V5<a class="headerlink" href="#plan-de-developpement-detaille-phase-3-integration-avec-le-plan-magistral-v5" title="Link to this heading"></a></h1>
<p>Ce document présente le plan détaillé pour la Phase 3 du plan de transition, qui prépare le workflow à l’initialisation du Plan Magistral V5.</p>
<section id="table-des-matieres">
<h2>Table des matières<a class="headerlink" href="#table-des-matieres" title="Link to this heading"></a></h2>
<ol class="simple">
<li><p><a class="reference external" href="#section-1">Plan de Développement Détaillé - Phase 3 : Intégration avec le Plan Magistral V5</a>
1.1. <a class="reference external" href="#section-1-1">Analyse préliminaire</a>
1.2. <a class="reference external" href="#section-1-2">Plan de Développement Détaillé - Phase 3</a>
1.2.1. <a class="reference external" href="#section-1-2-1">Vue d’ensemble de la Phase 3</a>
1.3. <a class="reference external" href="#section-1-3">Étape 3.1: Création des Structures de Base</a>
1.3.1. <a class="reference external" href="#section-1-3-1">Mise en Place des Piliers</a>
1.3.2. <a class="reference external" href="#section-1-3-2">Configuration des Webhooks et Points d’Intégration</a>
1.3.3. <a class="reference external" href="#section-1-3-3">Mise en Place du Système de Configuration Centralisé</a>
1.4. <a class="reference external" href="#section-1-4">Étape 3.2: Migration des Fonctionnalités Existantes</a>
1.4.1. <a class="reference external" href="#section-1-4-1">Cartographie des Fonctionnalités</a>
1.4.2. <a class="reference external" href="#section-1-4-2">Migration Progressive</a>
1.4.3. <a class="reference external" href="#section-1-4-3">Adaptation des Interfaces</a>
1.5. <a class="reference external" href="#section-1-5">Étape 3.3: Mise en Place du Système de Monitoring</a>
1.5.1. <a class="reference external" href="#section-1-5-1">Configuration des Alertes</a>
1.5.2. <a class="reference external" href="#section-1-5-2">Mise en Place des Tableaux de Bord</a>
1.5.3. <a class="reference external" href="#section-1-5-3">Implémentation des Mécanismes de Récupération</a>
1.6. <a class="reference external" href="#section-1-6">Conclusion et Recommandations</a>
1.6.1. <a class="reference external" href="#section-1-6-1">Points Clés à Retenir</a>
1.6.2. <a class="reference external" href="#section-1-6-2">Recommandations pour l’Implémentation</a></p></li>
</ol>
</section>
<section id="plan-de-developpement-detaille-phase-3-integration-avec-le-plan-magistral-v5-a-name-section-1-a">
<h2>1. Plan de Développement Détaillé - Phase 3 : Intégration avec le Plan Magistral V5 <a name='section-1'></a><a class="headerlink" href="#plan-de-developpement-detaille-phase-3-integration-avec-le-plan-magistral-v5-a-name-section-1-a" title="Link to this heading"></a></h2>
<p>Je vais analyser en détail la Phase 3 du plan de transition et développer un plan d’implémentation exhaustif pour préparer le workflow à l’initialisation du Plan Magistral V5.</p>
<section id="analyse-preliminaire-a-name-section-1-1-a">
<h3>1.1. Analyse préliminaire <a name='section-1-1'></a><a class="headerlink" href="#analyse-preliminaire-a-name-section-1-1-a" title="Link to this heading"></a></h3>
<p>Commençons par examiner le contenu du fichier PILIER_1.md pour comprendre le contexte du Plan Magistral V5.<br />PILIER_1.mdplans/pour le futur</p>
</section>
<section id="plan-de-developpement-detaille-phase-3-a-name-section-1-2-a">
<h3>1.2. Plan de Développement Détaillé - Phase 3 <a name='section-1-2'></a><a class="headerlink" href="#plan-de-developpement-detaille-phase-3-a-name-section-1-2-a" title="Link to this heading"></a></h3>
<section id="vue-d-ensemble-de-la-phase-3-a-name-section-1-2-1-a">
<h4>1.2.1. Vue d’ensemble de la Phase 3 <a name='section-1-2-1'></a><a class="headerlink" href="#vue-d-ensemble-de-la-phase-3-a-name-section-1-2-1-a" title="Link to this heading"></a></h4>
<p>┌─────────────────────────────────────────────────────────────────────┐<br />│                                                                     │<br />│                PHASE 3: INTÉGRATION AVEC LE PLAN MAGISTRAL V5       │<br />│                                                                     │<br />│  ┌───────────────┐    ┌───────────────┐    ┌───────────────────┐   │<br />│  │  ÉTAPE 3.1    │    │  ÉTAPE 3.2    │    │    ÉTAPE 3.3      │   │<br />│  │ Structures de │───&gt;│  Migration    │───&gt;│   Système de      │   │<br />│  │     Base      │    │Fonctionnalités│    │    Monitoring     │   │<br />│  └───────────────┘    └───────────────┘    └───────────────────┘   │<br />│                                                                     │<br />└─────────────────────────────────────────────────────────────────────┘</p>
</section>
</section>
<section id="etape-3-1-creation-des-structures-de-base-a-name-section-1-3-a">
<h3>1.3. Étape 3.1: Création des Structures de Base <a name='section-1-3'></a><a class="headerlink" href="#etape-3-1-creation-des-structures-de-base-a-name-section-1-3-a" title="Link to this heading"></a></h3>
<section id="mise-en-place-des-piliers-a-name-section-1-3-1-a">
<h4>1.3.1. Mise en Place des Piliers <a name='section-1-3-1'></a><a class="headerlink" href="#mise-en-place-des-piliers-a-name-section-1-3-1-a" title="Link to this heading"></a></h4>
</section>
<section id="workflows-a-developper">
<h4>Workflows à Développer<a class="headerlink" href="#workflows-a-developper" title="Link to this heading"></a></h4>
<ol class="simple">
<li><p>WF-PILIER-INITIALIZER</p>
<ul class="simple">
<li><p>Objectif: Créer et configurer les workflows de base pour chaque pilier du Plan Magistral V5</p></li>
<li><p>Structure JSON:</p></li>
</ul>
</li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WF-PILIER-INITIALIZER&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;nodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;triggerTimes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">          </span><span class="nt">&quot;item&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">              </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manual&quot;</span><span class="w">  </span>
<span class="w">            </span><span class="p">}</span><span class="w">  </span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      \]  
  },  
  &quot;name&quot;: &quot;Déclencheur Manuel&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.manualTrigger&quot;,  
  &quot;position&quot;: \[100, 300\]  
    &quot;values&quot;: {  
      &quot;string&quot;: \[  
          &quot;name&quot;: &quot;pilierName&quot;,  
          &quot;value&quot;: &quot;==$input.item.json.pilierName || &#39;PILIER\_1&#39;&quot;  
          &quot;name&quot;: &quot;pilierDescription&quot;,  
          &quot;value&quot;: &quot;==$input.item.json.pilierDescription || &#39;La Donnée Stratégique&#39;&quot;  
  &quot;name&quot;: &quot;Configuration Pilier&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.set&quot;,  
  &quot;position&quot;: \[300, 300\]  
    &quot;functionCode&quot;: &quot;// Génération du squelette du workflow pilier\\nconst pilierName \= $input.item.json.pilierName;\\nconst pilierDescription \= $input.item.json.pilierDescription;\\n\\n// Structure de base du workflow\\nconst workflowStructure \= {\\n  name: pilierName,\\n  nodes: \[\\n    {\\n      parameters: {\\n        triggerTimes: {\\n          item: \[\\n            {\\n              mode: \\&quot;manual\\&quot;\\n            }\\n          \]\\n        }\\n      },\\n      name: \\&quot;Déclencheur Manuel\\&quot;,\\n      type: \\&quot;n8n-nodes-base.manualTrigger\\&quot;,\\n      position: \[100, 300\]\\n    },\\n    {\\n      parameters: {\\n        values: {\\n          string: \[\\n            {\\n              name: \\&quot;pilierName\\&quot;,\\n              value: pilierName\\n            },\\n            {\\n              name: \\&quot;pilierDescription\\&quot;,\\n              value: pilierDescription\\n            }\\n          \]\\n        }\\n      },\\n      name: \\&quot;Configuration Pilier\\&quot;,\\n      type: \\&quot;n8n-nodes-base.set\\&quot;,\\n      position: \[300, 300\]\\n    },\\n    {\\n      parameters: {\\n        functionCode: \\&quot;// Code de configuration spécifique au pilier\\\\nreturn $input.item;\\&quot;\\n      },\\n      name: \\&quot;Logique Pilier\\&quot;,\\n      type: \\&quot;n8n-nodes-base.function\\&quot;,\\n      position: \[500, 300\]\\n    }\\n  \],\\n  connections: {\\n    \\&quot;Déclencheur Manuel\\&quot;: {\\n      main: \[\\n        \[\\n          {\\n            node: \\&quot;Configuration Pilier\\&quot;,\\n            type: \\&quot;main\\&quot;,\\n            index: 0\\n          }\\n        \]\\n      \]\\n    },\\n    \\&quot;Configuration Pilier\\&quot;: {\\n      main: \[\\n        \[\\n          {\\n            node: \\&quot;Logique Pilier\\&quot;,\\n            type: \\&quot;main\\&quot;,\\n            index: 0\\n          }\\n        \]\\n      \]\\n    }\\n  }\\n};\\n\\nreturn {\\n  json: {\\n    workflowStructure,\\n    pilierName,\\n    pilierDescription\\n  }\\n};&quot;  
  &quot;name&quot;: &quot;Générer Structure Workflow&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.function&quot;,  
  &quot;position&quot;: \[500, 300\]  
    &quot;path&quot;: &quot;workflows/piliers/{{$json.pilierName}}.json&quot;,  
    &quot;options&quot;: {}  
  &quot;name&quot;: &quot;Sauvegarder Structure Workflow&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.writeBinaryFile&quot;,  
  &quot;position&quot;: \[700, 300\]  
    &quot;url&quot;: &quot;http://localhost:5678/rest/workflows&quot;,  
    &quot;authentication&quot;: &quot;genericCredentialType&quot;,  
    &quot;genericAuthType&quot;: &quot;n8nApi&quot;,  
    &quot;sendBody&quot;: true,  
    &quot;bodyParameters&quot;: {  
      &quot;parameters&quot;: \[  
          &quot;name&quot;: &quot;name&quot;,  
          &quot;value&quot;: &quot;={{$json.pilierName}}&quot;  
          &quot;name&quot;: &quot;nodes&quot;,  
          &quot;value&quot;: &quot;={{$json.workflowStructure.nodes}}&quot;  
          &quot;name&quot;: &quot;connections&quot;,  
          &quot;value&quot;: &quot;={{$json.workflowStructure.connections}}&quot;  
          &quot;name&quot;: &quot;active&quot;,  
          &quot;value&quot;: false  
          &quot;name&quot;: &quot;settings&quot;,  
          &quot;value&quot;: &quot;{}&quot;  
  &quot;name&quot;: &quot;Créer Workflow dans N8N&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.httpRequest&quot;,  
  &quot;position&quot;: \[900, 300\]  
    &quot;conditions&quot;: {  
          &quot;value1&quot;: &quot;={{$json.statusCode}}&quot;,  
          &quot;operation&quot;: &quot;startsWith&quot;,  
          &quot;value2&quot;: &quot;2&quot;  
  &quot;name&quot;: &quot;Vérifier Création&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.if&quot;,  
  &quot;position&quot;: \[1100, 300\]  
          &quot;name&quot;: &quot;status&quot;,  
          &quot;value&quot;: &quot;success&quot;  
          &quot;name&quot;: &quot;message&quot;,  
          &quot;value&quot;: &quot;=Pilier {{$json.pilierName}} créé avec succès&quot;  
  &quot;name&quot;: &quot;Succès&quot;,  
  &quot;position&quot;: \[1300, 200\]  
          &quot;value&quot;: &quot;error&quot;  
          &quot;value&quot;: &quot;=Erreur lors de la création du pilier {{$json.pilierName}}: {{$json.statusCode}} \- {{$json.statusMessage}}&quot;  
  &quot;name&quot;: &quot;Erreur&quot;,  
  &quot;position&quot;: \[1300, 400\]  
</pre></div>
</div>
<p>],<br />”connections”: {<br />”Déclencheur Manuel”: {<br />”main”: [<br />[<br />”node”: “Configuration Pilier”,<br />”type”: “main”,<br />”index”: 0<br />”Configuration Pilier”: {<br />”node”: “Générer Structure Workflow”,<br />”Générer Structure Workflow”: {<br />”node”: “Sauvegarder Structure Workflow”,<br />”Sauvegarder Structure Workflow”: {<br />”node”: “Créer Workflow dans N8N”,<br />”Créer Workflow dans N8N”: {<br />”node”: “Vérifier Création”,<br />”Vérifier Création”: {<br />”node”: “Succès”,<br />”node”: “Erreur”,</p>
<p>2. WF-PILIER-CONFIG-GENERATOR</p>
<ul>
<li><p>Objectif: Générer les configurations spécifiques pour chaque pilier</p>
<p>“name”: “WF-PILIER-CONFIG-GENERATOR”,<br />”name”: “Configuration Entrée”,<br />”value1”: “={{$json.pilierName}}”,<br />”operation”: “equal”,<br />”value2”: “PILIER_1”<br />”name”: “Vérifier Pilier”,<br />”name”: “configType”,<br />”value”: “donnee_strategique”<br />”object”: [<br />”name”: “configData”,<br />”value”: {<br />”notionDatabases”: [<br />”name”: “Agence_Artistes”,<br />”id”: “{{$env.NOTION_DB_ARTISTES}}”<br />”name”: “Agence_Contacts”,<br />”id”: “{{$env.NOTION_DB_CONTACTS}}”<br />”gDriveFolders”: [<br />”name”: “Agence”,<br />”id”: “{{$env.GDRIVE_FOLDER_AGENCE}}”<br />”name”: “Config Pilier 1”,<br />”position”: [700, 200]<br />”value”: “autre_pilier”<br />”defaultConfig”: true<br />”name”: “Config Autre Pilier”,<br />”position”: [700, 400]<br />”functionCode”: “// Génération du fichier de configuration\nconst pilierName = $input.item.json.pilierName;\nconst configType = $input.item.json.configType;\nconst configData = $input.item.json.configData;\n\n// Structure de configuration\nconst configStructure = {\n  pilierName,\n  configType,\n  configData,\n  timestamp: new Date().toISOString(),\n  version: \”1.0.0\”\n};\n\n// Convertir en JSON formaté\nconst configJson = JSON.stringify(configStructure, null, 2);\n\nreturn {\n  json: {\n    pilierName,\n    configType,\n    configJson\n  },\n  binary: {\n    data: {\n      mimeType: ‘application/json’,\n      data: Buffer.from(configJson).toString(’base64’),\n      fileName: `${pilierName}_config.json`\n    }\n  }\n};”<br />”name”: “Générer Config JSON”,<br />”path”: “configs/piliers/{{$json.pilierName}}_config.json”,<br />”name”: “Sauvegarder Config”,<br />”node”: “Configuration Entrée”,<br />”Configuration Entrée”: {<br />”node”: “Vérifier Pilier”,<br />”Vérifier Pilier”: {<br />”node”: “Config Pilier 1”,<br />”node”: “Config Autre Pilier”,<br />”Config Pilier 1”: {<br />”node”: “Générer Config JSON”,<br />”Config Autre Pilier”: {<br />”Générer Config JSON”: {<br />”node”: “Sauvegarder Config”,</p>
</li>
</ul>
<p>WF-PILIER-STRUCTURE-VALIDATOR</p>
<ul>
<li><p>Objectif: Valider que les structures de base nécessaires pour chaque pilier sont correctement configurées</p>
<p>“name”: “WF-PILIER-STRUCTURE-VALIDATOR”,<br />”rule”: {<br />”interval”: [<br />”field”: “hours”,<br />”hour”: 9<br />”name”: “Déclencheur Cron”,<br />”type”: “n8n-nodes-base.cron”,<br />”functionCode”: “// Liste des piliers à valider\nconst piliers = [\n  { name: ‘PILIER_1’, description: ‘La Donnée Stratégique’ },\n  { name: ‘PILIER_2’, description: ‘Les Processus Automatisés’ },\n  { name: ‘PILIER_3’, description: ‘L\\’Intelligence Augmentée’ },\n  { name: ‘PILIER_4’, description: ‘Les Interfaces Utilisateur’ }\n];\n\nreturn piliers.map(pilier =&gt; ({ json: pilier }));”<br />”name”: “Définir Piliers”,<br />”url”: “=http://localhost:5678/rest/workflows?filter={{$json.name}}”,<br />”name”: “Vérifier Existence Workflow”,<br />”number”: [<br />”value1”: “={{$json.data.length}}”,<br />”value2”: 0<br />”name”: “Workflow Existe?”,<br />”value”: “missing”<br />”value”: “=Le workflow pour le pilier {{$json.name}} n’existe pas et doit être créé”<br />”name”: “Workflow Manquant”,<br />”position”: [900, 200]<br />”value”: “exists”<br />”value”: “=Le workflow pour le pilier {{$json.name}} existe”<br />”name”: “Workflow Existe”,<br />”position”: [900, 400]<br />”path”: “configs/piliers/{{$json.name}}_config.json”,<br />”options”: {<br />”encoding”: “utf8”<br />”name”: “Vérifier Config”,<br />”type”: “n8n-nodes-base.readBinaryFile”,<br />”value1”: “={{$json.status}}”,<br />”value2”: “missing”<br />”name”: “Config Existe?”,<br />”position”: [1300, 300]<br />”name”: “configStatus”,<br />”name”: “configMessage”,<br />”value”: “=La configuration pour le pilier {{$json.name}} n’existe pas et doit être créée”<br />”name”: “Config Manquante”,<br />”position”: [1500, 200]<br />”value”: “=La configuration pour le pilier {{$json.name}} existe”<br />”name”: “Config Existe”,<br />”position”: [1500, 400]<br />”name”: “Action Nécessaire?”,<br />”position”: [1700, 300]<br />”chatId”: “{{$env.TELEGRAM_CHAT_ID}}”,<br />”text”: “=⚠️ ALERTE STRUCTURE PILIER\n\nLe pilier {{$json.name}} ({{$json.description}}) nécessite une action:\n- Workflow: {{$json.status}} - {{$json.message}}\n- Configuration: {{$json.configStatus}} - {{$json.configMessage}}\n\nVeuillez exécuter les workflows de configuration appropriés.”,<br />”additionalFields”: {}<br />”name”: “Envoyer Alerte”,<br />”type”: “n8n-nodes-base.telegram”,<br />”position”: [1900, 200]<br />”Déclencheur Cron”: {<br />”node”: “Définir Piliers”,<br />”Définir Piliers”: {<br />”node”: “Vérifier Existence Workflow”,<br />”Vérifier Existence Workflow”: {<br />”node”: “Workflow Existe?”,<br />”Workflow Existe?”: {<br />”node”: “Workflow Manquant”,<br />”node”: “Workflow Existe”,<br />”Workflow Manquant”: {<br />”node”: “Vérifier Config”,<br />”Workflow Existe”: {<br />”Vérifier Config”: {<br />”node”: “Config Existe?”,<br />”Config Existe?”: {<br />”node”: “Config Manquante”,<br />”node”: “Config Existe”,<br />”Config Manquante”: {<br />”node”: “Action Nécessaire?”,<br />”Config Existe”: {<br />”Action Nécessaire?”: {<br />”node”: “Envoyer Alerte”,<br />[]</p>
</li>
</ul>
</section>
<section id="diagramme-ascii-des-piliers">
<h4>Diagramme ASCII des Piliers<a class="headerlink" href="#diagramme-ascii-des-piliers" title="Link to this heading"></a></h4>
<p>┌───────────────────────────────────────────────────────────────────────────┐<br />│                                                                           │<br />│                        ARCHITECTURE DES PILIERS                           │<br />│                                                                           │<br />│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────┐  │<br />│  │  PILIER 1   │     │  PILIER 2   │     │  PILIER 3   │     │ PILIER 4│  │<br />│  │  Données    │────&gt;│  Processus  │────&gt;│ Intelligence│────&gt;│Interfaces│  │<br />│  │ Stratégiques│     │ Automatisés │     │  Augmentée  │     │Utilisateur│ │<br />│  └─────────────┘     └─────────────┘     └─────────────┘     └─────────┘  │<br />│         │                   │                   │                 │        │<br />│         ▼                   ▼                   ▼                 ▼        │<br />│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────┐  │<br />│  │  Notion DB  │     │  Workflows  │     │  AI Teams   │     │   CMS   │  │<br />│  │  GDrive     │     │    N8N      │     │ OpenRouter  │     │  API    │  │<br />│  └─────────────┘     └─────────────┘     └─────────────┘     └─────────┘  │<br />│                                                                           │<br />└───────────────────────────────────────────────────────────────────────────┘</p>
</section>
<section id="configuration-des-webhooks-et-points-d-integration-a-name-section-1-3-2-a">
<h4>1.3.2. Configuration des Webhooks et Points d’Intégration <a name='section-1-3-2'></a><a class="headerlink" href="#configuration-des-webhooks-et-points-d-integration-a-name-section-1-3-2-a" title="Link to this heading"></a></h4>
</section>
<section id="id1">
<h4>Workflows à Développer<a class="headerlink" href="#id1" title="Link to this heading"></a></h4>
<ol class="simple">
<li><p>WF-WEBHOOK-MANAGER</p>
<ul class="simple">
<li><p>Objectif: Créer et gérer les webhooks pour la communication entre les piliers</p></li>
<li><p>Structure JSON:</p></li>
</ul>
</li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WF-WEBHOOK-MANAGER&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;nodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;triggerTimes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">          </span><span class="nt">&quot;item&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">              </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manual&quot;</span><span class="w">  </span>
<span class="w">            </span><span class="p">}</span><span class="w">  </span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      \<span class="p">]</span>  
  <span class="p">},</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Déclencheur Manuel&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.manualTrigger&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">300</span>\<span class="p">]</span>  
    <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">{</span>  
      <span class="s2">&quot;string&quot;</span><span class="p">:</span> \<span class="p">[</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;action&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;==$input.item.json.action || &#39;list&#39;&quot;</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;webhookPath&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;==$input.item.json.webhookPath&quot;</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;sourcePilier&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;==$input.item.json.sourcePilier&quot;</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;targetPilier&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;==$input.item.json.targetPilier&quot;</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;description&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;==$input.item.json.description || &#39;Communication inter-piliers&#39;&quot;</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Configuration Entrée&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.set&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span>\<span class="p">]</span>  
    <span class="s2">&quot;conditions&quot;</span><span class="p">:</span> <span class="p">{</span>  
          <span class="s2">&quot;value1&quot;</span><span class="p">:</span> <span class="s2">&quot;={{$json.action}}&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;operation&quot;</span><span class="p">:</span> <span class="s2">&quot;equal&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value2&quot;</span><span class="p">:</span> <span class="s2">&quot;create&quot;</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Action?&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.if&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">300</span>\<span class="p">]</span>  
    <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;{{$json.webhookPath}}&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;responseMode&quot;</span><span class="p">:</span> <span class="s2">&quot;lastNode&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>  
      <span class="s2">&quot;responseHeaders&quot;</span><span class="p">:</span> <span class="p">{</span>  
        <span class="s2">&quot;entries&quot;</span><span class="p">:</span> \<span class="p">[</span>  
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span>  
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Créer Webhook&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.webhook&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">700</span><span class="p">,</span> <span class="mi">200</span>\<span class="p">]</span>  
    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:5678/rest/webhooks&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;authentication&quot;</span><span class="p">:</span> <span class="s2">&quot;genericCredentialType&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;genericAuthType&quot;</span><span class="p">:</span> <span class="s2">&quot;n8nApi&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{}</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Lister Webhooks&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.httpRequest&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">700</span><span class="p">,</span> <span class="mi">400</span>\<span class="p">]</span>  
<span class="s2">&quot;functionCode&quot;</span><span class="p">:</span> <span class="s2">&quot;// Traitement après création du webhook</span><span class="se">\\</span><span class="s2">nconst webhookData \= {</span><span class="se">\\</span><span class="s2">n  path: $input.item.json.webhookPath,</span><span class="se">\\</span><span class="s2">n  method: &#39;POST&#39;,</span><span class="se">\\</span><span class="s2">n  sourcePilier: $input.item.json.sourcePilier,</span><span class="se">\\</span><span class="s2">n  targetPilier: $input.item.json.targetPilier,</span><span class="se">\\</span><span class="s2">n  description: $input.item.json.description,</span><span class="se">\\</span><span class="s2">n  createdAt: new Date().toISOString(),</span><span class="se">\\</span><span class="s2">n  webhookUrl: \`${$env.N8N\_BASE\_URL}/webhook/${$input.item.json.webhookPath}\`</span><span class="se">\\</span><span class="s2">n};</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Sauvegarder les informations du webhook</span><span class="se">\\</span><span class="s2">nreturn {</span><span class="se">\\</span><span class="s2">n  json: webhookData</span><span class="se">\\</span><span class="s2">n};&quot;</span>  
</pre></div>
</div>
<p>“name”: “Traiter Création Webhook”,<br />”type”: “n8n-nodes-base.function”,<br />”position”: [900, 200]<br />”path”: “webhooks/{{$json.path}}.json”,<br />”name”: “Sauvegarder Info Webhook”,<br />”type”: “n8n-nodes-base.writeBinaryFile”,<br />”position”: [1100, 200]<br />”functionCode”: “// Traitement de la liste des webhooks\nconst webhooks = $input.item.json.data || [];\n\n// Formater les informations\nconst formattedWebhooks = webhooks.map(webhook =&gt; ({\n  id: webhook.id,\n  name: webhook.name,\n  path: webhook.webhookPath,\n  httpMethod: webhook.httpMethod,\n  webhookUrl: `${$env.N8N_BASE_URL}/webhook/${webhook.webhookPath}`\n}));\n\nreturn {\n  json: {\n    count: formattedWebhooks.length,\n    webhooks: formattedWebhooks\n  }\n};”<br />”name”: “Traiter Liste Webhooks”,<br />”position”: [900, 400]</p>
<p>2.WF-INTEGRATION-POINTS-VALIDATOR</p>
<ul>
<li><p>Objectif: Valider que tous les points d’intégration entre les piliers sont correctement configurés</p>
<p>“name”: “WF-INTEGRATION-POINTS-VALIDATOR”,<br />”rule”: {<br />”interval”: [<br />”field”: “hours”,<br />”hour”: 8<br />”name”: “Déclencheur Cron”,<br />”type”: “n8n-nodes-base.cron”,<br />”functionCode”: “// Définir les points d’intégration attendus\nconst expectedIntegrationPoints = [\n  { source: ‘PILIER_1’, target: ‘PILIER_2’, path: ‘pilier1-to-pilier2’ },\n  { source: ‘PILIER_2’, target: ‘PILIER_3’, path: ‘pilier2-to-pilier3’ },\n  { source: ‘PILIER_3’, target: ‘PILIER_4’, path: ‘pilier3-to-pilier4’ },\n  { source: ‘PILIER_4’, target: ‘PILIER_1’, path: ‘pilier4-to-pilier1’ }\n];\n\nreturn expectedIntegrationPoints.map(point =&gt; ({ json: point }));”<br />”name”: “Définir Points d’Intégration”,<br />”encoding”: “utf8”<br />”name”: “Vérifier Webhook”,<br />”type”: “n8n-nodes-base.readBinaryFile”,<br />”value1”: “={{$json.errorMessage}}”,<br />”operation”: “exists”<br />”name”: “Webhook Existe?”,<br />”position”: [700, 300]<br />”name”: “status”,<br />”value”: “missing”<br />”name”: “message”,<br />”value”: “=Le webhook pour l’intégration {{$json.source}} -&gt; {{$json.target}} n’existe pas”<br />”name”: “Webhook Manquant”,<br />”value”: “exists”<br />”value”: “=Le webhook pour l’intégration {{$json.source}} -&gt; {{$json.target}} existe”<br />”name”: “Webhook Existe”,<br />”value1”: “={{$json.status}}”,<br />”value2”: “missing”<br />”name”: “Action Nécessaire?”,<br />”position”: [1100, 300]<br />”chatId”: “{{$env.TELEGRAM_CHAT_ID}}”,<br />”text”: “=⚠️ ALERTE POINT D’INTÉGRATION\n\nLe point d’intégration {{$json.source}} -&gt; {{$json.target}} ({{$json.path}}) nécessite une action:\n- Statut: {{$json.status}}\n- Message: {{$json.message}}\n\nVeuillez exécuter WF-WEBHOOK-MANAGER pour créer ce webhook.”,<br />”additionalFields”: {}<br />”name”: “Envoyer Alerte”,<br />”type”: “n8n-nodes-base.telegram”,<br />”position”: [1300, 200]<br />],<br />”connections”: {<br />”Déclencheur Cron”: {<br />”main”: [<br />[<br />”node”: “Définir Points d’Intégration”,<br />”type”: “main”,<br />”index”: 0<br />”Définir Points d’Intégration”: {<br />”node”: “Vérifier Webhook”,<br />”Vérifier Webhook”: {<br />”node”: “Webhook Existe?”,<br />”Webhook Existe?”: {<br />”node”: “Webhook Manquant”,<br />”node”: “Webhook Existe”,<br />”Webhook Manquant”: {<br />”node”: “Action Nécessaire?”,<br />”Webhook Existe”: {<br />”Action Nécessaire?”: {<br />”node”: “Envoyer Alerte”,<br />[]</p>
</li>
</ul>
</section>
<section id="diagramme-ascii-des-points-d-integration">
<h4>Diagramme ASCII des Points d’Intégration<a class="headerlink" href="#diagramme-ascii-des-points-d-integration" title="Link to this heading"></a></h4>
<p>┌─────────────────────────────────────────────────────────────────────────┐<br />│                                                                         │<br />│                    ARCHITECTURE DES POINTS D’INTÉGRATION                │<br />│                                                                         │<br />│  ┌─────────────┐                                     ┌─────────────┐    │<br />│  │  PILIER 1   │◄────────────────────────────────────┤  PILIER 4   │    │<br />│  │  Données    │                                     │ Interfaces  │    │<br />│  │ Stratégiques│                                     │ Utilisateur │    │<br />│  └─────────────┘                                     └─────────────┘    │<br />│        │                                                    ▲           │<br />│        │                                                    │           │<br />│        │                                                    │           │<br />│        │                                                    │           │<br />│        ▼                                                    │           │<br />│  ┌─────────────┐                                     ┌─────────────┐    │<br />│  │  PILIER 2   │                                     │  PILIER 3   │    │<br />│  │  Processus  │────────────────────────────────────►│ Intelligence│    │<br />│  │ Automatisés │                                     │  Augmentée  │    │<br />│  └─────────────┘                                     └─────────────┘    │<br />│                                                                         │<br />└─────────────────────────────────────────────────────────────────────────┘</p>
</section>
<section id="mise-en-place-du-systeme-de-configuration-centralise-a-name-section-1-3-3-a">
<h4>1.3.3. Mise en Place du Système de Configuration Centralisé <a name='section-1-3-3'></a><a class="headerlink" href="#mise-en-place-du-systeme-de-configuration-centralise-a-name-section-1-3-3-a" title="Link to this heading"></a></h4>
</section>
<section id="id2">
<h4>Workflows à Développer<a class="headerlink" href="#id2" title="Link to this heading"></a></h4>
<ol class="simple">
<li><p>WF-CORE-CONFIG-CENTRAL</p>
<ul class="simple">
<li><p>Objectif: Créer un système de configuration centralisé pour tous les piliers</p></li>
<li><p>Structure JSON:</p></li>
</ul>
</li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WF-CORE-CONFIG-CENTRAL&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;nodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;core-config&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;responseMode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;onReceived&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;options&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span>
<span class="w">      </span><span class="p">},</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Webhook&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;n8n-nodes-base.webhook&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;position&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">]</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;functionCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;// Validation des paramètres d&#39;entrée\nconst input = $input.item.json;\n\n// Vérifier les paramètres requis\nif (!input.configType) {\n  throw new Error(&#39;Le paramètre configType est requis&#39;);\n}\n\n// Déterminer le type de configuration demandé\nconst configType = input.configType.toLowerCase();\nconst configId = input.configId || &#39;default&#39;;\n\n// Retourner les informations pour le chargement de la configuration\nreturn {\n  json: {\n    configType,\n    configId,\n    configPath: `configs/${configType}/${configId}.json`,\n    timestamp: new Date().toISOString()\n  }\n};&quot;</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Valider Requête&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;n8n-nodes-base.function&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;position&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">]</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;={{$json.configPath}}&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;options&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">          </span><span class="nt">&quot;encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;utf8&quot;</span><span class="w">  </span>
<span class="w">        </span><span class="p">}</span><span class="w">  </span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Charger Configuration&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.readBinaryFile&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">300</span>\<span class="p">]</span>  
    <span class="s2">&quot;conditions&quot;</span><span class="p">:</span> <span class="p">{</span>  
      <span class="s2">&quot;string&quot;</span><span class="p">:</span> \<span class="p">[</span>  
          <span class="s2">&quot;value1&quot;</span><span class="p">:</span> <span class="s2">&quot;={{$json.errorMessage}}&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;operation&quot;</span><span class="p">:</span> <span class="s2">&quot;exists&quot;</span>  
      \<span class="p">]</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Config Existe?&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.if&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">700</span><span class="p">,</span> <span class="mi">300</span>\<span class="p">]</span>  
    <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">{</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;=Configuration non trouvée: {{$json.configPath}}&quot;</span>  
      \<span class="p">],</span>  
      <span class="s2">&quot;object&quot;</span><span class="p">:</span> \<span class="p">[</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>  
            <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="s2">&quot;CONFIG\_NOT\_FOUND&quot;</span><span class="p">,</span>  
            <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;La configuration demandée n&#39;existe pas&quot;</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Config Non Trouvée&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.set&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">900</span><span class="p">,</span> <span class="mi">200</span>\<span class="p">]</span>  
    <span class="s2">&quot;functionCode&quot;</span><span class="p">:</span> <span class="s2">&quot;// Traiter la configuration chargée</span><span class="se">\\</span><span class="s2">nconst configData \= $binary.data.toString();</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Tenter de parser le JSON</span><span class="se">\\</span><span class="s2">nlet parsedConfig;</span><span class="se">\\</span><span class="s2">ntry {</span><span class="se">\\</span><span class="s2">n  parsedConfig \= JSON.parse(configData);</span><span class="se">\\</span><span class="s2">n} catch (error) {</span><span class="se">\\</span><span class="s2">n  return {</span><span class="se">\\</span><span class="s2">n    json: {</span><span class="se">\\</span><span class="s2">n      status: &#39;error&#39;,</span><span class="se">\\</span><span class="s2">n      message: &#39;Erreur de parsing JSON&#39;,</span><span class="se">\\</span><span class="s2">n      error: {</span><span class="se">\\</span><span class="s2">n        code: &#39;INVALID\_JSON&#39;,</span><span class="se">\\</span><span class="s2">n        details: error.message</span><span class="se">\\</span><span class="s2">n      }</span><span class="se">\\</span><span class="s2">n    }</span><span class="se">\\</span><span class="s2">n  };</span><span class="se">\\</span><span class="s2">n}</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Ajouter des métadonnées</span><span class="se">\\</span><span class="s2">nparsedConfig.metadata \= {</span><span class="se">\\</span><span class="s2">n  loadedAt: new Date().toISOString(),</span><span class="se">\\</span><span class="s2">n  configPath: $input.item.json.configPath,</span><span class="se">\\</span><span class="s2">n  configType: $input.item.json.configType,</span><span class="se">\\</span><span class="s2">n  configId: $input.item.json.configId</span><span class="se">\\</span><span class="s2">n};</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">nreturn {</span><span class="se">\\</span><span class="s2">n  json: {</span><span class="se">\\</span><span class="s2">n    status: &#39;success&#39;,</span><span class="se">\\</span><span class="s2">n    message: &#39;Configuration chargée avec succès&#39;,</span><span class="se">\\</span><span class="s2">n    config: parsedConfig</span><span class="se">\\</span><span class="s2">n  }</span><span class="se">\\</span><span class="s2">n};&quot;</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Traiter Configuration&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">900</span><span class="p">,</span> <span class="mi">400</span>\<span class="p">]</span>  
    <span class="s2">&quot;keepOnlySet&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;notionDatabaseId\_contacts&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;={{$json.config.notionDatabases ? $json.config.notionDatabases.find(db \=\&gt; db.name \=== &#39;Agence\_Contacts&#39;).id : $env.NOTION\_DB\_CONTACTS}}&quot;</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;notionDatabaseId\_artistes&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;={{$json.config.notionDatabases ? $json.config.notionDatabases.find(db \=\&gt; db.name \=== &#39;Agence\_Artistes&#39;).id : $env.NOTION\_DB\_ARTISTES}}&quot;</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;gDriveFolderId\_agence&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;={{$json.config.gDriveFolders ? $json.config.gDriveFolders.find(folder \=\&gt; folder.name \=== &#39;Agence&#39;).id : $env.GDRIVE\_FOLDER\_AGENCE}}&quot;</span>  
      <span class="s2">&quot;number&quot;</span><span class="p">:</span> \<span class="p">[</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;delayBetweenEmails\_minutes&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;={{$json.config.emailSettings ? $json.config.emailSettings.delayBetweenEmails : 5}}&quot;</span>  
      <span class="s2">&quot;boolean&quot;</span><span class="p">:</span> \<span class="p">[</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;useAI\_forEmailGeneration&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;={{$json.config.aiSettings ? $json.config.aiSettings.useForEmailGeneration : true}}&quot;</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;configMetadata&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;={{$json.config.metadata || </span><span class="si">{}</span><span class="s2">}}&quot;</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Extraire Variables Config&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">400</span>\<span class="p">]</span>  
</pre></div>
</div>
<p>“connections”: {<br />”Webhook”: {<br />”main”: [<br />[<br />”node”: “Valider Requête”,<br />”type”: “main”,<br />”index”: 0<br />”Valider Requête”: {<br />”node”: “Charger Configuration”,<br />”Charger Configuration”: {<br />”node”: “Config Existe?”,<br />”Config Existe?”: {<br />”node”: “Config Non Trouvée”,<br />”node”: “Traiter Configuration”,<br />”Traiter Configuration”: {<br />”node”: “Extraire Variables Config”,</p>
<p>2.WF-CONFIG-UPDATER</p>
<ul>
<li><p>Objectif: Permettre la mise à jour des configurations centralisées</p>
<p>“name”: “WF-CONFIG-UPDATER”,<br />”triggerTimes”: {<br />”item”: [<br />”mode”: “manual”<br />”name”: “Déclencheur Manuel”,<br />”type”: “n8n-nodes-base.manualTrigger”,<br />”name”: “configType”,<br />”value”: “==$input.item.json.configType || ‘piliers’”<br />”name”: “configId”,<br />”value”: “==$input.item.json.configId || ‘PILIER_1’”<br />”name”: “configData”,<br />”value”: “==$input.item.json.configData || {}”<br />”name”: “Configuration Entrée”,<br />”path”: “configs/{{$json.configType}}/{{$json.configId}}.json”,<br />”name”: “Vérifier Config Existante”,<br />”functionCode”: “// Création d’une nouvelle configuration\nconst configType = $input.item.json.configType;\nconst configId = $input.item.json.configId;\nconst configData = $input.item.json.configData;\n\n// Ajouter des métadonnées\nconst newConfig = {\n  …configData,\n  metadata: {\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n    configType,\n    configId,\n    version: ‘1.0.0’\n  }\n};\n\n// Convertir en JSON formaté\nconst configJson = JSON.stringify(newConfig, null, 2);\n\nreturn {\n  json: {\n    configType,\n    configId,\n    action: ‘create’,\n    config: newConfig\n  },\n  binary: {\n    data: {\n      mimeType: ‘application/json’,\n      data: Buffer.from(configJson).toString(’base64’),\n      fileName: `${configId}.json`\n    }\n  }\n};”<br />”name”: “Créer Nouvelle Config”,<br />”functionCode”: “// Mise à jour d’une configuration existante\nconst configType = $input.item.json.configType;\nconst configId = $input.item.json.configId;\nconst configData = $input.item.json.configData;\n\n// Charger la configuration existante\nconst existingConfigStr = $binary.data.toString();\nlet existingConfig;\n\ntry {\n  existingConfig = JSON.parse(existingConfigStr);\n} catch (error) {\n  // Si le parsing échoue, créer une nouvelle configuration\n  existingConfig = {};\n}\n\n// Fusionner avec les nouvelles données\nconst updatedConfig = {\n  …existingConfig,\n  …configData,\n  metadata: {\n    …existingConfig.metadata,\n    updatedAt: new Date().toISOString(),\n    previousVersion: existingConfig.metadata?.version || ‘0.0.0’,\n    version: existingConfig.metadata?.version ? incrementVersion(existingConfig.metadata.version) : ‘1.0.0’\n  }\n};\n\n// Fonction pour incrémenter la version\nfunction incrementVersion(version) {\n  const parts = version.split(’.’);\n  parts[2] = (parseInt(parts[2]) + 1).toString();\n  return parts.join(’.’);\n}\n\n// Convertir en JSON formaté\nconst configJson = JSON.stringify(updatedConfig, null, 2);\n\nreturn {\n  json: {\n    configType,\n    configId,\n    action: ‘update’,\n    config: updatedConfig\n  },\n  binary: {\n    data: {\n      mimeType: ‘application/json’,\n      data: Buffer.from(configJson).toString(’base64’),\n      fileName: `${configId}.json`\n    }\n  }\n};”<br />”name”: “Mettre à Jour Config”,<br />”name”: “Sauvegarder Config”,<br />”type”: “n8n-nodes-base.writeBinaryFile”,<br />”position”: [1100, 300]<br />”value”: “success”<br />”value”: “=Configuration {{$json.configId}} {{$json.action === ‘create’ ? ‘créée’ : ‘mise à jour’}} avec succès”<br />”name”: “Résultat”,<br />”position”: [1300, 300]<br />”Déclencheur Manuel”: {<br />”node”: “Configuration Entrée”,<br />”Configuration Entrée”: {<br />”node”: “Vérifier Config Existante”,<br />”Vérifier Config Existante”: {<br />”node”: “Créer Nouvelle Config”,<br />”node”: “Mettre à Jour Config”,<br />”Créer Nouvelle Config”: {<br />”node”: “Sauvegarder Config”,<br />”Mettre à Jour Config”: {<br />”Sauvegarder Config”: {<br />”node”: “Résultat”,</p>
</li>
</ul>
</section>
<section id="diagramme-ascii-du-systeme-de-configuration-centralise">
<h4>Diagramme ASCII du Système de Configuration Centralisé<a class="headerlink" href="#diagramme-ascii-du-systeme-de-configuration-centralise" title="Link to this heading"></a></h4>
<p>┌─────────────────────────────────────────────────────────────────────────┐<br />│                                                                         │<br />│                SYSTÈME DE CONFIGURATION CENTRALISÉ                      │<br />│                                                                         │<br />│  ┌─────────────────────┐                                                │<br />│  │                     │                                                │<br />│  │  WF-CONFIG-UPDATER  │◄───────┐                                       │<br />│  │                     │        │                                       │<br />│  └─────────────────────┘        │                                       │<br />│            │                    │                                       │<br />│            ▼                    │                                       │<br />│  ┌─────────────────────┐        │                                       │<br />│  │                     │        │                                       │<br />│  │  FICHIERS CONFIG    │        │                                       │<br />│  │                     │        │                                       │<br />│  └─────────────────────┘        │                                       │<br />│            │                    │                                       │<br />│            ▼                    │                                       │<br />│  ┌─────────────────────┐        │                                       │<br />│  │                     │        │                                       │<br />│  │ WF-CORE-CONFIG-     │        │                                       │<br />│  │     CENTRAL         │        │                                       │<br />│  │                     │        │                                       │<br />│  └─────────────────────┘        │                                       │<br />│            │                    │                                       │<br />│            ▼                    │                                       │<br />│  ┌─────────────────────┐        │                                       │<br />│  │                     │        │                                       │<br />│  │  PILIERS            │────────┘                                       │<br />│  │                     │                                                │<br />│  └─────────────────────┘                                                │<br />│                                                                         │<br />└─────────────────────────────────────────────────────────────────────────┘</p>
</section>
</section>
<section id="etape-3-2-migration-des-fonctionnalites-existantes-a-name-section-1-4-a">
<h3>1.4. Étape 3.2: Migration des Fonctionnalités Existantes <a name='section-1-4'></a><a class="headerlink" href="#etape-3-2-migration-des-fonctionnalites-existantes-a-name-section-1-4-a" title="Link to this heading"></a></h3>
<section id="cartographie-des-fonctionnalites-a-name-section-1-4-1-a">
<h4>1.4.1. Cartographie des Fonctionnalités <a name='section-1-4-1'></a><a class="headerlink" href="#cartographie-des-fonctionnalites-a-name-section-1-4-1-a" title="Link to this heading"></a></h4>
</section>
<section id="id3">
<h4>Workflows à Développer<a class="headerlink" href="#id3" title="Link to this heading"></a></h4>
<ol class="simple">
<li><p>WF-FUNCTIONALITY-MAPPER</p>
<ul class="simple">
<li><p>Objectif: Cartographier les fonctionnalités existantes et les associer aux piliers du Plan Magistral V5</p></li>
<li><p>Structure JSON:</p></li>
</ul>
</li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WF-FUNCTIONALITY-MAPPER&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;nodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;triggerTimes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">          </span><span class="nt">&quot;item&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">              </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manual&quot;</span><span class="w">  </span>
<span class="w">            </span><span class="p">}</span><span class="w">  </span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      \<span class="p">]</span>  
  <span class="p">},</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Déclencheur Manuel&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.manualTrigger&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">300</span>\<span class="p">]</span>  
<span class="s2">&quot;functionCode&quot;</span><span class="p">:</span> <span class="s2">&quot;// Définir les fonctionnalités existantes</span><span class="se">\\</span><span class="s2">nconst existingFunctionalities \= \[</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    id: &#39;email\_generation&#39;,</span><span class="se">\\</span><span class="s2">n    name: &#39;Génération d</span><span class="se">\\\\</span><span class="s2">&#39;Emails&#39;,</span><span class="se">\\</span><span class="s2">n    description: &#39;Génération d</span><span class="se">\\\\</span><span class="s2">&#39;emails personnalisés avec l</span><span class="se">\\\\</span><span class="s2">&#39;IA&#39;,</span><span class="se">\\</span><span class="s2">n    currentWorkflow: &#39;EMAIL\_SENDER\_1&#39;,</span><span class="se">\\</span><span class="s2">n    currentPhase: &#39;Phase 2&#39;,</span><span class="se">\\</span><span class="s2">n    dependencies: \[&#39;notion\_contacts&#39;, &#39;openrouter\_ai&#39;\]</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    id: &#39;email\_sending&#39;,</span><span class="se">\\</span><span class="s2">n    name: &#39;Envoi d</span><span class="se">\\\\</span><span class="s2">&#39;Emails&#39;,</span><span class="se">\\</span><span class="s2">n    description: &#39;Envoi d</span><span class="se">\\\\</span><span class="s2">&#39;emails via Gmail&#39;,</span><span class="se">\\</span><span class="s2">n    currentWorkflow: &#39;EMAIL\_SENDER\_1&#39;,</span><span class="se">\\</span><span class="s2">n    currentPhase: &#39;Phase 3&#39;,</span><span class="se">\\</span><span class="s2">n    dependencies: \[&#39;gmail\_api&#39;\]</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    id: &#39;response\_analysis&#39;,</span><span class="se">\\</span><span class="s2">n    name: &#39;Analyse des Réponses&#39;,</span><span class="se">\\</span><span class="s2">n    description: &#39;Analyse des réponses aux emails avec l</span><span class="se">\\\\</span><span class="s2">&#39;IA&#39;,</span><span class="se">\\</span><span class="s2">n    currentWorkflow: &#39;EMAIL\_SENDER\_1&#39;,</span><span class="se">\\</span><span class="s2">n    currentPhase: &#39;Phase 4&#39;,</span><span class="se">\\</span><span class="s2">n    dependencies: \[&#39;gmail\_api&#39;, &#39;openrouter\_ai&#39;\]</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    id: &#39;calendar\_management&#39;,</span><span class="se">\\</span><span class="s2">n    name: &#39;Gestion du Calendrier&#39;,</span><span class="se">\\</span><span class="s2">n    description: &#39;Création et gestion des événements dans Google Calendar&#39;,</span><span class="se">\\</span><span class="s2">n    currentWorkflow: &#39;EMAIL\_SENDER\_1&#39;,</span><span class="se">\\</span><span class="s2">n    currentPhase: &#39;Phase 5&#39;,</span><span class="se">\\</span><span class="s2">n    dependencies: \[&#39;google\_calendar\_api&#39;\]</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    id: &#39;notion\_update&#39;,</span><span class="se">\\</span><span class="s2">n    name: &#39;Mise à Jour Notion&#39;,</span><span class="se">\\</span><span class="s2">n    description: &#39;Mise à jour des bases de données Notion&#39;,</span><span class="se">\\</span><span class="s2">n    currentWorkflow: &#39;EMAIL\_SENDER\_1&#39;,</span><span class="se">\\</span><span class="s2">n    currentPhase: &#39;Phase 6&#39;,</span><span class="se">\\</span><span class="s2">n    dependencies: \[&#39;notion\_api&#39;\]</span><span class="se">\\</span><span class="s2">n  }</span><span class="se">\\</span><span class="s2">n\];</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Définir les piliers du Plan Magistral V5</span><span class="se">\\</span><span class="s2">nconst magistralPillars \= \[</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    id: &#39;PILIER\_1&#39;,</span><span class="se">\\</span><span class="s2">n    name: &#39;La Donnée Stratégique&#39;,</span><span class="se">\\</span><span class="s2">n    description: &#39;Centralisée, Structurée, Validée, Sécurisée et Accessible&#39;</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    id: &#39;PILIER\_2&#39;,</span><span class="se">\\</span><span class="s2">n    name: &#39;Les Processus Automatisés&#39;,</span><span class="se">\\</span><span class="s2">n    description: &#39;Workflows N8N optimisés et modulaires&#39;</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    id: &#39;PILIER\_3&#39;,</span><span class="se">\\</span><span class="s2">n    name: &#39;L</span><span class="se">\\\\</span><span class="s2">&#39;Intelligence Augmentée&#39;,</span><span class="se">\\</span><span class="s2">n    description: &#39;Intégration des équipes IA via OpenRouter&#39;</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    id: &#39;PILIER\_4&#39;,</span><span class="se">\\</span><span class="s2">n    name: &#39;Les Interfaces Utilisateur&#39;,</span><span class="se">\\</span><span class="s2">n    description: &#39;CMS et interfaces de gestion&#39;</span><span class="se">\\</span><span class="s2">n  }</span><span class="se">\\</span><span class="s2">n\];</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Cartographier les fonctionnalités vers les piliers</span><span class="se">\\</span><span class="s2">nconst functionalityMapping \= \[</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    functionalityId: &#39;email\_generation&#39;,</span><span class="se">\\</span><span class="s2">n    primaryPillarId: &#39;PILIER\_3&#39;,</span><span class="se">\\</span><span class="s2">n    secondaryPillarIds: \[&#39;PILIER\_2&#39;\],</span><span class="se">\\</span><span class="s2">n    migrationComplexity: &#39;medium&#39;,</span><span class="se">\\</span><span class="s2">n    migrationPriority: &#39;high&#39;</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    functionalityId: &#39;email\_sending&#39;,</span><span class="se">\\</span><span class="s2">n    primaryPillarId: &#39;PILIER\_2&#39;,</span><span class="se">\\</span><span class="s2">n    secondaryPillarIds: \[\],</span><span class="se">\\</span><span class="s2">n    migrationComplexity: &#39;low&#39;,</span><span class="se">\\</span><span class="s2">n    migrationPriority: &#39;high&#39;</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    functionalityId: &#39;response\_analysis&#39;,</span><span class="se">\\</span><span class="s2">n    primaryPillarId: &#39;PILIER\_3&#39;,</span><span class="se">\\</span><span class="s2">n    secondaryPillarIds: \[&#39;PILIER\_2&#39;\],</span><span class="se">\\</span><span class="s2">n    migrationComplexity: &#39;medium&#39;,</span><span class="se">\\</span><span class="s2">n    migrationPriority: &#39;medium&#39;</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    functionalityId: &#39;calendar\_management&#39;,</span><span class="se">\\</span><span class="s2">n    primaryPillarId: &#39;PILIER\_2&#39;,</span><span class="se">\\</span><span class="s2">n    secondaryPillarIds: \[&#39;PILIER\_1&#39;\],</span><span class="se">\\</span><span class="s2">n    migrationComplexity: &#39;low&#39;,</span><span class="se">\\</span><span class="s2">n    migrationPriority: &#39;high&#39;</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  {</span><span class="se">\\</span><span class="s2">n    functionalityId: &#39;notion\_update&#39;,</span><span class="se">\\</span><span class="s2">n    primaryPillarId: &#39;PILIER\_1&#39;,</span><span class="se">\\</span><span class="s2">n    secondaryPillarIds: \[&#39;PILIER\_2&#39;\],</span><span class="se">\\</span><span class="s2">n    migrationComplexity: &#39;medium&#39;,</span><span class="se">\\</span><span class="s2">n    migrationPriority: &#39;high&#39;</span><span class="se">\\</span><span class="s2">n  }</span><span class="se">\\</span><span class="s2">n\];</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Enrichir les fonctionnalités avec les informations de mapping</span><span class="se">\\</span><span class="s2">nconst enrichedFunctionalities \= existingFunctionalities.map(func \=\&gt; {</span><span class="se">\\</span><span class="s2">n  const mapping \= functionalityMapping.find(map \=\&gt; map.functionalityId \=== func.id);</span><span class="se">\\</span><span class="s2">n  if (\!mapping) return func;</span><span class="se">\\</span><span class="s2">n  </span><span class="se">\\</span><span class="s2">n  const primaryPillar \= magistralPillars.find(pillar \=\&gt; pillar.id \=== mapping.primaryPillarId);</span><span class="se">\\</span><span class="s2">n  const secondaryPillars \= mapping.secondaryPillarIds.map(id \=\&gt; </span><span class="se">\\</span><span class="s2">n    magistralPillars.find(pillar \=\&gt; pillar.id \=== id)</span><span class="se">\\</span><span class="s2">n  ).filter(Boolean);</span><span class="se">\\</span><span class="s2">n  </span><span class="se">\\</span><span class="s2">n  return {</span><span class="se">\\</span><span class="s2">n    ...func,</span><span class="se">\\</span><span class="s2">n    mapping: {</span><span class="se">\\</span><span class="s2">n      primaryPillar: primaryPillar || null,</span><span class="se">\\</span><span class="s2">n      secondaryPillars,</span><span class="se">\\</span><span class="s2">n      migrationComplexity: mapping.migrationComplexity,</span><span class="se">\\</span><span class="s2">n      migrationPriority: mapping.migrationPriority</span><span class="se">\\</span><span class="s2">n    }</span><span class="se">\\</span><span class="s2">n  };</span><span class="se">\\</span><span class="s2">n});</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">nreturn enrichedFunctionalities.map(func \=\&gt; ({ json: func }));&quot;</span>  
</pre></div>
</div>
<p>“name”: “Cartographier Fonctionnalités”,<br />”type”: “n8n-nodes-base.function”,<br />”position”: [300, 300]<br />”functionCode”: “// Générer un rapport de cartographie\nconst functionality = $input.item.json;\nconst primaryPillar = functionality.mapping?.primaryPillar;\nconst secondaryPillars = functionality.mapping?.secondaryPillars || [];\n\n// Formater le rapport\nconst report = {\n  functionalityId: functionality.id,\n  functionalityName: functionality.name,\n  description: functionality.description,\n  currentLocation: `${functionality.currentWorkflow} (${functionality.currentPhase})`,\n  dependencies: functionality.dependencies.join(’, ‘),\n  targetPillar: primaryPillar ? primaryPillar.name : ‘Non assigné’,\n  secondaryPillars: secondaryPillars.map(p =&gt; p.name).join(’, ‘) || ‘Aucun’,\n  migrationComplexity: functionality.mapping?.migrationComplexity || ‘Non évalué’,\n  migrationPriority: functionality.mapping?.migrationPriority || ‘Non évalué’\n};\n\nreturn {\n  json: report\n};”<br />”name”: “Générer Rapport”,<br />”position”: [500, 300]<br />”operation”: “append”,<br />”file”: “reports/functionality_mapping.csv”,<br />”options”: {<br />”columns”: {<br />”column1”: “functionalityId”,<br />”column2”: “functionalityName”,<br />”column3”: “description”,<br />”column4”: “currentLocation”,<br />”column5”: “dependencies”,<br />”column6”: “targetPillar”,<br />”column7”: “secondaryPillars”,<br />”column8”: “migrationComplexity”,<br />”column9”: “migrationPriority”<br />”fileName”: “functionality_mapping.csv”<br />”name”: “Sauvegarder en CSV”,<br />”type”: “n8n-nodes-base.spreadsheetFile”,<br />”position”: [700, 300]<br />”path”: “reports/functionality_mapping.md”,<br />”options”: {}<br />”name”: “Lire Rapport Markdown”,<br />”type”: “n8n-nodes-base.readBinaryFile”,<br />”position”: [900, 300]<br />”conditions”: {<br />”string”: [<br />”value1”: “={{$json.errorMessage}}”,<br />”operation”: “exists”<br />”name”: “Rapport Existe?”,<br />”type”: “n8n-nodes-base.if”,<br />”position”: [1100, 300]<br />”functionCode”: “// Créer un nouveau rapport Markdown\nconst reports = $input.all.map(item =&gt; item.json);\n\n// En-tête du rapport\nlet markdownContent = `# Cartographie des Fonctionnalités vers le Plan Magistral V5\n\n_Généré le ${new Date().toLocaleString(’fr-FR’)}_\n\n## Vue d’ensemble\n\nCe document présente la cartographie des fonctionnalités existantes du workflow Email Sender vers les piliers du Plan Magistral V5.\n\n## Tableau de Cartographie\n\n| Fonctionnalité | Description | Emplacement Actuel | Dépendances | Pilier Principal | Piliers Secondaires | Complexité | Priorité |\n|—————-|————-|——————-|————-|—————–|———————|————|———-|\n`;\n\n// Ajouter chaque fonctionnalité\nreports.forEach(report =&gt; {\n  markdownContent += `| ${report.functionalityName} | ${report.description} | ${report.currentLocation} | ${report.dependencies} | ${report.targetPillar} | ${report.secondaryPillars} | ${report.migrationComplexity} | ${report.migrationPriority} |\\n`;\n});\n\n// Ajouter des sections supplémentaires\nmarkdownContent += `\n\n## Analyse des Chevauchements\n\nCertaines fonctionnalités chevauchent plusieurs piliers :\n\n`;\n\n// Identifier les fonctionnalités avec des piliers secondaires\nconst overlappingFuncs = reports.filter(r =&gt; r.secondaryPillars &amp;&amp; r.secondaryPillars !== ‘Aucun’);\noverlappingFuncs.forEach(func =&gt; {\n  markdownContent += `- **${func.functionalityName}** : Principalement dans ${func.targetPillar}, mais aussi dans ${func.secondaryPillars}\\n`;\n});\n\n// Ajouter une section sur la séquence de migration\nmarkdownContent += `\n\n## Séquence de Migration Recommandée\n\n`;\n\n// Trier par priorité et complexité\nconst sortedByPriority = […reports].sort((a, b) =&gt; {\n  const priorityOrder = { high: 0, medium: 1, low: 2, ‘Non évalué’: 3 };\n  const complexityOrder = { low: 0, medium: 1, high: 2, ‘Non évalué’: 3 };\n  \n  if (priorityOrder[a.migrationPriority] !== priorityOrder[b.migrationPriority]) {\n    return priorityOrder[a.migrationPriority] - priorityOrder[b.migrationPriority];\n  }\n  \n  return complexityOrder[a.migrationComplexity] - complexityOrder[b.migrationComplexity];\n});\n\n// Ajouter la séquence recommandée\nmarkdownContent += `1. **Phase 1 : Fonctionnalités Prioritaires et Simples**\\n`;\nsortedByPriority\n  .filter(r =&gt; r.migrationPriority === ‘high’ &amp;&amp; r.migrationComplexity === ‘low’)\n  .forEach((r, i) =&gt; markdownContent += `   ${i+1}. ${r.functionalityName} (${r.targetPillar})\\n`);\n\nmarkdownContent += `\\n2. **Phase 2 : Fonctionnalités Prioritaires mais Complexes**\\n`;\nsortedByPriority\n  .filter(r =&gt; r.migrationPriority === ‘high’ &amp;&amp; r.migrationComplexity !== ‘low’)\n  .forEach((r, i) =&gt; markdownContent += `   ${i+1}. ${r.functionalityName} (${r.targetPillar})\\n`);\n\nmarkdownContent += `\\n3. **Phase 3 : Fonctionnalités Restantes**\\n`;\nsortedByPriority\n  .filter(r =&gt; r.migrationPriority !== ‘high’)\n  .forEach((r, i) =&gt; markdownContent += `   ${i+1}. ${r.functionalityName} (${r.targetPillar})\\n`);\n\nreturn {\n  json: {\n    markdownContent\n  },\n  binary: {\n    data: {\n      mimeType: ‘text/markdown’,\n      data: Buffer.from(markdownContent).toString(’base64’),\n      fileName: ‘functionality_mapping.md’\n    }\n  }\n};”<br />”name”: “Créer Rapport Markdown”,<br />”position”: [1300, 200]<br />”functionCode”: “// Mettre à jour le rapport Markdown existant\nconst existingReport = $binary.data.toString();\nconst reports = $input.all.map(item =&gt; item.json);\n\n// Extraire l’en-tête et les sections existantes\nconst headerMatch = existingReport.match(/^([\\s\\S]*?## Tableau de Cartographie)/m);\nconst header = headerMatch ? headerMatch[1] : ‘’;\n\n// Créer le nouveau tableau\nlet tableContent = `\n\n| Fonctionnalité | Description | Emplacement Actuel | Dépendances | Pilier Principal | Piliers Secondaires | Complexité | Priorité |\n|—————-|————-|——————-|————-|—————–|———————|————|———-|\n`;\n\n// Ajouter chaque fonctionnalité\nreports.forEach(report =&gt; {\n  tableContent += `| ${report.functionalityName} | ${report.description} | ${report.currentLocation} | ${report.dependencies} | ${report.targetPillar} | ${report.secondaryPillars} | ${report.migrationComplexity} | ${report.migrationPriority} |\\n`;\n});\n\n// Recréer les sections d’analyse\nlet analysisContent = `\n\n## Analyse des Chevauchements\n\nCertaines fonctionnalités chevauchent plusieurs piliers :\n\n`;\n\n// Identifier les fonctionnalités avec des piliers secondaires\nconst overlappingFuncs = reports.filter(r =&gt; r.secondaryPillars &amp;&amp; r.secondaryPillars !== ‘Aucun’);\noverlappingFuncs.forEach(func =&gt; {\n  analysisContent += `- **${func.functionalityName}** : Principalement dans ${func.targetPillar}, mais aussi dans ${func.secondaryPillars}\\n`;\n});\n\n// Ajouter une section sur la séquence de migration\nlet sequenceContent = `\n\n## Séquence de Migration Recommandée\n\n`;\n\n// Trier par priorité et complexité\nconst sortedByPriority = […reports].sort((a, b) =&gt; {\n  const priorityOrder = { high: 0, medium: 1, low: 2, ‘Non évalué’: 3 };\n  const complexityOrder = { low: 0, medium: 1, high: 2, ‘Non évalué’: 3 };\n  \n  if (priorityOrder[a.migrationPriority] !== priorityOrder[b.migrationPriority]) {\n    return priorityOrder[a.migrationPriority] - priorityOrder[b.migrationPriority];\n  }\n  \n  return complexityOrder[a.migrationComplexity] - complexityOrder[b.migrationComplexity];\n});\n\n// Ajouter la séquence recommandée\nsequenceContent += `1. **Phase 1 : Fonctionnalités Prioritaires et Simples**\\n`;\nsortedByPriority\n  .filter(r =&gt; r.migrationPriority === ‘high’ &amp;&amp; r.migrationComplexity === ‘low’)\n  .forEach((r, i) =&gt; sequenceContent += `   ${i+1}. ${r.functionalityName} (${r.targetPillar})\\n`);\n\nsequenceContent += `\\n2. **Phase 2 : Fonctionnalités Prioritaires mais Complexes**\\n`;\nsortedByPriority\n  .filter(r =&gt; r.migrationPriority === ‘high’ &amp;&amp; r.migrationComplexity !== ‘low’)\n  .forEach((r, i) =&gt; sequenceContent += `   ${i+1}. ${r.functionalityName} (${r.targetPillar})\\n`);\n\nsequenceContent += `\\n3. **Phase 3 : Fonctionnalités Restantes**\\n`;\nsortedByPriority\n  .filter(r =&gt; r.migrationPriority !== ‘high’)\n  .forEach((r, i) =&gt; sequenceContent += `   ${i+1}. ${r.functionalityName} (${r.targetPillar})\\n`);\n\n// Ajouter une note de mise à jour\nconst updateNote = `\n\n—\n\n_Rapport mis à jour le ${new Date().toLocaleString(’fr-FR’)}_\n`;\n\n// Assembler le rapport final\nconst updatedReport = header + tableContent + analysisContent + sequenceContent + updateNote;\n\nreturn {\n  json: {\n    markdownContent: updatedReport\n  },\n  binary: {\n    data: {\n      mimeType: ‘text/markdown’,\n      data: Buffer.from(updatedReport).toString(’base64’),\n      fileName: ‘functionality_mapping.md’\n    }\n  }\n};”<br />”name”: “Mettre à Jour Rapport”,<br />”position”: [1300, 400]<br />”name”: “Sauvegarder Rapport”,<br />”type”: “n8n-nodes-base.writeBinaryFile”,<br />”position”: [1500, 300]</p>
<p>2.WF-DEPENDENCY-ANALYZER</p>
<ul>
<li><p>Objectif: Analyser les dépendances entre les fonctionnalités pour planifier la séquence de migration</p>
<p>“name”: “WF-DEPENDENCY-ANALYZER”,<br />”encoding”: “utf8”<br />”name”: “Charger Cartographie”,<br />”functionCode”: “// Analyser les dépendances entre fonctionnalités\nconst reportContent = $binary.data.toString();\n\n// Extraire les informations du tableau\nconst tableRegex = /\\| ([^|]+) \\| [^|]+ \\| [^|]+ \\| ([^|]+) \\| ([^|]+) \\| [^|]+ \\| [^|]+ \\| [^|]+ \\|/g;\nlet match;\nconst functionalities = [];\n\nwhile ((match = tableRegex.exec(reportContent)) !== null) {\n  const functionalityName = match[1].trim();\n  if (functionalityName === ‘Fonctionnalité’) continue; // Skip header\n  \n  const dependencies = match[2].trim().split(’, ‘).map(d =&gt; d.trim());\n  const targetPillar = match[3].trim();\n  \n  functionalities.push({\n    name: functionalityName,\n    dependencies,\n    targetPillar\n  });\n}\n\n// Analyser les dépendances entre fonctionnalités\nconst dependencyGraph = {};\n\nfunctionalities.forEach(func =&gt; {\n  dependencyGraph[func.name] = {\n    targetPillar: func.targetPillar,\n    directDependencies: [],\n    indirectDependencies: []\n  };\n});\n\n// Identifier les dépendances directes\nfunctionalities.forEach(func =&gt; {\n  const funcDeps = func.dependencies;\n  \n  functionalities.forEach(otherFunc =&gt; {\n    if (func.name === otherFunc.name) return;\n    \n    // Vérifier si cette fonctionnalité dépend d’une ressource fournie par l’autre\n    const hasDirectDependency = funcDeps.some(dep =&gt; {\n      // Logique simplifiée - dans un cas réel, il faudrait une cartographie plus précise\n      // des ressources fournies par chaque fonctionnalité\n      if (dep === ‘notion_api’ &amp;&amp; otherFunc.name.includes(’Notion’)) return true;\n      if (dep === ‘gmail_api’ &amp;&amp; otherFunc.name.includes(’Email’)) return true;\n      if (dep === ‘google_calendar_api’ &amp;&amp; otherFunc.name.includes(’Calendrier’)) return true;\n      if (dep === ‘openrouter_ai’ &amp;&amp; otherFunc.name.includes(’IA’)) return true;\n      return false;\n    });\n    \n    if (hasDirectDependency) {\n      dependencyGraph[func.name].directDependencies.push(otherFunc.name);\n    }\n  });\n});\n\n// Identifier les dépendances indirectes (transitivité)\nfunctionalities.forEach(func =&gt; {\n  const visited = new Set();\n  const indirectDeps = new Set();\n  \n  function findIndirectDeps(funcName) {\n    if (visited.has(funcName)) return;\n    visited.add(funcName);\n    \n    const directDeps = dependencyGraph[funcName]?.directDependencies || [];\n    directDeps.forEach(dep =&gt; {\n      indirectDeps.add(dep);\n      findIndirectDeps(dep);\n    });\n  }\n  \n  findIndirectDeps(func.name);\n  dependencyGraph[func.name].indirectDependencies = Array.from(indirectDeps);\n});\n\n// Analyser les dépendances par pilier\nconst pillarDependencies = {};\n\nfunctionalities.forEach(func =&gt; {\n  const pillar = func.targetPillar;\n  if (!pillarDependencies[pillar]) {\n    pillarDependencies[pillar] = {\n      functionalities: [],\n      dependsOn: new Set(),\n      requiredBy: new Set()\n    };\n  }\n  \n  pillarDependencies[pillar].functionalities.push(func.name);\n});\n\n// Identifier les dépendances entre piliers\nObject.entries(dependencyGraph).forEach(([funcName, deps]) =&gt; {\n  const sourcePillar = deps.targetPillar;\n  \n  […deps.directDependencies, …deps.indirectDependencies].forEach(depFunc =&gt; {\n    const targetFunc = functionalities.find(f =&gt; f.name === depFunc);\n    if (!targetFunc) return;\n    \n    const targetPillar = targetFunc.targetPillar;\n    if (sourcePillar !== targetPillar) {\n      pillarDependencies[sourcePillar].dependsOn.add(targetPillar);\n      pillarDependencies[targetPillar].requiredBy.add(sourcePillar);\n    }\n  });\n});\n\n// Convertir les Sets en Arrays pour la sérialisation JSON\nObject.values(pillarDependencies).forEach(pillar =&gt; {\n  pillar.dependsOn = Array.from(pillar.dependsOn);\n  pillar.requiredBy = Array.from(pillar.requiredBy);\n});\n\nreturn {\n  json: {\n    functionalities: functionalities.length,\n    dependencyGraph,\n    pillarDependencies\n  }\n};”<br />”name”: “Analyser Dépendances”,</p>
<p>“functionCode”: “// Générer un rapport de dépendances\nconst analysis = $input.item.json;\n\n// Créer le contenu Markdown\nlet markdownContent = `# Analyse des Dépendances pour la Migration\n\n_Généré le ${new Date().toLocaleString(’fr-FR’)}_\n\n## Vue d’ensemble\n\nCe document présente l’analyse des dépendances entre les fonctionnalités et les piliers pour planifier la séquence de migration.\n\n## Dépendances entre Piliers\n\n`;\n\n// Ajouter les dépendances entre piliers\nObject.entries(analysis.pillarDependencies).forEach(([pillar, deps]) =&gt; {\n  markdownContent += `### ${pillar}\n\n`;\n  markdownContent += `- **Fonctionnalités** : ${deps.functionalities.join(’, ‘)}\\n`;\n  markdownContent += `- **Dépend de** : ${deps.dependsOn.length ? deps.dependsOn.join(’, ‘) : ‘Aucun’}\\n`;\n  markdownContent += `- **Requis par** : ${deps.requiredBy.length ? deps.requiredBy.join(’, ‘) : ‘Aucun’}\\n\\n`;\n});\n\n// Ajouter un diagramme ASCII des dépendances\nmarkdownContent += `## Diagramme de Dépendances\n\n\\`\\`\\`\n`;\n\n// Créer un diagramme ASCII simple\nconst pillars = Object.keys(analysis.pillarDependencies);\nconst pillarSymbols = {};\npillars.forEach((pillar, index) =&gt; {\n  pillarSymbols[pillar] = String.fromCharCode(65 + index); // A, B, C, D…\n});\n\n// Légende\nmarkdownContent += `Légende:\\n`;\nObject.entries(pillarSymbols).forEach(([pillar, symbol]) =&gt; {\n  markdownContent += `${symbol} = ${pillar}\\n`;\n});\nmarkdownContent += `\\n`;\n\n// Matrice de dépendances\nmarkdownContent += `Matrice de dépendances (ligne dépend de colonne):\\n\\n`;\nmarkdownContent += `    `;\npillars.forEach(pillar =&gt; {\n  markdownContent += `${pillarSymbols[pillar]} `;\n});\nmarkdownContent += `\\n`;\n\npillars.forEach(sourcePillar =&gt; {\n  markdownContent += `${pillarSymbols[sourcePillar]}   `;\n  pillars.forEach(targetPillar =&gt; {\n    const deps = analysis.pillarDependencies[sourcePillar];\n    const dependsOn = deps.dependsOn.includes(targetPillar);\n    markdownContent += dependsOn ? ‘X ‘ : ‘- ‘;\n  });\n  markdownContent += `\\n`;\n});\n\n// Graphe de dépendances\nmarkdownContent += `\\nGraphe de dépendances:\\n\\n`;\n\n// Créer un graphe ASCII simple\nconst graph = {};\npillars.forEach(pillar =&gt; {\n  graph[pillarSymbols[pillar]] = {\n    dependsOn: analysis.pillarDependencies[pillar].dependsOn.map(p =&gt; pillarSymbols[p])\n  };\n});\n\n// Dessiner le graphe\nObject.entries(graph).forEach(([symbol, node]) =&gt; {\n  markdownContent += `${symbol} `;\n  if (node.dependsOn.length) {\n    markdownContent += `—&gt; ${node.dependsOn.join(’, ‘)}\\n`;\n  } else {\n    markdownContent += `(indépendant)\\n`;\n  }\n});\n\nmarkdownContent += `\\`\\`\\`\n\n## Recommandations pour la Séquence de Migration\n\n`;\n\n// Déterminer l’ordre de migration basé sur les dépendances\nconst migrationOrder = [];\nconst visited = new Set();\n\nfunction visit(pillar) {\n  if (visited.has(pillar)) return;\n  visited.add(pillar);\n  \n  const deps = analysis.pillarDependencies[pillar].dependsOn;\n  deps.forEach(dep =&gt; visit(dep));\n  \n  migrationOrder.push(pillar);\n}\n\n// Visiter tous les piliers\npillars.forEach(pillar =&gt; {\n  if (!visited.has(pillar)) {\n    visit(pillar);\n  }\n});\n\n// Ajouter les recommandations\nmarkdownContent += `Basé sur l’analyse des dépendances, voici l’ordre de migration recommandé :\\n\\n`;\nmigrationOrder.forEach((pillar, index) =&gt; {\n  markdownContent += `${index + 1}. **${pillar}** - ${analysis.pillarDependencies[pillar].functionalities.length} fonctionnalités\\n`;\n});\n\nreturn {\n  json: {\n    markdownContent\n  },\n  binary: {\n    data: {\n      mimeType: ‘text/markdown’,\n      data: Buffer.from(markdownContent).toString(’base64’),\n      fileName: ‘dependency_analysis.md’\n    }\n  }\n};”<br />”name”: “Générer Rapport Markdown”,<br />”path”: “reports/dependency_analysis.md”,</p>
</li>
</ul>
</section>
<section id="diagramme-ascii-de-la-cartographie-des-fonctionnalites">
<h4>Diagramme ASCII de la Cartographie des Fonctionnalités<a class="headerlink" href="#diagramme-ascii-de-la-cartographie-des-fonctionnalites" title="Link to this heading"></a></h4>
<p>┌─────────────────────────────────────────────────────────────────────────┐<br />│                                                                         │<br />│                CARTOGRAPHIE DES FONCTIONNALITÉS                         │<br />│                                                                         │<br />│  ┌─────────────┐                                     ┌─────────────┐    │<br />│  │  PILIER 1   │                                     │  PILIER 4   │    │<br />│  │  Données    │◄────────┐                      ┌────┤ Interfaces  │    │<br />│  │ Stratégiques│         │                      │    │ Utilisateur │    │<br />│  └─────────────┘         │                      │    └─────────────┘    │<br />│        ▲                 │                      │                       │<br />│        │                 │                      │                       │<br />│        │                 │                      │                       │<br />│        │                 │                      │                       │<br />│        │                 │                      ▼                       │<br />│  ┌─────────────┐         │                 ┌─────────────┐              │<br />│  │  PILIER 2   │         │                 │  PILIER 3   │              │<br />│  │  Processus  │─────────┴────────────────►│ Intelligence│              │<br />│  │ Automatisés │                           │  Augmentée  │              │<br />│  └─────────────┘                           └─────────────┘              │<br />│                                                                         │<br />└─────────────────────────────────────────────────────────────────────────┘<br />LÉGENDE:<br />→ Dépendance principale<br />⟶ Dépendance secondaire</p>
</section>
<section id="migration-progressive-a-name-section-1-4-2-a">
<h4>1.4.2. Migration Progressive <a name='section-1-4-2'></a><a class="headerlink" href="#migration-progressive-a-name-section-1-4-2-a" title="Link to this heading"></a></h4>
</section>
<section id="id4">
<h4>Workflows à Développer<a class="headerlink" href="#id4" title="Link to this heading"></a></h4>
<ol class="simple">
<li><p>WF-MIGRATION-TEMPLATE-GENERATOR</p>
<ul class="simple">
<li><p>Objectif: Générer des templates de workflows pour la migration des fonctionnalités</p></li>
<li><p>Structure JSON:</p></li>
</ul>
</li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WF-MIGRATION-TEMPLATE-GENERATOR&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;nodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;triggerTimes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">          </span><span class="nt">&quot;item&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">              </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manual&quot;</span><span class="w">  </span>
<span class="w">            </span><span class="p">}</span><span class="w">  </span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      \]  
  },  
  &quot;name&quot;: &quot;Déclencheur Manuel&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.manualTrigger&quot;,  
  &quot;position&quot;: \[100, 300\]  
    &quot;values&quot;: {  
      &quot;string&quot;: \[  
          &quot;name&quot;: &quot;functionalityId&quot;,  
          &quot;value&quot;: &quot;==$input.item.json.functionalityId || &#39;email\_generation&#39;&quot;  
          &quot;name&quot;: &quot;targetPillar&quot;,  
          &quot;value&quot;: &quot;==$input.item.json.targetPillar || &#39;PILIER\_3&#39;&quot;  
  &quot;name&quot;: &quot;Configuration Entrée&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.set&quot;,  
  &quot;position&quot;: \[300, 300\]  
    &quot;path&quot;: &quot;reports/functionality\_mapping.md&quot;,  
    &quot;options&quot;: {  
      &quot;encoding&quot;: &quot;utf8&quot;  
  &quot;name&quot;: &quot;Charger Cartographie&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.readBinaryFile&quot;,  
  &quot;position&quot;: \[500, 300\]  
    &quot;functionCode&quot;: &quot;// Extraire les informations de la fonctionnalité\\nconst reportContent \= $binary.data.toString();\\nconst functionalityId \= $input.item.json.functionalityId;\\nconst targetPillar \= $input.item.json.targetPillar;\\n\\n// Extraire les informations du tableau\\nconst tableRegex \= /\\\\| (\[^|\]+) \\\\| (\[^|\]+) \\\\| (\[^|\]+) \\\\| (\[^|\]+) \\\\| (\[^|\]+) \\\\| (\[^|\]+) \\\\| (\[^|\]+) \\\\| (\[^|\]+) \\\\|/g;\\nlet match;\\nlet functionality \= null;\\n\\nwhile ((match \= tableRegex.exec(reportContent)) \!== null) {\\n  const name \= match\[1\].trim();\\n  if (name \=== &#39;Fonctionnalité&#39;) continue; // Skip header\\n  \\n  // Vérifier si c&#39;est la fonctionnalité recherchée\\n  if (name.toLowerCase().includes(functionalityId)) {\\n    functionality \= {\\n      name,\\n      description: match\[2\].trim(),\\n      currentLocation: match\[3\].trim(),\\n      dependencies: match\[4\].trim().split(&#39;, &#39;).map(d \=\&gt; d.trim()),\\n      targetPillar: match\[5\].trim(),\\n      secondaryPillars: match\[6\].trim(),\\n      complexity: match\[7\].trim(),\\n      priority: match\[8\].trim()\\n    };\\n    break;\\n  }\\n}\\n\\nif (\!functionality) {\\n  throw new Error(\`Fonctionnalité &#39;${functionalityId}&#39; non trouvée dans le rapport\`);\\n}\\n\\n// Vérifier si le pilier cible correspond\\nif (functionality.targetPillar \!== targetPillar) {\\n  console.log(\`Attention: Le pilier cible spécifié (${targetPillar}) ne correspond pas au pilier dans la cartographie (${functionality.targetPillar})\`);\\n}\\n\\nreturn {\\n  json: functionality\\n};&quot;  
  &quot;name&quot;: &quot;Extraire Fonctionnalité&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.function&quot;,  
  &quot;position&quot;: \[700, 300\]  
    &quot;functionCode&quot;: &quot;// Générer un template de workflow pour la migration\\nconst functionality \= $input.item.json;\\nconst targetPillar \= functionality.targetPillar;\\n\\n// Normaliser le nom pour l&#39;utiliser comme identifiant\\nconst normalizedName \= functionality.name\\n  .toLowerCase()\\n  .replace(/\[^a-z0-9\]+/g, &#39;\_&#39;)\\n  .replace(/^\_|\_$/g, &#39;&#39;);\\n\\n// Créer un template de workflow basé sur le pilier cible\\nlet workflowTemplate;\\n\\nswitch (targetPillar) {\\n  case &#39;PILIER\_1&#39;:\\n    workflowTemplate \= generatePilier1Template(functionality, normalizedName);\\n    break;\\n  case &#39;PILIER\_2&#39;:\\n    workflowTemplate \= generatePilier2Template(functionality, normalizedName);\\n    break;\\n  case &#39;PILIER\_3&#39;:\\n    workflowTemplate \= generatePilier3Template(functionality, normalizedName);\\n    break;\\n  case &#39;PILIER\_4&#39;:\\n    workflowTemplate \= generatePilier4Template(functionality, normalizedName);\\n    break;\\n  default:\\n    workflowTemplate \= generateGenericTemplate(functionality, normalizedName);\\n}\\n\\n// Fonction pour générer un template pour le Pilier 1 (Données Stratégiques)\\nfunction generatePilier1Template(functionality, normalizedName) {\\n  return {\\n    name: \`P1\_${normalizedName}\`,\\n    nodes: \[\\n      {\\n        parameters: {\\n          triggerTimes: {\\n            item: \[\\n              {\\n                mode: \\&quot;manual\\&quot;\\n              }\\n            \]\\n          }\\n        },\\n        name: \\&quot;Déclencheur Manuel\\&quot;,\\n        type: \\&quot;n8n-nodes-base.manualTrigger\\&quot;,\\n        position: \[100, 300\]\\n      },\\n      {\\n        parameters: {\\n          url: \\&quot;http://localhost:5678/webhook/core-config\\&quot;,\\n          options: {}\\n        },\\n        name: \\&quot;Charger Configuration\\&quot;,\\n        type: \\&quot;n8n-nodes-base.httpRequest\\&quot;,\\n        position: \[300, 300\]\\n      },\\n      {\\n        parameters: {\\n          authentication: \\&quot;notionApi\\&quot;,\\n          operation: \\&quot;getDatabases\\&quot;,\\n          returnAll: true\\n        },\\n        name: \\&quot;Notion\\&quot;,\\n        type: \\&quot;n8n-nodes-base.notion\\&quot;,\\n        position: \[500, 300\]\\n      },\\n      {\\n        parameters: {\\n          functionCode: \`// Code spécifique à ${functionality.name}\\\\nreturn $input.item;\`\\n        },\\n        name: \\&quot;Traitement Données\\&quot;,\\n        type: \\&quot;n8n-nodes-base.function\\&quot;,\\n        position: \[700, 300\]\\n      }\\n    \],\\n    connections: {\\n      \\&quot;Déclencheur Manuel\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Charger Configuration\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      },\\n      \\&quot;Charger Configuration\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Notion\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      },\\n      \\&quot;Notion\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Traitement Données\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      }\\n    }\\n  };\\n}\\n\\n// Fonction pour générer un template pour le Pilier 2 (Processus Automatisés)\\nfunction generatePilier2Template(functionality, normalizedName) {\\n  return {\\n    name: \`P2\_${normalizedName}\`,\\n    nodes: \[\\n      {\\n        parameters: {\\n          triggerTimes: {\\n            item: \[\\n              {\\n                mode: \\&quot;manual\\&quot;\\n              }\\n            \]\\n          }\\n        },\\n        name: \\&quot;Déclencheur Manuel\\&quot;,\\n        type: \\&quot;n8n-nodes-base.manualTrigger\\&quot;,\\n        position: \[100, 300\]\\n      },\\n      {\\n        parameters: {\\n          url: \\&quot;http://localhost:5678/webhook/core-config\\&quot;,\\n          options: {}\\n        },\\n        name: \\&quot;Charger Configuration\\&quot;,\\n        type: \\&quot;n8n-nodes-base.httpRequest\\&quot;,\\n        position: \[300, 300\]\\n      },\\n      {\\n        parameters: {\\n          functionCode: \`// Code spécifique à ${functionality.name}\\\\nreturn $input.item;\`\\n        },\\n        name: \\&quot;Logique Métier\\&quot;,\\n        type: \\&quot;n8n-nodes-base.function\\&quot;,\\n        position: \[500, 300\]\\n      },\\n      {\\n        parameters: {\\n          conditions: {\\n            string: \[\\n              {\\n                value1: \\&quot;={{$json.success}}\\&quot;,\\n                operation: \\&quot;equal\\&quot;,\\n                value2: \\&quot;true\\&quot;\\n              }\\n            \]\\n          }\\n        },\\n        name: \\&quot;Vérifier Résultat\\&quot;,\\n        type: \\&quot;n8n-nodes-base.if\\&quot;,\\n        position: \[700, 300\]\\n      },\\n      {\\n        parameters: {\\n          values: {\\n            string: \[\\n              {\\n                name: \\&quot;status\\&quot;,\\n                value: \\&quot;success\\&quot;\\n              }\\n            \]\\n          }\\n        },\\n        name: \\&quot;Succès\\&quot;,\\n        type: \\&quot;n8n-nodes-base.set\\&quot;,\\n        position: \[900, 200\]\\n      },\\n      {\\n        parameters: {\\n          values: {\\n            string: \[\\n              {\\n                name: \\&quot;status\\&quot;,\\n                value: \\&quot;error\\&quot;\\n              }\\n            \]\\n          }\\n        },\\n        name: \\&quot;Erreur\\&quot;,\\n        type: \\&quot;n8n-nodes-base.set\\&quot;,\\n        position: \[900, 400\]\\n      }\\n    \],\\n    connections: {\\n      \\&quot;Déclencheur Manuel\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Charger Configuration\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      },\\n      \\&quot;Charger Configuration\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Logique Métier\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      },\\n      \\&quot;Logique Métier\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Vérifier Résultat\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      },\\n      \\&quot;Vérifier Résultat\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Succès\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \],\\n          \[\\n            {\\n              node: \\&quot;Erreur\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      }\\n    }\\n  };\\n}\\n\\n// Fonction pour générer un template pour le Pilier 3 (Intelligence Augmentée)\\nfunction generatePilier3Template(functionality, normalizedName) {\\n  return {\\n    name: \`P3\_${normalizedName}\`,\\n    nodes: \[\\n      {\\n        parameters: {\\n          triggerTimes: {\\n            item: \[\\n              {\\n                mode: \\&quot;manual\\&quot;\\n              }\\n            \]\\n          }\\n        },\\n        name: \\&quot;Déclencheur Manuel\\&quot;,\\n        type: \\&quot;n8n-nodes-base.manualTrigger\\&quot;,\\n        position: \[100, 300\]\\n      },\\n      {\\n        parameters: {\\n          url: \\&quot;http://localhost:5678/webhook/core-config\\&quot;,\\n          options: {}\\n        },\\n        name: \\&quot;Charger Configuration\\&quot;,\\n        type: \\&quot;n8n-nodes-base.httpRequest\\&quot;,\\n        position: \[300, 300\]\\n      },\\n      {\\n        parameters: {\\n          functionCode: \`// Préparation des données pour l&#39;IA\\\\nreturn $input.item;\`\\n        },\\n        name: \\&quot;Préparer Données\\&quot;,\\n        type: \\&quot;n8n-nodes-base.function\\&quot;,\\n        position: \[500, 300\]\\n      },\\n      {\\n        parameters: {\\n          authentication: \\&quot;genericCredentialType\\&quot;,\\n          url: \\&quot;https://openrouter.ai/api/v1/chat/completions\\&quot;,\\n          options: {\\n            bodyContentType: \\&quot;json\\&quot;,\\n            body: {\\n              model: \\&quot;deepseek-ai/deepseek-v3\\&quot;,\\n              messages: \[\\n                {\\n                  role: \\&quot;system\\&quot;,\\n                  content: \`Vous êtes un assistant spécialisé dans ${functionality.description}\`\\n                },\\n                {\\n                  role: \\&quot;user\\&quot;,\\n                  content: \\&quot;={{$json.prompt}}\\&quot;\\n                }\\n              \]\\n            }\\n          }\\n        },\\n        name: \\&quot;Appel IA\\&quot;,\\n        type: \\&quot;n8n-nodes-base.httpRequest\\&quot;,\\n        position: \[700, 300\]\\n      },\\n      {\\n        parameters: {\\n          functionCode: \`// Traitement de la réponse de l&#39;IA\\\\nconst response \= $json.choices\[0\].message.content;\\\\nreturn {\\\\n  json: {\\\\n    aiResponse: response,\\\\n    processedResult: response.trim()\\\\n  }\\\\n};\`\\n        },\\n        name: \\&quot;Traiter Réponse IA\\&quot;,\\n        type: \\&quot;n8n-nodes-base.function\\&quot;,\\n        position: \[900, 300\]\\n      }\\n    \],\\n    connections: {\\n      \\&quot;Déclencheur Manuel\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Charger Configuration\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      },\\n      \\&quot;Charger Configuration\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Préparer Données\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      },\\n      \\&quot;Préparer Données\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Appel IA\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      },\\n      \\&quot;Appel IA\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Traiter Réponse IA\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      }\\n    }\\n  };\\n}\\n\\n// Fonction pour générer un template pour le Pilier 4 (Interfaces Utilisateur)\\nfunction generatePilier4Template(functionality, normalizedName) {\\n  return {\\n    name: \`P4\_${normalizedName}\`,\\n    nodes: \[\\n      {\\n        parameters: {\\n          path: \`api/${normalizedName}\`,\\n          responseMode: \\&quot;onReceived\\&quot;,\\n          options: {}\\n        },\\n        name: \\&quot;Webhook API\\&quot;,\\n        type: \\&quot;n8n-nodes-base.webhook\\&quot;,\\n        position: \[100, 300\]\\n      },\\n      {\\n        parameters: {\\n          functionCode: \`// Validation des paramètres d&#39;entrée\\\\nconst input \= $input.item.json;\\\\n\\\\n// Vérifier les paramètres requis\\\\nconst requiredParams \= \[&#39;param1&#39;, &#39;param2&#39;\];\\\\nconst missingParams \= requiredParams.filter(param \=\&gt; \!input\[param\]);\\\\n\\\\nif (missingParams.length \&gt; 0\) {\\\\n  return {\\\\n    json: {\\\\n      success: false,\\\\n      error: \\\\\`Paramètres manquants: \\\\${missingParams.join(&#39;, &#39;)}\\\\\`\\\\n    }\\\\n  };\\\\n}\\\\n\\\\nreturn {\\\\n  json: {\\\\n    ...input,\\\\n    validated: true\\\\n  }\\\\n};\`\\n        },\\n        name: \\&quot;Valider Requête\\&quot;,\\n        type: \\&quot;n8n-nodes-base.function\\&quot;,\\n        position: \[300, 300\]\\n      },\\n      {\\n        parameters: {\\n          conditions: {\\n            string: \[\\n              {\\n                value1: \\&quot;={{$json.validated}}\\&quot;,\\n                operation: \\&quot;equal\\&quot;,\\n                value2: \\&quot;true\\&quot;\\n              }\\n            \]\\n          }\\n        },\\n        name: \\&quot;Requête Valide?\\&quot;,\\n        type: \\&quot;n8n-nodes-base.if\\&quot;,\\n        position: \[500, 300\]\\n      },\\n      {\\n        parameters: {\\n          url: \\&quot;http://localhost:5678/webhook/core-config\\&quot;,\\n          options: {}\\n        },\\n        name: \\&quot;Charger Configuration\\&quot;,\\n        type: \\&quot;n8n-nodes-base.httpRequest\\&quot;,\\n        position: \[700, 200\]\\n      },\\n      {\\n        parameters: {\\n          values: {\\n            string: \[\\n              {\\n                name: \\&quot;success\\&quot;,\\n                value: \\&quot;false\\&quot;\\n              },\\n              {\\n                name: \\&quot;message\\&quot;,\\n                value: \\&quot;={{$json.error}}\\&quot;\\n              }\\n            \],\\n            object: \[\\n              {\\n                name: \\&quot;error\\&quot;,\\n                value: {\\n                  code: \\&quot;VALIDATION\_ERROR\\&quot;,\\n                  details: \\&quot;={{$json.error}}\\&quot;\\n                }\\n              }\\n            \]\\n          }\\n        },\\n        name: \\&quot;Erreur Validation\\&quot;,\\n        type: \\&quot;n8n-nodes-base.set\\&quot;,\\n        position: \[700, 400\]\\n      },\\n      {\\n        parameters: {\\n          functionCode: \`// Logique métier spécifique à ${functionality.name}\\\\nreturn {\\\\n  json: {\\\\n    success: true,\\\\n    data: {\\\\n      result: &#39;Exemple de résultat&#39;,\\\\n      timestamp: new Date().toISOString()\\\\n    }\\\\n  }\\\\n};\`\\n        },\\n        name: \\&quot;Logique Métier\\&quot;,\\n        type: \\&quot;n8n-nodes-base.function\\&quot;,\\n        position: \[900, 200\]\\n      }\\n    \],\\n    connections: {\\n      \\&quot;Webhook API\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Valider Requête\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      },\\n      \\&quot;Valider Requête\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Requête Valide?\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      },\\n      \\&quot;Requête Valide?\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Charger Configuration\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \],\\n          \[\\n            {\\n              node: \\&quot;Erreur Validation\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      },\\n      \\&quot;Charger Configuration\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Logique Métier\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      }\\n    }\\n  };\\n}\\n\\n// Fonction pour générer un template générique\\nfunction generateGenericTemplate(functionality, normalizedName) {\\n  return {\\n    name: \`Generic\_${normalizedName}\`,\\n    nodes: \[\\n      {\\n        parameters: {\\n          triggerTimes: {\\n            item: \[\\n              {\\n                mode: \\&quot;manual\\&quot;\\n              }\\n            \]\\n          }\\n        },\\n        name: \\&quot;Déclencheur Manuel\\&quot;,\\n        type: \\&quot;n8n-nodes-base.manualTrigger\\&quot;,\\n        position: \[100, 300\]\\n      },\\n      {\\n        parameters: {\\n          functionCode: \`// Code spécifique à ${functionality.name}\\\\nreturn $input.item;\`\\n        },\\n        name: \\&quot;Logique Principale\\&quot;,\\n        type: \\&quot;n8n-nodes-base.function\\&quot;,\\n        position: \[300, 300\]\\n      }\\n    \],\\n    connections: {\\n      \\&quot;Déclencheur Manuel\\&quot;: {\\n        main: \[\\n          \[\\n            {\\n              node: \\&quot;Logique Principale\\&quot;,\\n              type: \\&quot;main\\&quot;,\\n              index: 0\\n            }\\n          \]\\n        \]\\n      }\\n    }\\n  };\\n}\\n\\n// Convertir en JSON formaté\\nconst workflowJson \= JSON.stringify(workflowTemplate, null, 2);\\n\\nreturn {\\n  json: {\\n    functionality: functionality.name,\\n    targetPillar,\\n    workflowName: workflowTemplate.name\\n  },\\n  binary: {\\n    data: {\\n      mimeType: &#39;application/json&#39;,\\n      data: Buffer.from(workflowJson).toString(&#39;base64&#39;),\\n      fileName: \`${workflowTemplate.name}.json\`\\n    }\\n  }\\n};&quot;  
  &quot;name&quot;: &quot;Générer Template Workflow&quot;,  
  &quot;position&quot;: \[900, 300\]  
    &quot;path&quot;: &quot;templates/{{$json.workflowName}}.json&quot;,  
    &quot;options&quot;: {}  
  &quot;name&quot;: &quot;Sauvegarder Template&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.writeBinaryFile&quot;,  
  &quot;position&quot;: \[1100, 300\]  
&quot;functionCode&quot;: &quot;// Générer un guide de migration\\nconst functionality \= $input.item.json.functionality;\\nconst targetPillar \= $input.item.json.targetPillar;\\nconst workflowName \= $input.item.json.workflowName;\\n\\n// Créer le contenu Markdown\\nlet markdownContent \= \`\# Guide de Migration : ${functionality}\\n\\n\#\# Vue d&#39;ensemble\\n\\nCe document fournit les instructions pour migrer la fonctionnalité \\&quot;${functionality}\\&quot; vers le pilier ${targetPillar} du Plan Magistral V5.\\n\\n\#\# Étapes de Migration\\n\\n1. \*\*Préparation\*\*\\n   \- Créer un nouveau workflow basé sur le template \`${workflowName}.json\`\\n   \- Vérifier que toutes les dépendances sont disponibles\\n   \- Configurer les credentials nécessaires\\n\\n2. \*\*Adaptation du Code\*\*\\n   \- Localiser les sections marquées avec des commentaires \`// Code spécifique à...\`\\n   \- Adapter le code existant pour l&#39;intégrer dans la nouvelle structure\\n   \- Mettre à jour les références aux autres workflows/piliers\\n\\n3. \*\*Tests\*\*\\n   \- Tester le workflow en isolation\\n   \- Vérifier les interactions avec les autres piliers\\n   \- Valider que toutes les fonctionnalités sont correctement migrées\\n\\n4. \*\*Déploiement\*\*\\n   \- Activer le nouveau workflow\\n   \- Désactiver l&#39;ancien workflow après validation\\n   \- Mettre à jour la documentation\\n\\n\#\# Points d&#39;Attention\\n\\n- Vérifier que les formats de données sont compatibles avec le Plan Magistral V5\\n- S&#39;assurer que les webhooks et points d&#39;intégration sont correctement configurés\\n- Mettre à jour les références dans les autres workflows\\n\\n\#\# Validation\\n\\nPour valider la migration, vérifier que :\\n\\n- Le workflow fonctionne correctement en isolation\\n- Les interactions avec les autres piliers sont fonctionnelles\\n- Les performances sont au moins équivalentes à l&#39;ancienne implémentation\\n- Tous les cas d&#39;utilisation sont couverts\\n\\n\#\# Rollback\\n\\nEn cas de problème, suivre ces étapes pour revenir à l&#39;ancienne implémentation :\\n\\n1. Désactiver le nouveau workflow\\n2. Réactiver l&#39;ancien workflow\\n3. Documenter les problèmes rencontrés pour une future tentative\\n\`;\\n\\nreturn {\\n  json: {\\n    markdownContent\\n  },\\n  binary: {\\n    data: {\\n      mimeType: &#39;text/markdown&#39;,\\n      data: Buffer.from(markdownContent).toString(&#39;base64&#39;),\\n      fileName: \`migration\_guide\_${workflowName}.md\`\\n    }\\n  }\\n};&quot;  
</pre></div>
</div>
<p>“name”: “Générer Guide Migration”,<br />”position”: [1100, 500]<br />”path”: “guides/migration_guide_{{$json.workflowName}}.md”,<br />”name”: “Sauvegarder Guide”,<br />”position”: [1300, 500]</p>
<p>2.WF-MIGRATION-TESTER</p>
<ul>
<li><p>Objectif: Tester les fonctionnalités migrées pour s’assurer qu’elles fonctionnent correctement</p>
<p>“name”: “WF-MIGRATION-TESTER”,<br />”name”: “workflowName”,<br />”value”: “==$input.item.json.workflowName || ‘P3_email_generation’”<br />],<br />”object”: [<br />”name”: “testData”,<br />”value”: “==$input.item.json.testData || {}”<br />”name”: “Configuration Test”,<br />”url”: “=http://localhost:5678/rest/workflows?filter={{$json.workflowName}}”,<br />”authentication”: “genericCredentialType”,<br />”genericAuthType”: “n8nApi”,<br />”name”: “Vérifier Workflow”,<br />”type”: “n8n-nodes-base.httpRequest”,<br />”conditions”: {<br />”number”: [<br />”value1”: “={{$json.data.length}}”,<br />”operation”: “equal”,<br />”value2”: 0<br />”name”: “Workflow Existe?”,<br />”type”: “n8n-nodes-base.if”,<br />”name”: “status”,<br />”value”: “error”<br />”name”: “message”,<br />”value”: “=Le workflow {{$json.workflowName}} n’existe pas”<br />”name”: “Erreur Workflow”,<br />”position”: [900, 200]<br />”functionCode”: “// Préparer l’exécution du workflow\nconst workflowData = $json.data[0];\nconst workflowId = workflowData.id;\nconst testData = $input.item.json.testData || {};\n\n// Créer la requête d’exécution\nreturn {\n  json: {\n    workflowId,\n    workflowName: workflowData.name,\n    testData\n  }\n};”<br />”name”: “Préparer Exécution”,<br />”position”: [900, 400]<br />”url”: “=http://localhost:5678/rest/workflows/{{$json.workflowId}}/execute”,<br />”sendBody”: true,<br />”bodyParameters”: {<br />”parameters”: [<br />”name”: “data”,<br />”value”: “={{$json.testData}}”<br />”name”: “Exécuter Workflow”,<br />”position”: [1100, 400]<br />”value1”: “={{$json.statusCode}}”,<br />”operation”: “startsWith”,<br />”value2”: “2”<br />”name”: “Exécution Réussie?”,<br />”position”: [1300, 400]<br />”value”: “success”<br />”value”: “=Test du workflow {{$json.workflowName}} réussi”<br />”name”: “result”,<br />”value”: “={{$json.data}}”<br />”name”: “Test Réussi”,<br />”position”: [1500, 300]<br />”value”: “=Erreur lors du test du workflow {{$json.workflowName}}: {{$json.statusCode}} - {{$json.statusMessage}}”<br />”name”: “error”,<br />”value”: “={{$json}}”<br />”name”: “Test Échoué”,<br />”position”: [1500, 500]<br />”functionCode”: “// Générer un rapport de test\nconst status = $input.item.json.status;\nconst message = $input.item.json.message;\nconst workflowName = $input.item.json.workflowName;\nconst result = $input.item.json.result || $input.item.json.error || {};\n\n// Créer le contenu Markdown\nlet markdownContent = `# Rapport de Test : ${workflowName}\n\n## Résultat\n\n**Statut** : ${status === ‘success’ ? ‘✅ Succès’ : ‘❌ Échec’}\n**Message** : ${message}\n\n## Détails\n\n\\`\\`\\`json\n${JSON.stringify(result, null, 2)}\n\\`\\`\\`\n\n## Horodatage\n\nTest exécuté le ${new Date().toLocaleString(’fr-FR’)}\n`;\n\nreturn {\n  json: {\n    status,\n    message,\n    workflowName,\n    markdownContent\n  },\n  binary: {\n    data: {\n      mimeType: ‘text/markdown’,\n      data: Buffer.from(markdownContent).toString(’base64’),\n      fileName: `test_report_${workflowName}.md`\n    }\n  }\n};”<br />”name”: “Générer Rapport”,<br />”position”: [1700, 400]<br />”path”: “reports/tests/test_report_{{$json.workflowName}}.md”,<br />”name”: “Sauvegarder Rapport”,<br />”position”: [1900, 400]<br />”connections”: {<br />”Déclencheur Manuel”: {<br />”main”: [<br />[<br />”node”: “Configuration Test”,<br />”type”: “main”,<br />”index”: 0<br />”Configuration Test”: {<br />”node”: “Vérifier Workflow”,<br />”Vérifier Workflow”: {<br />”node”: “Workflow Existe?”,<br />”Workflow Existe?”: {<br />”node”: “Erreur Workflow”,<br />”node”: “Préparer Exécution”,<br />”Erreur Workflow”: {<br />”node”: “Générer Rapport”,<br />”Préparer Exécution”: {<br />”node”: “Exécuter Workflow”,<br />”Exécuter Workflow”: {<br />”node”: “Exécution Réussie?”,<br />”Exécution Réussie?”: {<br />”node”: “Test Réussi”,<br />”node”: “Test Échoué”,<br />”Test Réussi”: {<br />”Test Échoué”: {<br />”Générer Rapport”: {<br />”node”: “Sauvegarder Rapport”,</p>
</li>
</ul>
</section>
<section id="adaptation-des-interfaces-a-name-section-1-4-3-a">
<h4>1.4.3. Adaptation des Interfaces <a name='section-1-4-3'></a><a class="headerlink" href="#adaptation-des-interfaces-a-name-section-1-4-3-a" title="Link to this heading"></a></h4>
</section>
<section id="id5">
<h4>Workflows à Développer<a class="headerlink" href="#id5" title="Link to this heading"></a></h4>
<ol class="simple">
<li><p>WF-INTERFACE-ADAPTER</p>
<ul class="simple">
<li><p>Objectif: Adapter les interfaces entre les fonctionnalités migrées pour assurer la compatibilité</p></li>
<li><p>Structure JSON:</p></li>
</ul>
</li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WF-INTERFACE-ADAPTER&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;nodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;triggerTimes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">          </span><span class="nt">&quot;item&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">              </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manual&quot;</span><span class="w">  </span>
<span class="w">            </span><span class="p">}</span><span class="w">  </span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      \]  
  },  
  &quot;name&quot;: &quot;Déclencheur Manuel&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.manualTrigger&quot;,  
  &quot;position&quot;: \[100, 300\]  
    &quot;values&quot;: {  
      &quot;string&quot;: \[  
          &quot;name&quot;: &quot;sourceWorkflow&quot;,  
          &quot;value&quot;: &quot;==$input.item.json.sourceWorkflow || &#39;P3\_email\_generation&#39;&quot;  
          &quot;name&quot;: &quot;targetWorkflow&quot;,  
          &quot;value&quot;: &quot;==$input.item.json.targetWorkflow || &#39;P2\_email\_sending&#39;&quot;  
      \],  
      &quot;object&quot;: \[  
          &quot;name&quot;: &quot;interfaceSpec&quot;,  
          &quot;value&quot;: &quot;==$input.item.json.interfaceSpec || {}&quot;  
  &quot;name&quot;: &quot;Configuration Interface&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.set&quot;,  
  &quot;position&quot;: \[300, 300\]  
    &quot;functionCode&quot;: &quot;// Générer un adaptateur d&#39;interface\\nconst sourceWorkflow \= $input.item.json.sourceWorkflow;\\nconst targetWorkflow \= $input.item.json.targetWorkflow;\\nconst interfaceSpec \= $input.item.json.interfaceSpec || {};\\n\\n// Créer un nom pour l&#39;adaptateur\\nconst adapterName \= \`Interface\_${sourceWorkflow}\_to\_${targetWorkflow}\`;\\n\\n// Créer un template d&#39;adaptateur\\nconst adapterTemplate \= {\\n  name: adapterName,\\n  nodes: \[\\n    {\\n      parameters: {\\n        path: \`interface/${sourceWorkflow.toLowerCase()}-to-${targetWorkflow.toLowerCase()}\`,\\n        responseMode: \\&quot;onReceived\\&quot;,\\n        options: {}\\n      },\\n      name: \\&quot;Webhook Interface\\&quot;,\\n      type: \\&quot;n8n-nodes-base.webhook\\&quot;,\\n      position: \[100, 300\]\\n    },\\n    {\\n      parameters: {\\n        functionCode: \`// Validation des données d&#39;entrée\\\\nconst input \= $input.item.json;\\\\n\\\\n// Vérifier les champs requis\\\\nconst requiredFields \= ${JSON.stringify(interfaceSpec.requiredFields || \[&#39;data&#39;\])};\\\\nconst missingFields \= requiredFields.filter(field \=\&gt; \!input\[field\]);\\\\n\\\\nif (missingFields.length \&gt; 0\) {\\\\n  return {\\\\n    json: {\\\\n      success: false,\\\\n      error: \\\\\`Champs manquants: \\\\${missingFields.join(&#39;, &#39;)}\\\\\`\\\\n    }\\\\n  };\\\\n}\\\\n\\\\nreturn {\\\\n  json: {\\\\n    ...input,\\\\n    validated: true\\\\n  }\\\\n};\`\\n      },\\n      name: \\&quot;Valider Données\\&quot;,\\n      type: \\&quot;n8n-nodes-base.function\\&quot;,\\n      position: \[300, 300\]\\n    },\\n    {\\n      parameters: {\\n        conditions: {\\n          string: \[\\n            {\\n              value1: \\&quot;={{$json.validated}}\\&quot;,\\n              operation: \\&quot;equal\\&quot;,\\n              value2: \\&quot;true\\&quot;\\n            }\\n          \]\\n        }\\n      },\\n      name: \\&quot;Données Valides?\\&quot;,\\n      type: \\&quot;n8n-nodes-base.if\\&quot;,\\n      position: \[500, 300\]\\n    },\\n    {\\n      parameters: {\\n        functionCode: \`// Transformation des données pour le workflow cible\\\\nconst input \= $input.item.json;\\\\n\\\\n// Appliquer les transformations spécifiées\\\\nconst transformedData \= {};\\\\n\\\\n// Exemple de transformation basée sur interfaceSpec\\\\n${generateTransformationCode(interfaceSpec)}\\\\n\\\\nreturn {\\\\n  json: transformedData\\\\n};\`\\n      },\\n      name: \\&quot;Transformer Données\\&quot;,\\n      type: \\&quot;n8n-nodes-base.function\\&quot;,\\n      position: \[700, 200\]\\n    },\\n    {\\n      parameters: {\\n        values: {\\n          string: \[\\n            {\\n              name: \\&quot;success\\&quot;,\\n              value: \\&quot;false\\&quot;\\n            },\\n            {\\n              name: \\&quot;message\\&quot;,\\n              value: \\&quot;={{$json.error}}\\&quot;\\n            }\\n          \],\\n          object: \[\\n            {\\n              name: \\&quot;error\\&quot;,\\n              value: {\\n                code: \\&quot;VALIDATION\_ERROR\\&quot;,\\n                details: \\&quot;={{$json.error}}\\&quot;\\n              }\\n            }\\n          \]\\n        }\\n      },\\n      name: \\&quot;Erreur Validation\\&quot;,\\n      type: \\&quot;n8n-nodes-base.set\\&quot;,\\n      position: \[700, 400\]\\n    },\\n    {\\n      parameters: {\\n        url: \`http://localhost:5678/webhook/${targetWorkflow.toLowerCase()}\`,\\n        sendBody: true,\\n        bodyParameters: {\\n          parameters: \[\\n            {\\n              name: \\&quot;data\\&quot;,\\n              value: \\&quot;={{$json}}\\&quot;\\n            }\\n          \]\\n        },\\n        options: {}\\n      },\\n      name: \\&quot;Appeler Workflow Cible\\&quot;,\\n      type: \\&quot;n8n-nodes-base.httpRequest\\&quot;,\\n      position: \[900, 200\]\\n    },\\n    {\\n      parameters: {\\n        functionCode: \`// Traitement de la réponse du workflow cible\\\\nconst response \= $json;\\\\n\\\\n// Formater la réponse finale\\\\nreturn {\\\\n  json: {\\\\n    success: true,\\\\n    source: &#39;${sourceWorkflow}&#39;,\\\\n    target: &#39;${targetWorkflow}&#39;,\\\\n    result: response\\\\n  }\\\\n};\`\\n      },\\n      name: \\&quot;Traiter Réponse\\&quot;,\\n      type: \\&quot;n8n-nodes-base.function\\&quot;,\\n      position: \[1100, 200\]\\n    }\\n  \],\\n  connections: {\\n    \\&quot;Webhook Interface\\&quot;: {\\n      main: \[\\n        \[\\n          {\\n            node: \\&quot;Valider Données\\&quot;,\\n            type: \\&quot;main\\&quot;,\\n            index: 0\\n          }\\n        \]\\n      \]\\n    },\\n    \\&quot;Valider Données\\&quot;: {\\n      main: \[\\n        \[\\n          {\\n            node: \\&quot;Données Valides?\\&quot;,\\n            type: \\&quot;main\\&quot;,\\n            index: 0\\n          }\\n        \]\\n      \]\\n    },\\n    \\&quot;Données Valides?\\&quot;: {\\n      main: \[\\n        \[\\n          {\\n            node: \\&quot;Transformer Données\\&quot;,\\n            type: \\&quot;main\\&quot;,\\n            index: 0\\n          }\\n        \],\\n        \[\\n          {\\n            node: \\&quot;Erreur Validation\\&quot;,\\n            type: \\&quot;main\\&quot;,\\n            index: 0\\n          }\\n        \]\\n      \]\\n    },\\n    \\&quot;Transformer Données\\&quot;: {\\n      main: \[\\n        \[\\n          {\\n            node: \\&quot;Appeler Workflow Cible\\&quot;,\\n            type: \\&quot;main\\&quot;,\\n            index: 0\\n          }\\n        \]\\n      \]\\n    },\\n    \\&quot;Appeler Workflow Cible\\&quot;: {\\n      main: \[\\n        \[\\n          {\\n            node: \\&quot;Traiter Réponse\\&quot;,\\n            type: \\&quot;main\\&quot;,\\n            index: 0\\n          }\\n        \]\\n      \]\\n    }\\n  }\\n};\\n\\n// Fonction pour générer le code de transformation\\nfunction generateTransformationCode(spec) {\\n  const mappings \= spec.fieldMappings || \[\];\\n  let code \= &#39;&#39;;\\n  \\n  if (mappings.length \=== 0\) {\\n    code \= \`// Aucune transformation spécifiée \- copier toutes les données\\\\nObject.assign(transformedData, input);\`;\\n  } else {\\n    code \= &#39;// Appliquer les transformations de champs\\\\n&#39;;\\n    mappings.forEach(mapping \=\&gt; {\\n      if (mapping.transform) {\\n        code \+= \`transformedData\[&#39;${mapping.target}&#39;\] \= ${mapping.transform.replace(&#39;$source&#39;, \`input\[&#39;${mapping.source}&#39;\]\`)}\\\\n\`;\\n      } else {\\n        code \+= \`transformedData\[&#39;${mapping.target}&#39;\] \= input\[&#39;${mapping.source}&#39;\];\\\\n\`;\\n      }\\n    });\\n  }\\n  \\n  return code;\\n}\\n\\n// Convertir en JSON formaté\\nconst adapterJson \= JSON.stringify(adapterTemplate, null, 2);\\n\\nreturn {\\n  json: {\\n    sourceWorkflow,\\n    targetWorkflow,\\n    adapterName\\n  },\\n  binary: {\\n    data: {\\n      mimeType: &#39;application/json&#39;,\\n      data: Buffer.from(adapterJson).toString(&#39;base64&#39;),\\n      fileName: \`${adapterName}.json\`\\n    }\\n  }\\n};&quot;  
  &quot;name&quot;: &quot;Générer Adaptateur&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.function&quot;,  
  &quot;position&quot;: \[500, 300\]  
    &quot;path&quot;: &quot;templates/interfaces/{{$json.adapterName}}.json&quot;,  
    &quot;options&quot;: {}  
  &quot;name&quot;: &quot;Sauvegarder Adaptateur&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.writeBinaryFile&quot;,  
  &quot;position&quot;: \[700, 300\]  
    &quot;functionCode&quot;: &quot;// Générer un guide d&#39;interface\\nconst sourceWorkflow \= $input.item.json.sourceWorkflow;\\nconst targetWorkflow \= $input.item.json.targetWorkflow;\\nconst adapterName \= $input.item.json.adapterName;\\nconst interfaceSpec \= $input.item.json.interfaceSpec || {};\\n\\n// Créer le contenu Markdown\\nlet markdownContent \= \`\# Guide d&#39;Interface : ${sourceWorkflow} → ${targetWorkflow}\\n\\n\#\# Vue d&#39;ensemble\\n\\nCe document décrit l&#39;interface entre les workflows ${sourceWorkflow} et ${targetWorkflow}, et explique comment utiliser l&#39;adaptateur ${adapterName}.\\n\\n\#\# Spécification de l&#39;Interface\\n\\n\#\#\# Données d&#39;Entrée (${sourceWorkflow})\\n\\n\`;\\n\\n// Ajouter les champs requis\\nconst requiredFields \= interfaceSpec.requiredFields || \[&#39;data&#39;\];\\nmarkdownContent \+= \`\*\*Champs Requis :\*\*\\\\n\\\\n\`;\\nrequiredFields.forEach(field \=\&gt; {\\n  markdownContent \+= \`- \\\\\`${field}\\\\\`\\\\n\`;\\n});\\n\\n// Ajouter les mappings de champs\\nmarkdownContent \+= \`\\\\n\#\#\# Mappings de Champs\\\\n\\\\n\`;\\nconst mappings \= interfaceSpec.fieldMappings || \[\];\\n\\nif (mappings.length \=== 0\) {\\n  markdownContent \+= \`Aucun mapping spécifique \- toutes les données sont transmises telles quelles.\\\\n\`;\\n} else {\\n  markdownContent \+= \`| Champ Source | Champ Cible | Transformation |\\\\n|-------------|------------|----------------|\\\\n\`;\\n  mappings.forEach(mapping \=\&gt; {\\n    markdownContent \+= \`| \\\\\`${mapping.source}\\\\\` | \\\\\`${mapping.target}\\\\\` | ${mapping.transform ? mapping.transform.replace(&#39;$source&#39;, &#39;valeur source&#39;) : &#39;Aucune&#39;} |\\\\n\`;\\n  });\\n}\\n\\n// Ajouter des exemples\\nmarkdownContent \+= \`\\\\n\#\# Exemples\\\\n\\\\n\#\#\# Exemple de Requête\\\\n\\\\n\\\\\`\\\\\`\\\\\`json\\\\n${JSON.stringify(generateExampleRequest(interfaceSpec), null, 2)}\\\\n\\\\\`\\\\\`\\\\\`\\\\n\\\\n\#\#\# Exemple de Réponse\\\\n\\\\n\\\\\`\\\\\`\\\\\`json\\\\n${JSON.stringify(generateExampleResponse(), null, 2)}\\\\n\\\\\`\\\\\`\\\\\`\\\\n\\\\n\#\# Utilisation\\\\n\\\\nPour utiliser cet adaptateur d&#39;interface :\\\\n\\\\n1. Déployer le workflow ${adapterName}\\\\n2. Configurer ${sourceWorkflow} pour envoyer ses données à l&#39;URL de webhook de l&#39;adaptateur\\\\n3. Vérifier que ${targetWorkflow} est correctement configuré pour recevoir les données transformées\\\\n\\\\n\#\# Dépannage\\\\n\\\\nEn cas de problème :\\\\n\\\\n- Vérifier que tous les champs requis sont présents dans les données d&#39;entrée\\\\n- S&#39;assurer que les deux workflows sont actifs\\\\n- Consulter les logs d&#39;exécution pour identifier les erreurs potentielles\\\\n\`;\\n\\n// Fonction pour générer un exemple de requête\\nfunction generateExampleRequest(spec) {\\n  const example \= {};\\n  const requiredFields \= spec.requiredFields || \[&#39;data&#39;\];\\n  \\n  requiredFields.forEach(field \=\&gt; {\\n    example\[field\] \= field \=== &#39;data&#39; ? { example: &#39;value&#39; } : \`example\_${field}\`;\\n  });\\n  \\n  return example;\\n}\\n\\n// Fonction pour générer un exemple de réponse\\nfunction generateExampleResponse() {\\n  return {\\n    success: true,\\n    source: sourceWorkflow,\\n    target: targetWorkflow,\\n    result: {\\n      status: &#39;success&#39;,\\n      message: &#39;Opération réussie&#39;,\\n      data: {\\n        id: &#39;12345&#39;,\\n        timestamp: new Date().toISOString()\\n      }\\n    }\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    sourceWorkflow,\\n    targetWorkflow,\\n    adapterName\\n  },\\n  binary: {\\n    data: {\\n      mimeType: &#39;text/markdown&#39;,\\n      data: Buffer.from(markdownContent).toString(&#39;base64&#39;),\\n      fileName: \`interface\_guide\_${sourceWorkflow}\_to\_${targetWorkflow}.md\`\\n    }\\n  }\\n};&quot;  
  &quot;name&quot;: &quot;Générer Guide Interface&quot;,  
  &quot;position&quot;: \[700, 500\]  
    &quot;path&quot;: &quot;guides/interfaces/interface\_guide\_{{$json.sourceWorkflow}}\_to\_{{$json.targetWorkflow}}.md&quot;,  
  &quot;name&quot;: &quot;Sauvegarder Guide&quot;,  
  &quot;position&quot;: \[900, 500\]  
</pre></div>
</div>
<p>“connections”: {<br />”Déclencheur Manuel”: {<br />”main”: [<br />[<br />”node”: “Configuration Interface”,<br />”type”: “main”,<br />”index”: 0<br />”Configuration Interface”: {<br />”node”: “Générer Adaptateur”,<br />”Générer Adaptateur”: {<br />”node”: “Sauvegarder Adaptateur”,<br />”node”: “Générer Guide Interface”,<br />”Générer Guide Interface”: {<br />”node”: “Sauvegarder Guide”,</p>
</section>
</section>
<section id="etape-3-3-mise-en-place-du-systeme-de-monitoring-a-name-section-1-5-a">
<h3>1.5. Étape 3.3: Mise en Place du Système de Monitoring <a name='section-1-5'></a><a class="headerlink" href="#etape-3-3-mise-en-place-du-systeme-de-monitoring-a-name-section-1-5-a" title="Link to this heading"></a></h3>
<section id="configuration-des-alertes-a-name-section-1-5-1-a">
<h4>1.5.1. Configuration des Alertes <a name='section-1-5-1'></a><a class="headerlink" href="#configuration-des-alertes-a-name-section-1-5-1-a" title="Link to this heading"></a></h4>
</section>
<section id="id6">
<h4>Workflows à Développer<a class="headerlink" href="#id6" title="Link to this heading"></a></h4>
<ol class="simple">
<li><p>WF-MONITORING-ALERT-MANAGER</p>
<ul class="simple">
<li><p>Objectif: Configurer et gérer les alertes pour le système de monitoring</p></li>
<li><p>Structure JSON:</p></li>
</ul>
</li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WF-MONITORING-ALERT-MANAGER&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;nodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;triggerTimes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">          </span><span class="nt">&quot;item&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">              </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;manual&quot;</span><span class="w">  </span>
<span class="w">            </span><span class="p">}</span><span class="w">  </span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      \]  
  },  
  &quot;name&quot;: &quot;Déclencheur Manuel&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.manualTrigger&quot;,  
  &quot;position&quot;: \[100, 300\]  
    &quot;values&quot;: {  
      &quot;string&quot;: \[  
          &quot;name&quot;: &quot;action&quot;,  
          &quot;value&quot;: &quot;==$input.item.json.action || &#39;configure&#39;&quot;  
          &quot;name&quot;: &quot;alertName&quot;,  
          &quot;value&quot;: &quot;==$input.item.json.alertName || &#39;workflow\_error&#39;&quot;  
      \],  
      &quot;object&quot;: \[  
          &quot;name&quot;: &quot;alertConfig&quot;,  
          &quot;value&quot;: &quot;==$input.item.json.alertConfig || {}&quot;  
  &quot;name&quot;: &quot;Configuration Entrée&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.set&quot;,  
  &quot;position&quot;: \[300, 300\]  
    &quot;conditions&quot;: {  
          &quot;value1&quot;: &quot;={{$json.action}}&quot;,  
          &quot;operation&quot;: &quot;equal&quot;,  
          &quot;value2&quot;: &quot;configure&quot;  
  &quot;name&quot;: &quot;Action?&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.if&quot;,  
  &quot;position&quot;: \[500, 300\]  
    &quot;functionCode&quot;: &quot;// Configurer une alerte\\nconst alertName \= $input.item.json.alertName;\\nconst alertConfig \= $input.item.json.alertConfig || {};\\n\\n// Valeurs par défaut pour la configuration\\nconst defaultConfig \= {\\n  enabled: true,\\n  severity: &#39;medium&#39;,\\n  channels: \[&#39;email&#39;\],\\n  recipients: \[\],\\n  thresholds: {\\n    critical: 0.9,\\n    warning: 0.7\\n  },\\n  cooldownMinutes: 30,\\n  description: \`Alerte ${alertName}\`,\\n  template: {\\n    subject: \`\[ALERTE\] {{severity}} \- {{alertName}}\`,\\n    body: \`Une alerte {{severity}} a été déclenchée pour {{alertName}}\\\\n\\\\nDétails: {{details}}\\\\n\\\\nHorodatage: {{timestamp}}\`\\n  }\\n};\\n\\n// Fusionner avec la configuration fournie\\nconst mergedConfig \= {\\n  ...defaultConfig,\\n  ...alertConfig,\\n  // Fusionner les sous-objets\\n  thresholds: {\\n    ...defaultConfig.thresholds,\\n    ...(alertConfig.thresholds || {})\\n  },\\n  template: {\\n    ...defaultConfig.template,\\n    ...(alertConfig.template || {})\\n  }\\n};\\n\\n// Ajouter des métadonnées\\nmergedConfig.metadata \= {\\n  createdAt: new Date().toISOString(),\\n  updatedAt: new Date().toISOString(),\\n  alertName\\n};\\n\\n// Convertir en JSON formaté\\nconst configJson \= JSON.stringify(mergedConfig, null, 2);\\n\\nreturn {\\n  json: {\\n    alertName,\\n    action: &#39;configure&#39;,\\n    config: mergedConfig\\n  },\\n  binary: {\\n    data: {\\n      mimeType: &#39;application/json&#39;,\\n      data: Buffer.from(configJson).toString(&#39;base64&#39;),\\n      fileName: \`alert\_${alertName}.json\`\\n    }\\n  }\\n};&quot;  
  &quot;name&quot;: &quot;Configurer Alerte&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.function&quot;,  
  &quot;position&quot;: \[700, 200\]  
    &quot;functionCode&quot;: &quot;// Lister les alertes configurées\\nconst fs \= require(&#39;fs&#39;);\\nconst path \= require(&#39;path&#39;);\\n\\n// Chemin du dossier des alertes\\nconst alertsDir \= &#39;configs/alerts&#39;;\\n\\n// Vérifier si le dossier existe\\nif (\!fs.existsSync(alertsDir)) {\\n  fs.mkdirSync(alertsDir, { recursive: true });\\n}\\n\\n// Lire les fichiers d&#39;alerte\\nconst alertFiles \= fs.readdirSync(alertsDir)\\n  .filter(file \=\&gt; file.startsWith(&#39;alert\_&#39;) &amp;&amp; file.endsWith(&#39;.json&#39;));\\n\\n// Charger les configurations d&#39;alerte\\nconst alerts \= \[\];\\n\\nalertFiles.forEach(file \=\&gt; {\\n  try {\\n    const filePath \= path.join(alertsDir, file);\\n    const fileContent \= fs.readFileSync(filePath, &#39;utf8&#39;);\\n    const alertConfig \= JSON.parse(fileContent);\\n    const alertName \= file.replace(/^alert\_/, &#39;&#39;).replace(/\\\\.json$/, &#39;&#39;);\\n    \\n    alerts.push({\\n      name: alertName,\\n      enabled: alertConfig.enabled,\\n      severity: alertConfig.severity,\\n      channels: alertConfig.channels,\\n      description: alertConfig.description,\\n      lastUpdated: alertConfig.metadata?.updatedAt || &#39;Unknown&#39;\\n    });\\n  } catch (error) {\\n    console.error(\`Erreur lors de la lecture du fichier ${file}: ${error.message}\`);\\n  }\\n});\\n\\nreturn {\\n  json: {\\n    action: &#39;list&#39;,\\n    count: alerts.length,\\n    alerts\\n  }\\n};&quot;  
  &quot;name&quot;: &quot;Lister Alertes&quot;,  
  &quot;position&quot;: \[700, 400\]  
    &quot;path&quot;: &quot;configs/alerts/alert\_{{$json.alertName}}.json&quot;,  
    &quot;options&quot;: {}  
  &quot;name&quot;: &quot;Sauvegarder Config Alerte&quot;,  
  &quot;type&quot;: &quot;n8n-nodes-base.writeBinaryFile&quot;,  
  &quot;position&quot;: \[900, 200\]  
    &quot;functionCode&quot;: &quot;// Générer un guide de configuration des alertes\\nconst alertName \= $input.item.json.alertName;\\nconst config \= $input.item.json.config;\\n\\n// Créer le contenu Markdown\\nlet markdownContent \= \`\# Guide de Configuration d&#39;Alerte : ${alertName}\\n\\n\#\# Vue d&#39;ensemble\\n\\nCe document décrit la configuration de l&#39;alerte \\&quot;${alertName}\\&quot; et explique comment la personnaliser.\\n\\n\#\# Configuration Actuelle\\n\\n\\\\\`\\\\\`\\\\\`json\\n${JSON.stringify(config, null, 2)}\\n\\\\\`\\\\\`\\\\\`\\n\\n\#\# Paramètres\\n\\n| Paramètre | Description | Valeur Actuelle |\\n|-----------|-------------|----------------|\\n| enabled | Active ou désactive l&#39;alerte | ${config.enabled ? &#39;Activé&#39; : &#39;Désactivé&#39;} |\\n| severity | Niveau de sévérité de l&#39;alerte | ${config.severity} |\\n| channels | Canaux de notification | ${config.channels.join(&#39;, &#39;)} |\\n| recipients | Destinataires des notifications | ${config.recipients.length \&gt; 0 ? config.recipients.join(&#39;, &#39;) : &#39;Aucun&#39;} |\\n| thresholds.critical | Seuil critique | ${config.thresholds.critical} |\\n| thresholds.warning | Seuil d&#39;avertissement | ${config.thresholds.warning} |\\n| cooldownMinutes | Période de silence entre les alertes (minutes) | ${config.cooldownMinutes} |\\n\\n\#\# Personnalisation des Templates\\n\\n\#\#\# Sujet\\n\\n\\\\\`${config.template.subject}\\\\\`\\n\\n\#\#\# Corps\\n\\n\\\\\`\\\\\`\\\\\`\\n${config.template.body}\\n\\\\\`\\\\\`\\\\\`\\n\\n\#\# Variables Disponibles\\n\\nLes variables suivantes peuvent être utilisées dans les templates :\\n\\n- \\\\\`{{alertName}}\\\\\` \- Nom de l&#39;alerte\\n- \\\\\`{{severity}}\\\\\` \- Niveau de sévérité\\n- \\\\\`{{details}}\\\\\` \- Détails de l&#39;alerte\\n- \\\\\`{{timestamp}}\\\\\` \- Horodatage du déclenchement\\n- \\\\\`{{value}}\\\\\` \- Valeur qui a déclenché l&#39;alerte (si applicable)\\n- \\\\\`{{threshold}}\\\\\` \- Seuil dépassé (si applicable)\\n\\n\#\# Exemple d&#39;Utilisation\\n\\nPour déclencher cette alerte depuis un workflow :\\n\\n\\\\\`\\\\\`\\\\\`javascript\\n// Dans un nœud Function\\nreturn {\\n  json: {\\n    alertName: &#39;${alertName}&#39;,\\n    severity: &#39;critical&#39;, // ou &#39;warning&#39;\\n    details: &#39;Description du problème&#39;,\\n    value: 0.95, // valeur qui a déclenché l&#39;alerte (si applicable)\\n    additionalData: {\\n      // Données supplémentaires spécifiques à l&#39;alerte\\n    }\\n  }\\n};\\n\\\\\`\\\\\`\\\\\`\\n\\nPuis appeler le webhook de WF-MONITORING-ALERT-TRIGGER avec ces données.\\n\`;\\n\\nreturn {\\n  json: {\\n    alertName,\\n    markdownContent\\n  },\\n  binary: {\\n    data: {\\n      mimeType: &#39;text/markdown&#39;,\\n      data: Buffer.from(markdownContent).toString(&#39;base64&#39;),\\n      fileName: \`alert\_guide\_${alertName}.md\`\\n    }\\n  }\\n};&quot;  
  &quot;name&quot;: &quot;Générer Guide Alerte&quot;,  
  &quot;position&quot;: \[900, 400\]  
    &quot;path&quot;: &quot;guides/alerts/alert\_guide\_{{$json.alertName}}.md&quot;,  
  &quot;name&quot;: &quot;Sauvegarder Guide&quot;,  
  &quot;position&quot;: \[1100, 400\]  
</pre></div>
</div>
<p>“connections”: {<br />”Déclencheur Manuel”: {<br />”main”: [<br />[<br />”node”: “Configuration Entrée”,<br />”type”: “main”,<br />”index”: 0<br />”Configuration Entrée”: {<br />”node”: “Action?”,<br />”Action?”: {<br />”node”: “Configurer Alerte”,<br />”node”: “Lister Alertes”,<br />”Configurer Alerte”: {<br />”node”: “Sauvegarder Config Alerte”,<br />”Sauvegarder Config Alerte”: {<br />”node”: “Générer Guide Alerte”,<br />”Générer Guide Alerte”: {<br />”node”: “Sauvegarder Guide”,</p>
<p>2.WF-MONITORING-ALERT-TRIGGER</p>
<ul>
<li><p>Objectif: Déclencher les alertes configurées en fonction des événements du système</p>
<p>“name”: “WF-MONITORING-ALERT-TRIGGER”,<br />”path”: “trigger-alert”,<br />”responseMode”: “onReceived”,<br />”name”: “Webhook”,<br />”type”: “n8n-nodes-base.webhook”,<br />”functionCode”: “// Validation des paramètres d’entrée\nconst input = $input.item.json;\n\n// Vérifier les paramètres requis\nif (!input.alertName) {\n  return {\n    json: {\n      success: false,\n      error: ‘Le paramètre alertName est requis’\n    }\n  };\n}\n\n// Déterminer la sévérité\nconst severity = input.severity || ‘medium’;\n\n// Retourner les informations pour le chargement de la configuration d’alerte\nreturn {\n  json: {\n    alertName: input.alertName,\n    severity,\n    details: input.details || ‘Aucun détail fourni’,\n    value: input.value,\n    timestamp: new Date().toISOString(),\n    additionalData: input.additionalData || {}\n  }\n};”<br />”name”: “Valider Alerte”,<br />”options”: {<br />”encoding”: “utf8”<br />”name”: “Charger Config Alerte”,<br />”type”: “n8n-nodes-base.readBinaryFile”,<br />”value1”: “={{$json.errorMessage}}”,<br />”operation”: “exists”<br />”name”: “Config Existe?”,<br />”position”: [700, 300]<br />”name”: “status”,<br />”value”: “error”<br />”name”: “message”,<br />”value”: “=Configuration d’alerte non trouvée pour {{$json.alertName}}”<br />”name”: “Config Non Trouvée”,<br />”functionCode”: “// Traiter la configuration d’alerte\nconst alertData = $input.item.json;\nconst configData = $binary.data.toString();\n\n// Parser la configuration\nlet alertConfig;\ntry {\n  alertConfig = JSON.parse(configData);\n} catch (error) {\n  return {\n    json: {\n      status: ‘error’,\n      message: ‘Erreur de parsing de la configuration d\\’alerte’,\n      error: error.message\n    }\n  };\n}\n\n// Vérifier si l’alerte est activée\nif (!alertConfig.enabled) {\n  return {\n    json: {\n      status: ‘skipped’,\n      message: ‘Alerte désactivée’,\n      alertName: alertData.alertName\n    }\n  };\n}\n\n// Vérifier le cooldown\nconst lastTriggered = alertConfig.lastTriggered ? new Date(alertConfig.lastTriggered) : null;\nconst now = new Date();\nconst cooldownMinutes = alertConfig.cooldownMinutes || 30;\n\nif (lastTriggered &amp;&amp; ((now - lastTriggered) / 60000) &lt; cooldownMinutes) {\n  return {\n    json: {\n      status: ‘cooldown’,\n      message: `Alerte en période de cooldown (${cooldownMinutes} minutes)`,\n      alertName: alertData.alertName,\n      lastTriggered\n    }\n  };\n}\n\n// Déterminer si le seuil est dépassé (si applicable)\nlet thresholdExceeded = true;\nlet thresholdLevel = null;\n\nif (alertData.value !== undefined &amp;&amp; alertConfig.thresholds) {\n  const value = parseFloat(alertData.value);\n  \n  if (value &gt;= alertConfig.thresholds.critical) {\n    thresholdLevel = ‘critical’;\n  } else if (value &gt;= alertConfig.thresholds.warning) {\n    thresholdLevel = ‘warning’;\n  } else {\n    thresholdExceeded = false;\n  }\n}\n\n// Si le seuil n’est pas dépassé, ne pas déclencher l’alerte\nif (alertData.value !== undefined &amp;&amp; !thresholdExceeded) {\n  return {\n    json: {\n      status: ‘below_threshold’,\n      message: ‘Valeur en dessous des seuils d\\’alerte’,\n      alertName: alertData.alertName,\n      value: alertData.value,\n      thresholds: alertConfig.thresholds\n    }\n  };\n}\n\n// Préparer les données pour les notifications\nconst notificationData = {\n  alertName: alertData.alertName,\n  severity: thresholdLevel || alertData.severity || alertConfig.severity,\n  details: alertData.details,\n  timestamp: alertData.timestamp,\n  value: alertData.value,\n  threshold: thresholdLevel ? alertConfig.thresholds[thresholdLevel] : null,\n  config: alertConfig,\n  additionalData: alertData.additionalData\n};\n\n// Mettre à jour la date de dernier déclenchement\nalertConfig.lastTriggered = now.toISOString();\nalertConfig.metadata.updatedAt = now.toISOString();\n\n// Convertir en JSON formaté pour la mise à jour\nconst updatedConfigJson = JSON.stringify(alertConfig, null, 2);\n\nreturn {\n  json: {\n    status: ‘triggered’,\n    message: ‘Alerte déclenchée’,\n    alertName: alertData.alertName,\n    severity: notificationData.severity,\n    notificationData\n  },\n  binary: {\n    updatedConfig: {\n      mimeType: ‘application/json’,\n      data: Buffer.from(updatedConfigJson).toString(’base64’),\n      fileName: `alert_${alertData.alertName}.json`\n    }\n  }\n};”<br />”name”: “Traiter Config Alerte”,<br />”value1”: “={{$json.status}}”,<br />”value2”: “triggered”<br />”name”: “Alerte Déclenchée?”,<br />”name”: “Mettre à Jour Config”,<br />”position”: [1300, 300]<br />”functionCode”: “// Préparer les notifications\nconst notificationData = $input.item.json.notificationData;\nconst config = notificationData.config;\n\n// Déterminer les canaux de notification\nconst channels = config.channels || [’email’];\n\n// Préparer les données pour chaque canal\nconst notifications = [];\n\n// Remplacer les variables dans les templates\nfunction replaceTemplateVars(template, data) {\n  return template\n    .replace(/{{alertName}}/g, data.alertName)\n    .replace(/{{severity}}/g, data.severity)\n    .replace(/{{details}}/g, data.details)\n    .replace(/{{timestamp}}/g, data.timestamp)\n    .replace(/{{value}}/g, data.value !== undefined ? data.value : ‘N/A’)\n    .replace(/{{threshold}}/g, data.threshold !== null ? data.threshold : ‘N/A’);\n}\n\n// Préparer les notifications par canal\nchannels.forEach(channel =&gt; {\n  switch (channel) {\n    case ‘email’:\n      notifications.push({\n        channel: ‘email’,\n        recipients: config.recipients,\n        subject: replaceTemplateVars(config.template.subject, notificationData),\n        body: replaceTemplateVars(config.template.body, notificationData)\n      });\n      break;\n    case ‘slack’:\n      notifications.push({\n        channel: ‘slack’,\n        webhook: config.slackWebhook,\n        message: replaceTemplateVars(config.template.body, notificationData)\n      });\n      break;\n    case ‘telegram’:\n      notifications.push({\n        channel: ‘telegram’,\n        chatId: config.telegramChatId,\n        message: replaceTemplateVars(config.template.body, notificationData)\n      });\n      break;\n    // Ajouter d’autres canaux au besoin\n  }\n});\n\nreturn {\n  json: {\n    alertName: notificationData.alertName,\n    severity: notificationData.severity,\n    notifications\n  }\n};”<br />”name”: “Préparer Notifications”,<br />”position”: [1300, 500]<br />”mode”: “combine”,<br />”combinationMode”: “multiplex”,<br />”name”: “Séparer Notifications”,<br />”type”: “n8n-nodes-base.splitInBatches”,<br />”position”: [1500, 500]<br />”value1”: “={{$json.channel}}”,<br />”value2”: “email”<br />”name”: “Canal?”,<br />”position”: [1700, 500]<br />”fromEmail”: “{{$env.ALERT_EMAIL_FROM}}”,<br />”toEmail”: “={{$json.recipients.join(’,’)}}”,<br />”subject”: “={{$json.subject}}”,<br />”text”: “={{$json.body}}”<br />”name”: “Envoyer Email”,<br />”type”: “n8n-nodes-base.emailSend”,<br />”position”: [1900, 400]<br />”chatId”: “={{$json.chatId}}”,<br />”text”: “={{$json.message}}”,<br />”additionalFields”: {}<br />”name”: “Envoyer Telegram”,<br />”type”: “n8n-nodes-base.telegram”,<br />”position”: [1900, 600]<br />”Webhook”: {<br />”node”: “Valider Alerte”,<br />”Valider Alerte”: {<br />”node”: “Charger Config Alerte”,<br />”Charger Config Alerte”: {<br />”node”: “Config Existe?”,<br />”Config Existe?”: {<br />”node”: “Config Non Trouvée”,<br />”node”: “Traiter Config Alerte”,<br />”Traiter Config Alerte”: {<br />”node”: “Alerte Déclenchée?”,<br />”Alerte Déclenchée?”: {<br />”node”: “Mettre à Jour Config”,<br />”node”: “Préparer Notifications”,<br />[]<br />”Préparer Notifications”: {<br />”node”: “Séparer Notifications”,<br />”Séparer Notifications”: {<br />”node”: “Canal?”,<br />”Canal?”: {<br />”node”: “Envoyer Email”,<br />”node”: “Envoyer Telegram”,</p>
</li>
</ul>
</section>
<section id="mise-en-place-des-tableaux-de-bord-a-name-section-1-5-2-a">
<h4>1.5.2. Mise en Place des Tableaux de Bord <a name='section-1-5-2'></a><a class="headerlink" href="#mise-en-place-des-tableaux-de-bord-a-name-section-1-5-2-a" title="Link to this heading"></a></h4>
</section>
<section id="id7">
<h4>Workflows à Développer<a class="headerlink" href="#id7" title="Link to this heading"></a></h4>
<ol class="simple">
<li><p>WF-MONITORING-DASHBOARD-GENERATOR</p>
<ul class="simple">
<li><p>Objectif: Générer des tableaux de bord pour visualiser les performances du système</p></li>
<li><p>Structure JSON:</p></li>
</ul>
</li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WF-MONITORING-DASHBOARD-GENERATOR&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;nodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;rule&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">          </span><span class="nt">&quot;interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">              </span><span class="nt">&quot;field&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hours&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">              </span><span class="nt">&quot;hour&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w">  </span>
<span class="w">            </span><span class="p">}</span><span class="w">  </span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      \<span class="p">]</span>  
  <span class="p">},</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Déclencheur Cron&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.cron&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">300</span>\<span class="p">]</span>  
    <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;configs/dashboard\_config.json&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>  
      <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf8&quot;</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Charger Config Dashboard&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.readBinaryFile&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span>\<span class="p">]</span>  
    <span class="s2">&quot;conditions&quot;</span><span class="p">:</span> <span class="p">{</span>  
      <span class="s2">&quot;string&quot;</span><span class="p">:</span> \<span class="p">[</span>  
          <span class="s2">&quot;value1&quot;</span><span class="p">:</span> <span class="s2">&quot;={{$json.errorMessage}}&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;operation&quot;</span><span class="p">:</span> <span class="s2">&quot;exists&quot;</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Config Existe?&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.if&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">300</span>\<span class="p">]</span>  
 
<span class="s2">&quot;functionCode&quot;</span><span class="p">:</span> <span class="s2">&quot;// Créer une configuration par défaut</span><span class="se">\\</span><span class="s2">nconst defaultConfig \= {</span><span class="se">\\</span><span class="s2">n  dashboards: \[</span><span class="se">\\</span><span class="s2">n    {</span><span class="se">\\</span><span class="s2">n      name: &#39;workflow\_performance&#39;,</span><span class="se">\\</span><span class="s2">n      title: &#39;Performance des Workflows&#39;,</span><span class="se">\\</span><span class="s2">n      description: &#39;Tableau de bord de suivi des performances des workflows&#39;,</span><span class="se">\\</span><span class="s2">n      metrics: \[</span><span class="se">\\</span><span class="s2">n        {</span><span class="se">\\</span><span class="s2">n          name: &#39;execution\_time&#39;,</span><span class="se">\\</span><span class="s2">n          title: &#39;Temps d</span><span class="se">\\\\</span><span class="s2">&#39;Exécution&#39;,</span><span class="se">\\</span><span class="s2">n          type: &#39;line&#39;,</span><span class="se">\\</span><span class="s2">n          source: &#39;Agence\_Monitoring\_N8N&#39;,</span><span class="se">\\</span><span class="s2">n          filter: {</span><span class="se">\\</span><span class="s2">n            property: &#39;metricType&#39;,</span><span class="se">\\</span><span class="s2">n            value: &#39;executionTime&#39;</span><span class="se">\\</span><span class="s2">n          },</span><span class="se">\\</span><span class="s2">n          aggregation: &#39;avg&#39;,</span><span class="se">\\</span><span class="s2">n          timeframe: &#39;daily&#39;</span><span class="se">\\</span><span class="s2">n        },</span><span class="se">\\</span><span class="s2">n        {</span><span class="se">\\</span><span class="s2">n          name: &#39;error\_rate&#39;,</span><span class="se">\\</span><span class="s2">n          title: &#39;Taux d</span><span class="se">\\\\</span><span class="s2">&#39;Erreur&#39;,</span><span class="se">\\</span><span class="s2">n          type: &#39;bar&#39;,</span><span class="se">\\</span><span class="s2">n          source: &#39;Agence\_Monitoring\_N8N&#39;,</span><span class="se">\\</span><span class="s2">n          filter: {</span><span class="se">\\</span><span class="s2">n            property: &#39;metricType&#39;,</span><span class="se">\\</span><span class="s2">n            value: &#39;errorRate&#39;</span><span class="se">\\</span><span class="s2">n          },</span><span class="se">\\</span><span class="s2">n          aggregation: &#39;sum&#39;,</span><span class="se">\\</span><span class="s2">n          timeframe: &#39;daily&#39;</span><span class="se">\\</span><span class="s2">n        }</span><span class="se">\\</span><span class="s2">n      \],</span><span class="se">\\</span><span class="s2">n      refreshInterval: 3600 // secondes</span><span class="se">\\</span><span class="s2">n    },</span><span class="se">\\</span><span class="s2">n    {</span><span class="se">\\</span><span class="s2">n      name: &#39;notion\_usage&#39;,</span><span class="se">\\</span><span class="s2">n      title: &#39;Utilisation de Notion&#39;,</span><span class="se">\\</span><span class="s2">n      description: &#39;Tableau de bord de suivi de l</span><span class="se">\\\\</span><span class="s2">&#39;utilisation des bases Notion&#39;,</span><span class="se">\\</span><span class="s2">n      metrics: \[</span><span class="se">\\</span><span class="s2">n        {</span><span class="se">\\</span><span class="s2">n          name: &#39;record\_count&#39;,</span><span class="se">\\</span><span class="s2">n          title: &#39;Nombre d</span><span class="se">\\\\</span><span class="s2">&#39;Enregistrements&#39;,</span><span class="se">\\</span><span class="s2">n          type: &#39;bar&#39;,</span><span class="se">\\</span><span class="s2">n          source: &#39;Agence\_Monitoring\_N8N&#39;,</span><span class="se">\\</span><span class="s2">n          filter: {</span><span class="se">\\</span><span class="s2">n            property: &#39;metricType&#39;,</span><span class="se">\\</span><span class="s2">n            value: &#39;notionRecordCount&#39;</span><span class="se">\\</span><span class="s2">n          },</span><span class="se">\\</span><span class="s2">n          aggregation: &#39;latest&#39;,</span><span class="se">\\</span><span class="s2">n          timeframe: &#39;daily&#39;</span><span class="se">\\</span><span class="s2">n        },</span><span class="se">\\</span><span class="s2">n        {</span><span class="se">\\</span><span class="s2">n          name: &#39;update\_frequency&#39;,</span><span class="se">\\</span><span class="s2">n          title: &#39;Fréquence de Mise à Jour&#39;,</span><span class="se">\\</span><span class="s2">n          type: &#39;line&#39;,</span><span class="se">\\</span><span class="s2">n          source: &#39;Agence\_Monitoring\_N8N&#39;,</span><span class="se">\\</span><span class="s2">n          filter: {</span><span class="se">\\</span><span class="s2">n            property: &#39;metricType&#39;,</span><span class="se">\\</span><span class="s2">n            value: &#39;notionUpdateFrequency&#39;</span><span class="se">\\</span><span class="s2">n          },</span><span class="se">\\</span><span class="s2">n          aggregation: &#39;avg&#39;,</span><span class="se">\\</span><span class="s2">n          timeframe: &#39;daily&#39;</span><span class="se">\\</span><span class="s2">n        }</span><span class="se">\\</span><span class="s2">n      \],</span><span class="se">\\</span><span class="s2">n      refreshInterval: 7200 // secondes</span><span class="se">\\</span><span class="s2">n    }</span><span class="se">\\</span><span class="s2">n  \],</span><span class="se">\\</span><span class="s2">n  settings: {</span><span class="se">\\</span><span class="s2">n    defaultTimeRange: &#39;last7days&#39;,</span><span class="se">\\</span><span class="s2">n    theme: &#39;light&#39;,</span><span class="se">\\</span><span class="s2">n    exportFormats: \[&#39;csv&#39;, &#39;json&#39;\]</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  metadata: {</span><span class="se">\\</span><span class="s2">n    createdAt: new Date().toISOString(),</span><span class="se">\\</span><span class="s2">n    updatedAt: new Date().toISOString(),</span><span class="se">\\</span><span class="s2">n    version: &#39;1.0.0&#39;</span><span class="se">\\</span><span class="s2">n  }</span><span class="se">\\</span><span class="s2">n};</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Convertir en JSON formaté</span><span class="se">\\</span><span class="s2">nconst configJson \= JSON.stringify(defaultConfig, null, 2);</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">nreturn {</span><span class="se">\\</span><span class="s2">n  json: {</span><span class="se">\\</span><span class="s2">n    action: &#39;create&#39;,</span><span class="se">\\</span><span class="s2">n    config: defaultConfig</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  binary: {</span><span class="se">\\</span><span class="s2">n    data: {</span><span class="se">\\</span><span class="s2">n      mimeType: &#39;application/json&#39;,</span><span class="se">\\</span><span class="s2">n      data: Buffer.from(configJson).toString(&#39;base64&#39;),</span><span class="se">\\</span><span class="s2">n      fileName: &#39;dashboard\_config.json&#39;</span><span class="se">\\</span><span class="s2">n    }</span><span class="se">\\</span><span class="s2">n  }</span><span class="se">\\</span><span class="s2">n};&quot;</span>  
</pre></div>
</div>
<p>“name”: “Créer Config Par Défaut”,<br />”type”: “n8n-nodes-base.function”,<br />”position”: [700, 200]<br />”functionCode”: “// Traiter la configuration existante\nconst configData = $binary.data.toString();\n\n// Parser la configuration\nlet dashboardConfig;\ntry {\n  dashboardConfig = JSON.parse(configData);\n} catch (error) {\n  return {\n    json: {\n      status: ‘error’,\n      message: ‘Erreur de parsing de la configuration du dashboard’,\n      error: error.message\n    }\n  };\n}\n\n// Mettre à jour les métadonnées\ndashboardConfig.metadata.updatedAt = new Date().toISOString();\n\n// Convertir en JSON formaté\nconst updatedConfigJson = JSON.stringify(dashboardConfig, null, 2);\n\nreturn {\n  json: {\n    action: ‘update’,\n    config: dashboardConfig\n  },\n  binary: {\n    data: {\n      mimeType: ‘application/json’,\n      data: Buffer.from(updatedConfigJson).toString(’base64’),\n      fileName: ‘dashboard_config.json’\n    }\n  }\n};”<br />”name”: “Traiter Config Existante”,<br />”position”: [700, 400]<br />”options”: {}<br />”name”: “Sauvegarder Config”,<br />”type”: “n8n-nodes-base.writeBinaryFile”,<br />”position”: [900, 300]<br />”authentication”: “notionApi”,<br />”operation”: “getDatabases”,<br />”returnAll”: true<br />”name”: “Lister Bases Notion”,<br />”type”: “n8n-nodes-base.notion”,<br />”position”: [1100, 300]<br />”value1”: “={{$json.title}}”,<br />”operation”: “contains”,<br />”value2”: “Monitoring”<br />”name”: “Filtrer Base Monitoring”,<br />”position”: [1300, 300]<br />”databaseId”: “={{$json.id}}”,<br />”returnAll”: true,<br />”filters”: {<br />”filter”: {<br />”conditions”: [<br />”key”: “metricType”,<br />”condition”: “exists”<br />”name”: “Récupérer Métriques”,<br />”position”: [1500, 200]<br />”functionCode”: “// Agréger les métriques pour les tableaux de bord\nconst metrics = $input.all;\nconst config = $node[’Sauvegarder Config’].json.config;\n\n// Organiser les métriques par type\nconst metricsByType = {};\n\nmetrics.forEach(item =&gt; {\n  const properties = item.json.properties;\n  const metricType = properties.metricType?.select?.name || ‘unknown’;\n  \n  if (!metricsByType[metricType]) {\n    metricsByType[metricType] = [];\n  }\n  \n  // Extraire les valeurs des propriétés\n  const metric = {\n    id: item.json.id,\n    timestamp: properties.timestamp?.date?.start || new Date().toISOString(),\n    value: properties.value?.number || 0,\n    workflowName: properties.workflowName?.title?.[0]?.plain_text || ‘N/A’,\n    details: properties.details?.rich_text?.[0]?.plain_text || ‘’\n  };\n  \n  metricsByType[metricType].push(metric);\n});\n\n// Générer les données pour chaque dashboard\nconst dashboardData = {};\n\nconfig.dashboards.forEach(dashboard =&gt; {\n  const dashboardMetrics = {};\n  \n  dashboard.metrics.forEach(metricConfig =&gt; {\n    const filter = metricConfig.filter || {};\n    const filteredMetrics = metricsByType[filter.value] || [];\n    \n    // Appliquer l’agrégation\n    let aggregatedValue;\n    switch (metricConfig.aggregation) {\n      case ‘sum’:\n        aggregatedValue = filteredMetrics.reduce((sum, m) =&gt; sum + m.value, 0);\n        break;\n      case ‘avg’:\n        aggregatedValue = filteredMetrics.length &gt; 0 ?\n          filteredMetrics.reduce((sum, m) =&gt; sum + m.value, 0) / filteredMetrics.length :\n          0;\n        break;\n      case ‘max’:\n        aggregatedValue = filteredMetrics.length &gt; 0 ?\n          Math.max(…filteredMetrics.map(m =&gt; m.value)) :\n          0;\n        break;\n      case ‘min’:\n        aggregatedValue = filteredMetrics.length &gt; 0 ?\n          Math.min(…filteredMetrics.map(m =&gt; m.value)) :\n          0;\n        break;\n      case ‘latest’:\n        aggregatedValue = filteredMetrics.length &gt; 0 ?\n          filteredMetrics.sort((a, b) =&gt; new Date(b.timestamp) - new Date(a.timestamp))[0].value :\n          0;\n        break;\n      default:\n        aggregatedValue = 0;\n    }\n    \n    // Organiser par timeframe\n    const timeframeData = {};\n    \n    if (metricConfig.timeframe === ‘daily’) {\n      // Regrouper par jour\n      filteredMetrics.forEach(metric =&gt; {\n        const date = metric.timestamp.split(’T’)[0];\n        if (!timeframeData[date]) {\n          timeframeData[date] = [];\n        }\n        timeframeData[date].push(metric.value);\n      });\n    }\n    \n    // Calculer les valeurs agrégées par timeframe\n    const timeSeriesData = Object.entries(timeframeData).map(([date, values]) =&gt; {\n      let value;\n      switch (metricConfig.aggregation) {\n        case ‘sum’:\n          value = values.reduce((sum, v) =&gt; sum + v, 0);\n          break;\n        case ‘avg’:\n          value = values.reduce((sum, v) =&gt; sum + v, 0) / values.length;\n          break;\n        case ‘max’:\n          value = Math.max(…values);\n          break;\n        case ‘min’:\n          value = Math.min(…values);\n          break;\n        default:\n          value = values[0];\n      }\n      \n      return { date, value };\n    });\n    \n    dashboardMetrics[metricConfig.name] = {\n      title: metricConfig.title,\n      type: metricConfig.type,\n      aggregatedValue,\n      timeSeriesData\n    };\n  });\n  \n  dashboardData[dashboard.name] = {\n    title: dashboard.title,\n    description: dashboard.description,\n    metrics: dashboardMetrics,\n    generatedAt: new Date().toISOString()\n  };\n});\n\nreturn {\n  json: {\n    dashboardData\n  }\n};”<br />”name”: “Agréger Métriques”,<br />”position”: [1700, 200]<br />”functionCode”: “// Générer le HTML du tableau de bord\nconst dashboardData = $input.item.json.dashboardData;\nconst config = $node[’Sauvegarder Config’].json.config;\n\n// Générer le HTML pour chaque dashboard\nlet dashboardsHtml = ‘’;\n\nObject.entries(dashboardData).forEach(([dashboardName, dashboard]) =&gt; {\n  dashboardsHtml += `\n    &lt;div class=\”dashboard\” id=\”${dashboardName}\”&gt;\n      &lt;h2&gt;${dashboard.title}&lt;/h2&gt;\n      &lt;p&gt;${dashboard.description}&lt;/p&gt;\n      &lt;div class=\”metrics-container\”&gt;\n  `;\n  \n  // Générer le HTML pour chaque métrique\n  Object.entries(dashboard.metrics).forEach(([metricName, metric]) =&gt; {\n    dashboardsHtml += `\n        &lt;div class=\”metric-card\”&gt;\n          &lt;h3&gt;${metric.title}&lt;/h3&gt;\n          &lt;div class=\”metric-value\”&gt;${formatValue(metric.aggregatedValue)}&lt;/div&gt;\n          &lt;div class=\”metric-chart\” id=\”chart-${dashboardName}-${metricName}\”&gt;&lt;/div&gt;\n        &lt;/div&gt;\n    `;\n  });\n  \n  dashboardsHtml += `\n      &lt;/div&gt;\n    &lt;/div&gt;\n  `;\n});\n\n// Générer le script pour les graphiques\nlet chartsScript = `\n&lt;script&gt;\n  document.addEventListener(’DOMContentLoaded’, function() {\n`;\n\nObject.entries(dashboardData).forEach(([dashboardName, dashboard]) =&gt; {\n  Object.entries(dashboard.metrics).forEach(([metricName, metric]) =&gt; {\n    const chartData = metric.timeSeriesData;\n    const chartType = metric.type;\n    \n    chartsScript += `\n    // Chart for ${metric.title}\n    const ctx${dashboardName}${metricName} = document.getElementById(’chart-${dashboardName}-${metricName}’).getContext(’2d’);\n    new Chart(ctx${dashboardName}${metricName}, {\n      type: ‘${chartType}’,\n      data: {\n        labels: [${chartData.map(d =&gt; `’${d.date}’`).join(’, ‘)}],\n        datasets: [{\n          label: ‘${metric.title}’,\n          data: [${chartData.map(d =&gt; d.value).join(’, ‘)}],\n          backgroundColor: ‘${getChartColor(metricName, 0.2)}’,\n          borderColor: ‘${getChartColor(metricName, 1)}’,\n          borderWidth: 1\n        }]\n      },\n      options: {\n        responsive: true,\n        scales: {\n          y: {\n            beginAtZero: true\n          }\n        }\n      }\n    });\n    `;\n  });\n});\n\nchartsScript += `\n  });\n&lt;/script&gt;\n`;\n\n// Générer le HTML complet\nconst html = `\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\”fr\”&gt;\n&lt;head&gt;\n  &lt;meta charset=\”UTF-8\”&gt;\n  &lt;meta name=\”viewport\” content=\”width=device-width, initial-scale=1.0\”&gt;\n  &lt;title&gt;Tableaux de Bord - Plan Magistral V5&lt;/title&gt;\n  &lt;script src=\”https://cdn.jsdelivr.net/npm/chart.js\”&gt;&lt;/script&gt;\n  &lt;style&gt;\n    body {\n      font-family: Arial, sans-serif;\n      margin: 0;\n      padding: 20px;\n      background-color: ${config.settings.theme === ‘dark’ ? ‘#1e1e1e’ : ‘#f5f5f5’};\n      color: ${config.settings.theme === ‘dark’ ? ‘#ffffff’ : ‘#333333’};\n    }\n    .dashboard {\n      background-color: ${config.settings.theme === ‘dark’ ? ‘#2d2d2d’ : ‘#ffffff’};\n      border-radius: 8px;\n      padding: 20px;\n      margin-bottom: 30px;\n      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n    }\n    h2 {\n      margin-top: 0;\n      border-bottom: 1px solid ${config.settings.theme === ‘dark’ ? ‘#444’ : ‘#eee’};\n      padding-bottom: 10px;\n    }\n    .metrics-container {\n      display: grid;\n      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n      gap: 20px;\n      margin-top: 20px;\n    }\n    .metric-card {\n      background-color: ${config.settings.theme === ‘dark’ ? ‘#3d3d3d’ : ‘#f9f9f9’};\n      border-radius: 6px;\n      padding: 15px;\n      box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);\n    }\n    .metric-value {\n      font-size: 24px;\n      font-weight: bold;\n      margin: 10px 0;\n      color: #4a90e2;\n    }\n    .metric-chart {\n      height: 200px;\n      margin-top: 15px;\n    }\n    .header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 20px;\n    }\n    .export-buttons {\n      display: flex;\n      gap: 10px;\n    }\n    .export-button {\n      padding: 8px 12px;\n      background-color: #4a90e2;\n      color: white;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n    .export-button:hover {\n      background-color: #3a80d2;\n    }\n    .last-updated {\n      font-size: 12px;\n      color: ${config.settings.theme === ‘dark’ ? ‘#aaa’ : ‘#888’};\n      text-align: right;\n      margin-top: 5px;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div class=\”header\”&gt;\n    &lt;h1&gt;Tableaux de Bord - Plan Magistral V5&lt;/h1&gt;\n    &lt;div class=\”export-buttons\”&gt;\n      ${config.settings.exportFormats.includes(’csv’) ? ‘&lt;button class=\”export-button\” onclick=\”exportCSV()\”&gt;Exporter CSV&lt;/button&gt;’ : ‘’}\n      ${config.settings.exportFormats.includes(’json’) ? ‘&lt;button class=\”export-button\” onclick=\”exportJSON()\”&gt;Exporter JSON&lt;/button&gt;’ : ‘’}\n    &lt;/div&gt;\n  &lt;/div&gt;\n  \n  ${dashboardsHtml}\n  \n  &lt;div class=\”last-updated\”&gt;\n    Dernière mise à jour: ${new Date().toLocaleString(’fr-FR’)}\n  &lt;/div&gt;\n  \n  ${chartsScript}\n  \n  &lt;script&gt;\n    // Export functions\n    function exportCSV() {\n      const dashboardData = ${JSON.stringify(dashboardData)};\n      let csv = ‘Dashboard,Metric,Date,Value\\n’;\n      \n      Object.entries(dashboardData).forEach(([dashboardName, dashboard]) =&gt; {\n        Object.entries(dashboard.metrics).forEach(([metricName, metric]) =&gt; {\n          metric.timeSeriesData.forEach(point =&gt; {\n            csv += `\”${dashboard.title}\”,\”${metric.title}\”,\”${point.date}\”,${point.value}\\n`;\n          });\n        });\n      });\n      \n      downloadFile(csv, ‘dashboard_data.csv’, ‘text/csv’);\n    }\n    \n    function exportJSON() {\n      const dashboardData = ${JSON.stringify(dashboardData)};\n      downloadFile(JSON.stringify(dashboardData, null, 2), ‘dashboard_data.json’, ‘application/json’);\n    }\n    \n    function downloadFile(content, fileName, contentType) {\n      const a = document.createElement(’a’);\n      const file = new Blob([content], {type: contentType});\n      a.href = URL.createObjectURL(file);\n      a.download = fileName;\n      a.click();\n    }\n  &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n`;\n\n// Fonctions utilitaires\nfunction formatValue(value) {\n  if (typeof value === ‘number’) {\n    return value.toLocaleString(’fr-FR’, { maximumFractionDigits: 2 });\n  }\n  return value;\n}\n\nfunction getChartColor(metricName, alpha) {\n  // Générer une couleur basée sur le nom de la métrique\n  const hash = metricName.split(’’).reduce((acc, char) =&gt; {\n    return char.charCodeAt(0) + ((acc &lt;&lt; 5) - acc);\n  }, 0);\n  \n  const h = Math.abs(hash) % 360;\n  return `hsla(${h}, 70%, 60%, ${alpha})`;\n}\n\nreturn {\n  json: {\n    dashboardData\n  },\n  binary: {\n    dashboard: {\n      mimeType: ‘text/html’,\n      data: Buffer.from(html).toString(’base64’),\n      fileName: ‘dashboard.html’\n    }\n  }\n};”<br />”name”: “Générer Dashboard HTML”,<br />”position”: [1900, 200]<br />”path”: “dashboards/dashboard.html”,<br />”name”: “Sauvegarder Dashboard”,<br />”position”: [2100, 200]</p>
</section>
<section id="implementation-des-mecanismes-de-recuperation-a-name-section-1-5-3-a">
<h4>1.5.3. Implémentation des Mécanismes de Récupération <a name='section-1-5-3'></a><a class="headerlink" href="#implementation-des-mecanismes-de-recuperation-a-name-section-1-5-3-a" title="Link to this heading"></a></h4>
</section>
<section id="id8">
<h4>Workflows à Développer<a class="headerlink" href="#id8" title="Link to this heading"></a></h4>
<ol class="simple">
<li><p>WF-RECOVERY-MANAGER</p>
<ul class="simple">
<li><p>Objectif: Mettre en place des mécanismes de récupération en cas d’échec des workflows</p></li>
<li><p>Structure JSON:</p></li>
</ul>
</li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WF-RECOVERY-MANAGER&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">  </span><span class="nt">&quot;nodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;recovery&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;responseMode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;onReceived&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;options&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span>
<span class="w">      </span><span class="p">},</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Webhook&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;n8n-nodes-base.webhook&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;position&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">]</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;functionCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="nt">&quot;// Validation des paramètres d&#39;entrée\nconst input = $input.item.json;\n\n// Vérifier les paramètres requis\nif (!input.workflowId) {\n  return {\n    json: {\n      success: false,\n      error: &#39;Le paramètre workflowId est requis&#39;\n    }\n  };\n}\n\n// Déterminer l&#39;action\nconst action = input.action || &#39;recover&#39;;\n\n// Retourner les informations pour le traitement\nreturn {\n  json: {\n    workflowId: input.workflowId,\n    workflowName: input.workflowName || &#39;Unknown&#39;,\n    executionId: input.executionId,\n    action,\n    error: input.error || {},\n    context: input.context || {},\n    timestamp: new Date().toISOString()\n  }\n};&quot;</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Valider Requête&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;n8n-nodes-base.function&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">      </span><span class="nt">&quot;position&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">]</span><span class="w">  </span>
<span class="w">        </span><span class="nt">&quot;conditions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">          </span><span class="nt">&quot;string&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  </span>
<span class="w">              </span><span class="nt">&quot;value1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;={{$json.action}}&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">              </span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;equal&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">              </span><span class="nt">&quot;value2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;recover&quot;</span><span class="w">  </span>
<span class="w">            </span><span class="p">}</span><span class="w">  </span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      \<span class="p">]</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Action?&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.if&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">300</span>\<span class="p">]</span>  
    <span class="s2">&quot;functionCode&quot;</span><span class="p">:</span> <span class="s2">&quot;// Logique de récupération</span><span class="se">\\</span><span class="s2">nconst workflowId \= $input.item.json.workflowId;</span><span class="se">\\</span><span class="s2">nconst workflowName \= $input.item.json.workflowName;</span><span class="se">\\</span><span class="s2">nconst executionId \= $input.item.json.executionId;</span><span class="se">\\</span><span class="s2">nconst error \= $input.item.json.error;</span><span class="se">\\</span><span class="s2">nconst context \= $input.item.json.context;</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Enregistrer l&#39;erreur</span><span class="se">\\</span><span class="s2">nconst recoveryLog \= {</span><span class="se">\\</span><span class="s2">n  workflowId,</span><span class="se">\\</span><span class="s2">n  workflowName,</span><span class="se">\\</span><span class="s2">n  executionId,</span><span class="se">\\</span><span class="s2">n  error,</span><span class="se">\\</span><span class="s2">n  context,</span><span class="se">\\</span><span class="s2">n  timestamp: new Date().toISOString(),</span><span class="se">\\</span><span class="s2">n  recoveryAttempt: 1,</span><span class="se">\\</span><span class="s2">n  status: &#39;pending&#39;</span><span class="se">\\</span><span class="s2">n};</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Déterminer la stratégie de récupération</span><span class="se">\\</span><span class="s2">nlet recoveryStrategy;</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Analyser l&#39;erreur pour déterminer la stratégie</span><span class="se">\\</span><span class="s2">nif (error.message &amp;&amp; error.message.includes(&#39;timeout&#39;)) {</span><span class="se">\\</span><span class="s2">n  recoveryStrategy \= &#39;retry&#39;;</span><span class="se">\\</span><span class="s2">n} else if (error.message &amp;&amp; error.message.includes(&#39;rate limit&#39;)) {</span><span class="se">\\</span><span class="s2">n  recoveryStrategy \= &#39;delay\_retry&#39;;</span><span class="se">\\</span><span class="s2">n} else if (error.message &amp;&amp; error.message.includes(&#39;credential&#39;)) {</span><span class="se">\\</span><span class="s2">n  recoveryStrategy \= &#39;notify\_admin&#39;;</span><span class="se">\\</span><span class="s2">n} else {</span><span class="se">\\</span><span class="s2">n  recoveryStrategy \= &#39;default&#39;;</span><span class="se">\\</span><span class="s2">n}</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Ajouter la stratégie au log</span><span class="se">\\</span><span class="s2">nrecoveryLog.recoveryStrategy \= recoveryStrategy;</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Convertir en JSON formaté</span><span class="se">\\</span><span class="s2">nconst logJson \= JSON.stringify(recoveryLog, null, 2);</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">nreturn {</span><span class="se">\\</span><span class="s2">n  json: {</span><span class="se">\\</span><span class="s2">n    workflowId,</span><span class="se">\\</span><span class="s2">n    workflowName,</span><span class="se">\\</span><span class="s2">n    executionId,</span><span class="se">\\</span><span class="s2">n    recoveryStrategy,</span><span class="se">\\</span><span class="s2">n    recoveryLog</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  binary: {</span><span class="se">\\</span><span class="s2">n    log: {</span><span class="se">\\</span><span class="s2">n      mimeType: &#39;application/json&#39;,</span><span class="se">\\</span><span class="s2">n      data: Buffer.from(logJson).toString(&#39;base64&#39;),</span><span class="se">\\</span><span class="s2">n      fileName: \`recovery\_$</span><span class="si">{workflowId}</span><span class="s2">\_${new Date().toISOString().replace(/\[:.\]/g, &#39;-&#39;)}.json\`</span><span class="se">\\</span><span class="s2">n    }</span><span class="se">\\</span><span class="s2">n  }</span><span class="se">\\</span><span class="s2">n};&quot;</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Traiter Récupération&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">700</span><span class="p">,</span> <span class="mi">200</span>\<span class="p">]</span>  
    <span class="s2">&quot;functionCode&quot;</span><span class="p">:</span> <span class="s2">&quot;// Logique de sauvegarde</span><span class="se">\\</span><span class="s2">nconst workflowId \= $input.item.json.workflowId;</span><span class="se">\\</span><span class="s2">nconst workflowName \= $input.item.json.workflowName;</span><span class="se">\\</span><span class="s2">nconst context \= $input.item.json.context;</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Créer une sauvegarde</span><span class="se">\\</span><span class="s2">nconst backupLog \= {</span><span class="se">\\</span><span class="s2">n  workflowId,</span><span class="se">\\</span><span class="s2">n  workflowName,</span><span class="se">\\</span><span class="s2">n  context,</span><span class="se">\\</span><span class="s2">n  timestamp: new Date().toISOString(),</span><span class="se">\\</span><span class="s2">n  status: &#39;completed&#39;</span><span class="se">\\</span><span class="s2">n};</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">n// Convertir en JSON formaté</span><span class="se">\\</span><span class="s2">nconst logJson \= JSON.stringify(backupLog, null, 2);</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">nreturn {</span><span class="se">\\</span><span class="s2">n  json: {</span><span class="se">\\</span><span class="s2">n    workflowId,</span><span class="se">\\</span><span class="s2">n    workflowName,</span><span class="se">\\</span><span class="s2">n    backupLog</span><span class="se">\\</span><span class="s2">n  },</span><span class="se">\\</span><span class="s2">n  binary: {</span><span class="se">\\</span><span class="s2">n    log: {</span><span class="se">\\</span><span class="s2">n      mimeType: &#39;application/json&#39;,</span><span class="se">\\</span><span class="s2">n      data: Buffer.from(logJson).toString(&#39;base64&#39;),</span><span class="se">\\</span><span class="s2">n      fileName: \`backup\_$</span><span class="si">{workflowId}</span><span class="s2">\_${new Date().toISOString().replace(/\[:.\]/g, &#39;-&#39;)}.json\`</span><span class="se">\\</span><span class="s2">n    }</span><span class="se">\\</span><span class="s2">n  }</span><span class="se">\\</span><span class="s2">n};&quot;</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Traiter Sauvegarde&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">700</span><span class="p">,</span> <span class="mi">400</span>\<span class="p">]</span>  
    <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;logs/recovery/{{$binary.log.fileName}}&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Sauvegarder Log&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.writeBinaryFile&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">900</span><span class="p">,</span> <span class="mi">300</span>\<span class="p">]</span>  
          <span class="s2">&quot;value1&quot;</span><span class="p">:</span> <span class="s2">&quot;={{$json.recoveryStrategy}}&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value2&quot;</span><span class="p">:</span> <span class="s2">&quot;retry&quot;</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Stratégie?&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">1100</span><span class="p">,</span> <span class="mi">200</span>\<span class="p">]</span>  
    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;=http://localhost:5678/rest/workflows/{{$json.workflowId}}/execute&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;authentication&quot;</span><span class="p">:</span> <span class="s2">&quot;genericCredentialType&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;genericAuthType&quot;</span><span class="p">:</span> <span class="s2">&quot;n8nApi&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;sendBody&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>  
    <span class="s2">&quot;bodyParameters&quot;</span><span class="p">:</span> <span class="p">{</span>  
      <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> \<span class="p">[</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;={{$json.context}}&quot;</span>  
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;recovery&quot;</span><span class="p">,</span>  
          <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">true</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Réexécuter Workflow&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.httpRequest&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">1300</span><span class="p">,</span> <span class="mi">100</span>\<span class="p">]</span>  
    <span class="s2">&quot;functionCode&quot;</span><span class="p">:</span> <span class="s2">&quot;// Attendre avant de réessayer</span><span class="se">\\</span><span class="s2">nreturn new Promise(resolve \=\&gt; {</span><span class="se">\\</span><span class="s2">n  // Attendre 5 minutes</span><span class="se">\\</span><span class="s2">n  setTimeout(() \=\&gt; {</span><span class="se">\\</span><span class="s2">n    resolve({</span><span class="se">\\</span><span class="s2">n      json: {</span><span class="se">\\</span><span class="s2">n        ...$input.item.json,</span><span class="se">\\</span><span class="s2">n        delayedRetry: true,</span><span class="se">\\</span><span class="s2">n        delayMinutes: 5</span><span class="se">\\</span><span class="s2">n      }</span><span class="se">\\</span><span class="s2">n    });</span><span class="se">\\</span><span class="s2">n  }, 5 \* 60 \* 1000);</span><span class="se">\\</span><span class="s2">n});&quot;</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Attendre et Réessayer&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">1300</span><span class="p">,</span> <span class="mi">300</span>\<span class="p">]</span>  
    <span class="s2">&quot;chatId&quot;</span><span class="p">:</span> <span class="s2">&quot;{{$env.TELEGRAM\_CHAT\_ID}}&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;=⚠️ ALERTE RÉCUPÉRATION</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">nLe workflow {{$json.workflowName}} (ID: {{$json.workflowId}}) a rencontré une erreur nécessitant une intervention manuelle.</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">nErreur: {{$json.error.message}}</span><span class="se">\\</span><span class="s2">n</span><span class="se">\\</span><span class="s2">nVeuillez vérifier les logs de récupération pour plus de détails.&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;additionalFields&quot;</span><span class="p">:</span> <span class="p">{}</span>  
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Notifier Admin&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;n8n-nodes-base.telegram&quot;</span><span class="p">,</span>  
  <span class="s2">&quot;position&quot;</span><span class="p">:</span> \<span class="p">[</span><span class="mi">1300</span><span class="p">,</span> <span class="mi">500</span>\<span class="p">]</span>  
</pre></div>
</div>
<p>],<br />”connections”: {<br />”Webhook”: {<br />”main”: [<br />[<br />”node”: “Valider Requête”,<br />”type”: “main”,<br />”index”: 0<br />”Valider Requête”: {<br />”node”: “Action?”,<br />”Action?”: {<br />”node”: “Traiter Récupération”,<br />”node”: “Traiter Sauvegarde”,<br />”Traiter Récupération”: {</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="s2">&quot;Sauvegarder Log&quot;</span><span class="p">,</span>  
</pre></div>
</div>
<p>“Traiter Sauvegarde”: {<br />”Sauvegarder Log”: {<br />”node”: “Stratégie?”,<br />”Stratégie?”: {<br />”node”: “Réexécuter Workflow”,<br />”node”: “Attendre et Réessayer”,<br />”node”: “Notifier Admin”,<br />”Attendre et Réessayer”: {</p>
<p>WF-BACKUP-SCHEDULER</p>
<ul>
<li><p>Objectif: Planifier et gérer les sauvegardes automatiques des workflows et des données</p>
<p>“name”: “WF-BACKUP-SCHEDULER”,<br />”rule”: {<br />”interval”: [<br />”field”: “hours”,<br />”hour”: 1<br />”name”: “Déclencheur Cron”,<br />”type”: “n8n-nodes-base.cron”,<br />”path”: “configs/backup_config.json”,<br />”options”: {<br />”encoding”: “utf8”<br />”name”: “Charger Config Backup”,<br />”type”: “n8n-nodes-base.readBinaryFile”,<br />”value1”: “={{$json.errorMessage}}”,<br />”operation”: “exists”<br />”name”: “Config Existe?”,<br />”functionCode”: “// Créer une configuration par défaut\nconst defaultConfig = {\n  backupSchedule: {\n    workflows: {\n      frequency: ‘daily’,\n      time: ‘01:00’,\n      retention: 7 // jours\n    },\n    notion: {\n      frequency: ‘daily’,\n      time: ‘02:00’,\n      retention: 14 // jours\n    },\n    configurations: {\n      frequency: ‘hourly’,\n      retention: 24 // heures\n    }\n  },\n  backupLocations: {\n    local: {\n      enabled: true,\n      path: ‘backups/’\n    },\n    remote: {\n      enabled: false,\n      type: ‘gdrive’,\n      folderId: ‘’\n    }\n  },\n  notifications: {\n    onSuccess: false,\n    onFailure: true,\n    channels: [’telegram’]\n  },\n  metadata: {\n    createdAt: new Date().toISOString(),\n    updatedAt: new Date().toISOString(),\n    version: ‘1.0.0’\n  }\n};\n\n// Convertir en JSON formaté\nconst configJson = JSON.stringify(defaultConfig, null, 2);\n\nreturn {\n  json: {\n    action: ‘create’,\n    config: defaultConfig\n  },\n  binary: {\n    data: {\n      mimeType: ‘application/json’,\n      data: Buffer.from(configJson).toString(’base64’),\n      fileName: ‘backup_config.json’\n    }\n  }\n};”<br />”name”: “Créer Config Par Défaut”,<br />”functionCode”: “// Traiter la configuration existante\nconst configData = $binary.data.toString();\n\n// Parser la configuration\nlet backupConfig;\ntry {\n  backupConfig = JSON.parse(configData);\n} catch (error) {\n  return {\n    json: {\n      status: ‘error’,\n      message: ‘Erreur de parsing de la configuration de backup’,\n      error: error.message\n    }\n  };\n}\n\n// Mettre à jour les métadonnées\nbackupConfig.metadata.updatedAt = new Date().toISOString();\n\n// Convertir en JSON formaté\nconst updatedConfigJson = JSON.stringify(backupConfig, null, 2);\n\nreturn {\n  json: {\n    action: ‘update’,\n    config: backupConfig\n  },\n  binary: {\n    data: {\n      mimeType: ‘application/json’,\n      data: Buffer.from(updatedConfigJson).toString(’base64’),\n      fileName: ‘backup_config.json’\n    }\n  }\n};”<br />”name”: “Traiter Config Existante”,<br />”name”: “Sauvegarder Config”,<br />”url”: “http://localhost:5678/rest/workflows”,<br />”name”: “Lister Workflows”,<br />”position”: [1100, 300]<br />”functionCode”: “// Préparer les tâches de backup\nconst workflows = $json.data || [];\nconst config = $node[’Sauvegarder Config’].json.config;\nconst now = new Date();\n\n// Déterminer quels backups doivent être exécutés maintenant\nconst backupTasks = [];\n\n// Vérifier si c’est l’heure du backup des workflows\nif (config.backupSchedule.workflows.frequency === ‘daily’) {\n  const [hour, minute] = config.backupSchedule.workflows.time.split(’:’).map(Number);\n  if (now.getHours() === hour &amp;&amp; now.getMinutes() &lt; 15) { // Fenêtre de 15 minutes\n    backupTasks.push({\n      type: ‘workflows’,\n      items: workflows.map(wf =&gt; ({\n        id: wf.id,\n        name: wf.name\n      })),\n      config: config.backupSchedule.workflows\n    });\n  }\n}\n\n// Vérifier si c’est l’heure du backup Notion\nif (config.backupSchedule.notion.frequency === ‘daily’) {\n  const [hour, minute] = config.backupSchedule.notion.time.split(’:’).map(Number);\n  if (now.getHours() === hour &amp;&amp; now.getMinutes() &lt; 15) { // Fenêtre de 15 minutes\n    backupTasks.push({\n      type: ‘notion’,\n      config: config.backupSchedule.notion\n    });\n  }\n}\n\n// Backup des configurations (horaire)\nif (config.backupSchedule.configurations.frequency === ‘hourly’) {\n  backupTasks.push({\n    type: ‘configurations’,\n    config: config.backupSchedule.configurations\n  });\n}\n\nreturn {\n  json: {\n    backupTasks,\n    timestamp: now.toISOString(),\n    backupLocations: config.backupLocations\n  }\n};”<br />”name”: “Préparer Tâches Backup”,<br />”mode”: “combine”,<br />”combinationMode”: “multiplex”,<br />”name”: “Séparer Tâches”,<br />”type”: “n8n-nodes-base.splitInBatches”,<br />”position”: [1500, 300]<br />”value1”: “={{$json.type}}”,<br />”value2”: “workflows”<br />”name”: “Type Backup?”,<br />”position”: [1700, 300]<br />”name”: “Séparer Workflows”,<br />”position”: [1900, 200]<br />”url”: “=http://localhost:5678/rest/workflows/{{$json.id}}/export”,<br />”name”: “Exporter Workflow”,<br />”position”: [2100, 200]<br />”functionCode”: “// Préparer le fichier de backup\nconst workflowData = $json;\nconst backupLocations = $node[’Préparer Tâches Backup’].json.backupLocations;\nconst timestamp = new Date().toISOString().replace(/[:.]/g, ‘-’);\nconst workflowName = workflowData.name.replace(/[^a-zA-Z0-9]/g, ‘_’);\nconst fileName = `workflow_${workflowName}_${timestamp}.json`;\n\n// Déterminer le chemin de sauvegarde\nlet savePath;\nif (backupLocations.local.enabled) {\n  savePath = `${backupLocations.local.path}workflows/${fileName}`;\n}\n\n// Convertir en JSON formaté\nconst workflowJson = JSON.stringify(workflowData, null, 2);\n\nreturn {\n  json: {\n    workflowId: workflowData.id,\n    workflowName: workflowData.name,\n    fileName,\n    savePath\n  },\n  binary: {\n    data: {\n      mimeType: ‘application/json’,\n      data: Buffer.from(workflowJson).toString(’base64’),\n      fileName\n    }\n  }\n};”<br />”name”: “Préparer Fichier Backup”,<br />”position”: [2300, 200]<br />”path”: “={{$json.savePath}}”,<br />”name”: “Sauvegarder Backup”,<br />”position”: [2500, 200]<br />”authentication”: “notionApi”,<br />”operation”: “getDatabases”,<br />”returnAll”: true<br />”name”: “Lister Bases Notion”,<br />”type”: “n8n-nodes-base.notion”,<br />”position”: [1900, 400]<br />”name”: “Séparer Bases”,<br />”position”: [2100, 400]<br />”databaseId”: “={{$json.id}}”,<br />”returnAll”: true,<br />”simplifyOutput”: true<br />”name”: “Exporter Base Notion”,<br />”position”: [2300, 400]<br />”functionCode”: “// Préparer le fichier de backup Notion\nconst notionData = $input.all;\nconst databaseInfo = $input.first.json;\nconst backupLocations = $node[’Préparer Tâches Backup’].json.backupLocations;\nconst timestamp = new Date().toISOString().replace(/[:.]/g, ‘-’);\nconst databaseName = databaseInfo.title.replace(/[^a-zA-Z0-9]/g, ‘_’);\nconst fileName = `notion_${databaseName}_${timestamp}.json`;\n\n// Déterminer le chemin de sauvegarde\nlet savePath;\nif (backupLocations.local.enabled) {\n  savePath = `${backupLocations.local.path}notion/${fileName}`;\n}\n\n// Préparer les données\nconst backupData = {\n  database: databaseInfo,\n  records: notionData.map(item =&gt; item.json),\n  metadata: {\n    exportedAt: new Date().toISOString(),\n    recordCount: notionData.length\n  }\n};\n\n// Convertir en JSON formaté\nconst dataJson = JSON.stringify(backupData, null, 2);\n\nreturn {\n  json: {\n    databaseId: databaseInfo.id,\n    databaseName: databaseInfo.title,\n    recordCount: notionData.length,\n    fileName,\n    savePath\n  },\n  binary: {\n    data: {\n      mimeType: ‘application/json’,\n      data: Buffer.from(dataJson).toString(’base64’),\n      fileName\n    }\n  }\n};”<br />”name”: “Préparer Backup Notion”,<br />”position”: [2500, 400]<br />”name”: “Sauvegarder Backup Notion”,<br />”position”: [2700, 400]<br />”functionCode”: “// Backup des fichiers de configuration\nconst fs = require(’fs’);\nconst path = require(’path’);\nconst backupLocations = $node[’Préparer Tâches Backup’].json.backupLocations;\nconst timestamp = new Date().toISOString().replace(/[:.]/g, ‘-’);\n\n// Chemin du dossier des configurations\nconst configsDir = ‘configs’;\nconst backupFileName = `configurations_${timestamp}.zip`;\n\n// Déterminer le chemin de sauvegarde\nlet savePath;\nif (backupLocations.local.enabled) {\n  savePath = `${backupLocations.local.path}configurations/${backupFileName}`;\n}\n\n// Créer une archive ZIP des configurations\nconst archiver = require(’archiver’);\nconst output = fs.createWriteStream(savePath);\nconst archive = archiver(’zip’, {\n  zlib: { level: 9 } // Niveau de compression maximum\n});\n\n// Événements de l’archive\noutput.on(’close’, function() {\n  console.log(`Archive créée: ${archive.pointer()} octets`);\n});\n\narchive.on(’error’, function(err) {\n  throw err;\n});\n\n// Pipe l’archive vers le fichier de sortie\narchive.pipe(output);\n\n// Ajouter les fichiers de configuration à l’archive\narchive.directory(configsDir, ‘configs’);\n\n// Finaliser l’archive\narchive.finalize();\n\nreturn {\n  json: {\n    type: ‘configurations’,\n    fileName: backupFileName,\n    savePath,\n    timestamp: new Date().toISOString()\n  }\n};”<br />”name”: “Backup Configurations”,<br />”position”: [1900, 600]<br />”functionCode”: “// Nettoyer les anciens backups\nconst fs = require(’fs’);\nconst path = require(’path’);\nconst config = $node[’Sauvegarder Config’].json.config;\nconst backupLocations = config.backupLocations;\n\n// Fonction pour supprimer les fichiers plus anciens que la période de rétention\nfunction cleanupOldBackups(directory, retentionDays) {\n  if (!fs.existsSync(directory)) {\n    return { directory, status: ‘skipped’, reason: ‘directory_not_found’ };\n  }\n  \n  const now = new Date();\n  const files = fs.readdirSync(directory);\n  const deletedFiles = [];\n  \n  files.forEach(file =&gt; {\n    const filePath = path.join(directory, file);\n    const stats = fs.statSync(filePath);\n    const fileAge = (now - stats.mtime) / (1000 * 60 * 60 * 24); // âge en jours\n    \n    if (fileAge &gt; retentionDays) {\n      fs.unlinkSync(filePath);\n      deletedFiles.push(file);\n    }\n  });\n  \n  return {\n    directory,\n    status: ‘cleaned’,\n    deletedCount: deletedFiles.length,\n    deletedFiles\n  };\n}\n\n// Nettoyer les backups de workflows\nconst workflowsCleanup = cleanupOldBackups(\n  path.join(backupLocations.local.path, ‘workflows’),\n  config.backupSchedule.workflows.retention\n);\n\n// Nettoyer les backups Notion\nconst notionCleanup = cleanupOldBackups(\n  path.join(backupLocations.local.path, ‘notion’),\n  config.backupSchedule.notion.retention\n);\n\n// Nettoyer les backups de configurations\nconst configsCleanup = cleanupOldBackups(\n  path.join(backupLocations.local.path, ‘configurations’),\n  config.backupSchedule.configurations.retention\n);\n\nreturn {\n  json: {\n    timestamp: new Date().toISOString(),\n    cleanup: {\n      workflows: workflowsCleanup,\n      notion: notionCleanup,\n      configurations: configsCleanup\n    }\n  }\n};”<br />”name”: “Nettoyer Anciens Backups”,<br />”position”: [2700, 600]<br />”Déclencheur Cron”: {<br />”node”: “Charger Config Backup”,<br />”Charger Config Backup”: {<br />”node”: “Config Existe?”,<br />”Config Existe?”: {<br />”node”: “Créer Config Par Défaut”,<br />”node”: “Traiter Config Existante”,<br />”Créer Config Par Défaut”: {<br />”node”: “Sauvegarder Config”,<br />”Traiter Config Existante”: {<br />”Sauvegarder Config”: {<br />”node”: “Lister Workflows”,<br />”Lister Workflows”: {<br />”node”: “Préparer Tâches Backup”,<br />”Préparer Tâches Backup”: {<br />”node”: “Séparer Tâches”,<br />”Séparer Tâches”: {<br />”node”: “Type Backup?”,<br />”Type Backup?”: {<br />”node”: “Séparer Workflows”,<br />”node”: “Lister Bases Notion”,<br />”node”: “Backup Configurations”,<br />”Séparer Workflows”: {<br />”node”: “Exporter Workflow”,<br />”Exporter Workflow”: {<br />”node”: “Préparer Fichier Backup”,<br />”Préparer Fichier Backup”: {<br />”node”: “Sauvegarder Backup”,<br />”Sauvegarder Backup”: {<br />”node”: “Nettoyer Anciens Backups”,<br />”Lister Bases Notion”: {<br />”node”: “Séparer Bases”,<br />”Séparer Bases”: {<br />”node”: “Exporter Base Notion”,<br />”Exporter Base Notion”: {<br />”node”: “Préparer Backup Notion”,<br />”Préparer Backup Notion”: {<br />”node”: “Sauvegarder Backup Notion”,<br />”Sauvegarder Backup Notion”: {<br />”Backup Configurations”: {</p>
</li>
</ul>
<p>┌─────────────────────────────────────────────────────────────────────────────┐<br />│                                                                             │<br />│                  PHASE 3: INTÉGRATION AVEC LE PLAN MAGISTRAL V5             │<br />│                                                                             │<br />│  ┌─────────────────────┐     ┌─────────────────────┐     ┌─────────────────┐│<br />│  │                     │     │                     │     │                 ││<br />│  │  ÉTAPE 3.1          │     │  ÉTAPE 3.2          │     │  ÉTAPE 3.3      ││<br />│  │  STRUCTURES DE BASE │────►│  MIGRATION          │────►│  MONITORING     ││<br />│  │                     │     │  FONCTIONNALITÉS    │     │                 ││<br />│  └─────────────────────┘     └─────────────────────┘     └─────────────────┘│<br />│     │         │                  │         │                │         │     │<br />│     ▼         ▼                  ▼         ▼                ▼         ▼     │<br />│  ┌─────┐   ┌─────┐            ┌─────┐   ┌─────┐          ┌─────┐   ┌─────┐ │<br />│  │     │   │     │            │     │   │     │          │     │   │     │ │<br />│  │ P1  │◄──┤ P2  │◄───────────┤ P3  │◄──┤ P4  │          │ALERT│   │DASH │ │<br />│  │     │   │     │            │     │   │     │          │     │   │     │ │<br />│  └─────┘   └─────┘            └─────┘   └─────┘          └─────┘   └─────┘ │<br />│     ▲         ▲                  ▲         ▲                │         │     │<br />│     │         │                  │         │                ▼         ▼     │<br />│     └─────────┴──────────────────┴─────────┘          ┌─────────────────┐  │<br />│                      │                                 │                 │  │<br />│                      │                                 │  RÉCUPÉRATION   │  │<br />│                      │                                 │  ET SAUVEGARDE  │  │<br />│                      │                                 │                 │  │<br />│                      │                                 └─────────────────┘  │<br />│                      ▼                                        │             │<br />│               ┌─────────────────┐                             │             │<br />│               │                 │                             │             │<br />│               │  CONFIGURATION  │◄────────────────────────────┘             │<br />│               │  CENTRALISÉE    │                                           │<br />│               │                 │                                           │<br />│               └─────────────────┘                                           │<br />│                      │                                                      │<br />│                      │                                                      │<br />│                      ▼                                                      │<br />│               ┌─────────────────┐                                           │<br />│               │                 │                                           │<br />│               │  WEBHOOKS ET    │                                           │<br />│               │  INTÉGRATIONS   │                                           │<br />│               │                 │                                           │<br />│               └─────────────────┘                                           │<br />│                                                                             │<br />└─────────────────────────────────────────────────────────────────────────────┘</p>
</section>
</section>
<section id="conclusion-et-recommandations-a-name-section-1-6-a">
<h3>1.6. Conclusion et Recommandations <a name='section-1-6'></a><a class="headerlink" href="#conclusion-et-recommandations-a-name-section-1-6-a" title="Link to this heading"></a></h3>
<p>La Phase 3 du plan de transition est cruciale pour préparer l’infrastructure nécessaire à l’implémentation du Plan Magistral V5. Cette phase établit les fondations techniques sur lesquelles reposeront toutes les fonctionnalités futures.</p>
<section id="points-cles-a-retenir-a-name-section-1-6-1-a">
<h4>1.6.1. Points Clés à Retenir <a name='section-1-6-1'></a><a class="headerlink" href="#points-cles-a-retenir-a-name-section-1-6-1-a" title="Link to this heading"></a></h4>
<ol class="simple">
<li><p>Architecture Modulaire</p>
<ul class="simple">
<li><p>Les workflows sont organisés en piliers fonctionnels clairement définis</p></li>
<li><p>Chaque pilier a ses propres responsabilités et interfaces</p></li>
<li><p>La communication entre piliers se fait via des webhooks standardisés</p></li>
</ul>
</li>
<li><p>Configuration Centralisée</p>
<ul class="simple">
<li><p>Toutes les configurations sont stockées dans un format standardisé</p></li>
<li><p>Les workflows accèdent aux configurations via WF-CORE-CONFIG-CENTRAL</p></li>
<li><p>Les modifications de configuration sont tracées et versionnées</p></li>
</ul>
</li>
<li><p>Monitoring Robuste</p>
<ul class="simple">
<li><p>Système d’alertes configurable pour détecter les problèmes</p></li>
<li><p>Tableaux de bord pour visualiser les performances</p></li>
<li><p>Mécanismes de récupération automatique en cas d’erreur</p></li>
</ul>
</li>
<li><p>Migration Progressive</p>
<ul class="simple">
<li><p>Cartographie détaillée des fonctionnalités existantes</p></li>
<li><p>Templates pour faciliter la migration</p></li>
<li><p>Tests automatisés pour valider les fonctionnalités migrées</p></li>
</ul>
</li>
</ol>
</section>
<section id="recommandations-pour-l-implementation-a-name-section-1-6-2-a">
<h4>1.6.2. Recommandations pour l’Implémentation <a name='section-1-6-2'></a><a class="headerlink" href="#recommandations-pour-l-implementation-a-name-section-1-6-2-a" title="Link to this heading"></a></h4>
<ol class="simple">
<li><p>Ordre de Développement</p>
<ul class="simple">
<li><p>Commencer par les workflows de l’Étape 3.1 pour établir les structures de base</p></li>
<li><p>Développer ensuite les workflows de monitoring de l’Étape 3.3</p></li>
<li><p>Terminer par les workflows de migration de l’Étape 3.2</p></li>
</ul>
</li>
<li><p>Tests Approfondis</p>
<ul class="simple">
<li><p>Tester chaque workflow individuellement</p></li>
<li><p>Tester les interactions entre workflows</p></li>
<li><p>Simuler des scénarios d’erreur pour valider les mécanismes de récupération</p></li>
</ul>
</li>
<li><p>Documentation Continue</p>
<ul class="simple">
<li><p>Documenter chaque workflow au fur et à mesure de son développement</p></li>
<li><p>Maintenir à jour les guides d’interface et de migration</p></li>
<li><p>Créer des diagrammes pour visualiser les interactions entre workflows</p></li>
</ul>
</li>
<li><p>Considérations de Performance</p>
<ul class="simple">
<li><p>Optimiser les workflows qui s’exécutent fréquemment</p></li>
<li><p>Mettre en place des mécanismes de cache pour les données fréquemment utilisées</p></li>
<li><p>Surveiller l’utilisation des ressources et ajuster les configurations en conséquence</p></li>
</ul>
</li>
</ol>
<p>En suivant ce plan détaillé, l’équipe de développement pourra mettre en place une infrastructure robuste et évolutive, prête à accueillir les fonctionnalités avancées du Plan Magistral V5.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, EMAIL_SENDER_1 Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>