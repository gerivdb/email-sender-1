

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plan dâ€™ImplÃ©mentation du Workflow â€œEmail Sender 1â€ &mdash; EMAIL_SENDER_1 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            EMAIL_SENDER_1
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenu:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Documentation des API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EMAIL_SENDER_1</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Plan dâ€™ImplÃ©mentation du Workflow â€œEmail Sender 1â€</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/plans/plan de dÃ©part/PLAN_IMPLEMENTATION.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="plan-d-implementation-du-workflow-email-sender-1">
<h1>Plan dâ€™ImplÃ©mentation du Workflow â€œEmail Sender 1â€<a class="headerlink" href="#plan-d-implementation-du-workflow-email-sender-1" title="Link to this heading">ïƒ</a></h1>
<section id="philosophie-generale">
<h2>Philosophie GÃ©nÃ©rale<a class="headerlink" href="#philosophie-generale" title="Link to this heading">ïƒ</a></h2>
<ul class="simple">
<li><p><strong>Corriger dâ€™abord</strong>: PrioritÃ© Ã  la rÃ©paration des flux de donnÃ©es cassÃ©s et des logiques incohÃ©rentes dans la partie active (prospection).</p></li>
<li><p><strong>Clarifier &amp; Simplifier</strong>: Rendre le flux actuel plus lisible et logique.</p></li>
<li><p><strong>Structurer pour lâ€™Avenir</strong>: Utiliser des Sticky Notes et une disposition claire pour dÃ©limiter les phases (actuelles et futures).</p></li>
<li><p><strong>IA StratÃ©gique</strong>: IntÃ©grer lâ€™IA lÃ  oÃ¹ elle apporte une valeur ajoutÃ©e claire (gÃ©nÃ©ration de contenu, analyse des rÃ©ponses).</p></li>
<li><p><strong>Configuration Directe</strong>: Configurer les IDs, credentials et paramÃ¨tres spÃ©cifiques directement dans chaque nÅ“ud.</p></li>
</ul>
</section>
<section id="phase-0-suppression-du-noeud-de-configuration-globale">
<h2>Phase 0: Suppression du NÅ“ud de Configuration Globale<a class="headerlink" href="#phase-0-suppression-du-noeud-de-configuration-globale" title="Link to this heading">ïƒ</a></h2>
<section id="action">
<h3>Action<a class="headerlink" href="#action" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>Supprimer le nÅ“ud Set Global Config.</p></li>
</ul>
</section>
<section id="objectif">
<h3>Objectif<a class="headerlink" href="#objectif" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>Simplifier le workflow et permettre le test pas-Ã -pas (Test Step) sans dÃ©pendance Ã  un nÅ“ud de configuration initial.</p></li>
</ul>
</section>
<section id="implementation">
<h3>ImplÃ©mentation<a class="headerlink" href="#implementation" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>Retirer le nÅ“ud Set Global Config du canvas.</p></li>
<li><p>Configurer manuellement tous les paramÃ¨tres directement dans les nÅ“uds concernÃ©s.</p></li>
</ul>
</section>
<section id="avantages">
<h3>Avantages<a class="headerlink" href="#avantages" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>DÃ©bogage plus facile</p></li>
<li><p>ComprÃ©hension directe de la configuration de chaque nÅ“ud</p></li>
<li><p>Pas besoin de rÃ©fÃ©rencer un nÅ“ud central</p></li>
</ul>
</section>
</section>
<section id="phase-1-gestion-des-disponibilites-correction-critique">
<h2>Phase 1: Gestion des DisponibilitÃ©s (Correction Critique)<a class="headerlink" href="#phase-1-gestion-des-disponibilites-correction-critique" title="Link to this heading">ïƒ</a></h2>
<section id="id1">
<h3>Action<a class="headerlink" href="#id1" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>Corriger la fusion des indisponibilitÃ©s Notion &amp; Google Calendar.</p></li>
</ul>
</section>
<section id="probleme">
<h3>ProblÃ¨me<a class="headerlink" href="#probleme" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>Le nÅ“ud â€œFiltrer crÃ©neauxâ€ ne reÃ§oit que les donnÃ©es de Google Calendar; les indisponibilitÃ©s Notion sont ignorÃ©es.</p></li>
</ul>
</section>
<section id="solution-proposee">
<h3>Solution ProposÃ©e<a class="headerlink" href="#solution-proposee" title="Link to this heading">ïƒ</a></h3>
<section id="noeud-google-calendar-get-events">
<h4>1. NÅ“ud Google Calendar (Get Events)<a class="headerlink" href="#noeud-google-calendar-get-events" title="Link to this heading">ïƒ</a></h4>
<ul class="simple">
<li><p>Configurer directement le Credential appropriÃ©</p></li>
<li><p>Entrer directement lâ€™ID du Calendrier: f4641fâ€¦ (BOOKING1)</p></li>
</ul>
</section>
<section id="noeud-notion-get-database-pages-pour-dispo-membres">
<h4>2. NÅ“ud Notion (Get Database Pages pour Dispo Membres)<a class="headerlink" href="#noeud-notion-get-database-pages-pour-dispo-membres" title="Link to this heading">ïƒ</a></h4>
<ul class="simple">
<li><p>Configurer directement le Credential appropriÃ©</p></li>
<li><p>Entrer directement lâ€™ID de la Base de DonnÃ©es: 1c5814â€¦ (Dispo Membres)</p></li>
<li><p>Configurer les filtres et tris pour rÃ©cupÃ©rer les indisponibilitÃ©s pertinentes</p></li>
</ul>
</section>
<section id="nouveau-noeud-code-consolider-indisponibilites">
<h4>3. Nouveau NÅ“ud Code (Consolider IndisponibilitÃ©s)<a class="headerlink" href="#nouveau-noeud-code-consolider-indisponibilites" title="Link to this heading">ïƒ</a></h4>
<ul class="simple">
<li><p>Connecter la sortie du nÅ“ud Google Calendar Ã  lâ€™entrÃ©e 0</p></li>
<li><p>Connecter la sortie du nÅ“ud Notion (Dispo Membres) Ã  lâ€™entrÃ©e 1</p></li>
<li><p>Logique du Code:</p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">googleEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$input</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Items from Google Calendar</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">notionPages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$input</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Items from Notion Dispo Membres</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">busyDatesSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">();</span>

<span class="c1">// Process Google Calendar Events</span>
<span class="nx">googleEvents</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Adjust based on actual GCal node output structure for start/end dates</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">startDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">start</span><span class="o">?</span><span class="p">.</span><span class="nx">date</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">start</span><span class="o">?</span><span class="p">.</span><span class="nx">dateTime</span><span class="o">?</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">endDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">end</span><span class="o">?</span><span class="p">.</span><span class="nx">date</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">end</span><span class="o">?</span><span class="p">.</span><span class="nx">dateTime</span><span class="o">?</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">];</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">startDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">startDate</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// For multi-day events, add all dates in the range. Handle end date inclusivity.</span>
<span class="w">        </span><span class="c1">// GCal &#39;date&#39; type end date is exclusive, dateTime is inclusive. Adjust logic if needed.</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">endDate</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">startDate</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// If it&#39;s an all-day event (date type), the end date is exclusive.</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">endTarget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">start</span><span class="o">?</span><span class="p">.</span><span class="nx">date</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">end</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">end</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">end</span><span class="p">;</span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">current</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">endTarget</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">             </span><span class="nx">busyDatesSet</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">toISOString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Format YYYY-MM-DD</span>
<span class="w">             </span><span class="nx">current</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Process Notion Pages (IndisponibilitÃ©s Membres)</span>
<span class="nx">notionPages</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">item</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Adjust &#39;Date Indispo&#39; based on your actual Notion property name</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">dateProp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">properties</span><span class="p">[</span><span class="s1">&#39;Date Indispo&#39;</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">date</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dateProp</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">dateProp</span><span class="p">.</span><span class="nx">start</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Assuming simple date property, not range for now</span>
<span class="w">         </span><span class="nx">busyDatesSet</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">dateProp</span><span class="p">.</span><span class="nx">start</span><span class="p">);</span><span class="w"> </span><span class="c1">// Format YYYY-MM-DD</span>
<span class="w">         </span><span class="c1">// If it&#39;s a date range in Notion, add logic similar to GCal multi-day</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Return a single item with the unique busy dates array</span>
<span class="k">return</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">busyDates</span><span class="o">:</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="nx">busyDatesSet</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}];</span>
</pre></div>
</div>
</section>
<section id="modifier-le-noeud-suivant-ancien-filtrer-creneaux">
<h4>4. Modifier le NÅ“ud Suivant (ancien Filtrer crÃ©neaux)<a class="headerlink" href="#modifier-le-noeud-suivant-ancien-filtrer-creneaux" title="Link to this heading">ïƒ</a></h4>
<ul class="simple">
<li><p>Renommer en â€œCalculer Plages Libresâ€</p></li>
<li><p>Adapter le Code:</p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Assuming the input comes from &#39;Consolider IndisponibilitÃ©s&#39;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">inputItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">items</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">busyDates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">(</span><span class="nx">inputItem</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">busyDates</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">availableSlots</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">today</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">numberOfDaysToCheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">90</span><span class="p">;</span><span class="w"> </span><span class="c1">// Or however many days you want to project</span>

<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">numberOfDaysToCheck</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">today</span><span class="p">);</span>
<span class="w">    </span><span class="nx">currentDate</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">today</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i</span><span class="p">);</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">formattedDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currentDate</span><span class="p">.</span><span class="nx">toISOString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">];</span><span class="w"> </span><span class="c1">// YYYY-MM-DD</span>

<span class="w">    </span><span class="c1">// Check if the date is NOT in the busy set AND is a Friday or Saturday</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">dayOfWeek</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">currentDate</span><span class="p">.</span><span class="nx">getDay</span><span class="p">();</span><span class="w"> </span><span class="c1">// 0 = Sunday, 6 = Saturday</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">busyDates</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">formattedDate</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">dayOfWeek</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">dayOfWeek</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">6</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">availableSlots</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="w"> </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="nx">formattedDate</span><span class="p">,</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;available&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">availableSlots</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Handle the case where no slots are found, maybe return an empty array</span>
<span class="w">  </span><span class="c1">// or a specific message item? For now, returning empty array.</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[];</span>
<span class="p">}</span>

<span class="c1">// Return the list of available Friday/Saturday slots</span>
<span class="k">return</span><span class="w"> </span><span class="nx">availableSlots</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="nettoyage">
<h4>5. Nettoyage<a class="headerlink" href="#nettoyage" title="Link to this heading">ïƒ</a></h4>
<ul class="simple">
<li><p>Supprimer ou dÃ©connecter clairement (avec une note) les anciens nÅ“uds:</p>
<ul>
<li><p>Analyse et syncâ€¦</p></li>
<li><p>CrÃ©er page Notion</p></li>
<li><p>CrÃ©er event Google</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="phase-2-generation-envoi-des-emails-corrections-logique-ia">
<h2>Phase 2: GÃ©nÃ©ration &amp; Envoi des Emails (Corrections &amp; Logique IA)<a class="headerlink" href="#phase-2-generation-envoi-des-emails-corrections-logique-ia" title="Link to this heading">ïƒ</a></h2>
<section id="action-1-connecter-les-disponibilites-dynamiques-a-l-ia">
<h3>Action 1: Connecter les disponibilitÃ©s dynamiques Ã  lâ€™IA<a class="headerlink" href="#action-1-connecter-les-disponibilites-dynamiques-a-l-ia" title="Link to this heading">ïƒ</a></h3>
<section id="id2">
<h4>ProblÃ¨me<a class="headerlink" href="#id2" title="Link to this heading">ïƒ</a></h4>
<ul class="simple">
<li><p>Lâ€™IA utilisait des dates statiques.</p></li>
</ul>
</section>
<section id="solution">
<h4>Solution<a class="headerlink" href="#solution" title="Link to this heading">ïƒ</a></h4>
<ol class="simple">
<li><p>Supprimer les nÅ“uds statiques:</p>
<ul class="simple">
<li><p>Set - Dates GCal Potentielles</p></li>
<li><p>Set - Dates BloquÃ©es Membres</p></li>
</ul>
</li>
<li><p>Connecter la sortie de â€œCalculer Plages Libresâ€ Ã  lâ€™entrÃ©e du nÅ“ud qui prÃ©pare le prompt IA</p></li>
<li><p>Modifier le nÅ“ud â€œPrepare DeepSeek Requestâ€ (Code):</p>
<ul class="simple">
<li><p>Recevoir la liste des dates disponibles</p></li>
<li><p>Extraire les dates: <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">availableDates</span> <span class="pre">=</span> <span class="pre">items.map(item</span> <span class="pre">=&gt;</span> <span class="pre">item.json.date);</span></code></p></li>
<li><p>Construire le message pour lâ€™API OpenRouter en incluant ces dates</p></li>
</ul>
</li>
<li><p>NÅ“ud dâ€™appel IA (OpenRouter, HTTP Requestâ€¦):</p>
<ul class="simple">
<li><p>Configurer directement le Credential OpenRouter appropriÃ©</p></li>
<li><p>Configurer directement le ModÃ¨le IA souhaitÃ© (deepseek/deepseek-chat)</p></li>
</ul>
</li>
</ol>
</section>
</section>
<section id="action-2-reparer-la-logique-de-fusion-ia-contacts">
<h3>Action 2: RÃ©parer la logique de fusion IA + Contacts<a class="headerlink" href="#action-2-reparer-la-logique-de-fusion-ia-contacts" title="Link to this heading">ïƒ</a></h3>
<section id="id3">
<h4>ProblÃ¨me<a class="headerlink" href="#id3" title="Link to this heading">ïƒ</a></h4>
<ul class="simple">
<li><p>Le Merge en combineByPosition ne fonctionne pas bien.</p></li>
</ul>
</section>
<section id="id4">
<h4>Solution<a class="headerlink" href="#id4" title="Link to this heading">ïƒ</a></h4>
<ol class="simple">
<li><p>ExÃ©cuter le flux IA une seule fois en amont:</p>
<ul class="simple">
<li><p>Prepare DeepSeek Request â†’ Call DeepSeek AI â†’ Set Message GÃ©nÃ©rÃ© IA</p></li>
</ul>
</li>
<li><p>NÅ“ud Notion (Get Database Pages pour Contacts):</p>
<ul class="simple">
<li><p>Renommer si besoin (ex: Get Notion Contacts LOT1)</p></li>
<li><p>Configurer directement le Credential Notion appropriÃ©</p></li>
<li><p>Entrer directement lâ€™ID de la Base de DonnÃ©es: 1c4814â€¦ (LOT1)</p></li>
<li><p>Ajouter les filtres nÃ©cessaires (ex: Etat du mail != â€œPROSPECTğŸ“¨ EnvoyÃ©â€)</p></li>
</ul>
</li>
<li><p>Nouveau NÅ“ud Code (Associer Message IA aux Contacts):</p>
<ul class="simple">
<li><p>Connecter la sortie de Set Message GÃ©nÃ©rÃ© IA (1 item avec aiMessage) Ã  lâ€™input 0</p></li>
<li><p>Connecter la sortie de Get Notion Contacts LOT1 (N items) Ã  lâ€™input 1</p></li>
<li><p>Logique du Code:</p></li>
</ul>
</li>
</ol>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// Get the single AI message generated earlier</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">aiMessageItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$input</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="mf">0</span><span class="p">)[</span><span class="mf">0</span><span class="p">];</span><span class="w"> </span><span class="c1">// Assuming the AI message node is connected to input 0</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">aiMessageItem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Le message IA n&#39;a pas Ã©tÃ© reÃ§u sur l&#39;entrÃ©e 0.&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">aiMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">aiMessageItem</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">aiMessage</span><span class="p">;</span><span class="w"> </span><span class="c1">// Adjust &#39;.aiMessage&#39; if the property name is different</span>

<span class="c1">// Get all the contact items</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">contacts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$input</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Assuming contacts node is connected to input 1</span>

<span class="c1">// Return a new item for each contact, merging contact data and the AI message</span>
<span class="k">return</span><span class="w"> </span><span class="nx">contacts</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">contact</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Ensure we don&#39;t overwrite existing &#39;json&#39; properties if contact.json exists</span>
<span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">contactData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">json</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{};</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">...</span><span class="nx">contactData</span><span class="p">,</span><span class="w"> </span><span class="c1">// Spread existing contact data</span>
<span class="w">      </span><span class="c1">// Add Notion page ID for later update step</span>
<span class="w">      </span><span class="nx">notionPageId</span><span class="o">:</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="c1">// Assuming the Notion node output includes &#39;id&#39;</span>
<span class="w">      </span><span class="c1">// Add contact properties needed for personalization</span>
<span class="w">      </span><span class="nx">contactEmail</span><span class="o">:</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">properties</span><span class="p">[</span><span class="s1">&#39;E-mail&#39;</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span><span class="w"> </span><span class="c1">// Adjust property name &#39;E-mail&#39;</span>
<span class="w">      </span><span class="nx">contactName</span><span class="o">:</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">properties</span><span class="p">[</span><span class="s1">&#39;PrÃ©nom&#39;</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">title</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">plain_text</span><span class="p">,</span><span class="w"> </span><span class="c1">// Adjust &#39;PrÃ©nom&#39;</span>
<span class="w">      </span><span class="nx">venueName</span><span class="o">:</span><span class="w"> </span><span class="nx">contact</span><span class="p">.</span><span class="nx">json</span><span class="p">.</span><span class="nx">properties</span><span class="p">[</span><span class="s1">&#39;Structure&#39;</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">title</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">?</span><span class="p">.</span><span class="nx">plain_text</span><span class="p">,</span><span class="w"> </span><span class="c1">// Adjust &#39;Structure&#39;</span>
<span class="w">      </span><span class="c1">// Add the generic AI message</span>
<span class="w">      </span><span class="nx">aiMessage</span><span class="o">:</span><span class="w"> </span><span class="nx">aiMessage</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">});</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Adapter le NÅ“ud Personnalisation Message (Code):</p>
<ul class="simple">
<li><p>Recevoir des items contenant: notionPageId, contactEmail, contactName, venueName, aiMessage</p></li>
<li><p>Ajuster le code pour utiliser item.json.aiMessage comme base et injecter les champs de personnalisation</p></li>
<li><p>Retourner un item contenant lâ€™HTML final du message</p></li>
</ul>
</li>
</ol>
</section>
</section>
<section id="action-3-simplifier-et-corriger-la-sequence-d-envoi">
<h3>Action 3: Simplifier et corriger la sÃ©quence dâ€™envoi<a class="headerlink" href="#action-3-simplifier-et-corriger-la-sequence-d-envoi" title="Link to this heading">ïƒ</a></h3>
<section id="id5">
<h4>ProblÃ¨me<a class="headerlink" href="#id5" title="Link to this heading">ïƒ</a></h4>
<ul class="simple">
<li><p>NÅ“uds redondants ou mal placÃ©s.</p></li>
</ul>
</section>
<section id="id6">
<h4>Solution<a class="headerlink" href="#id6" title="Link to this heading">ïƒ</a></h4>
<ol class="simple">
<li><p>Flux Principal:</p>
<ul class="simple">
<li><p>Associer Message IA aux Contacts â†’ Personnalisation Message â†’ Get Gmail Template â†’ Inject Message into HTML â†’ Create Final Gmail Draft â†’ Update Notion Status â†’ Wait Anti-Spam</p></li>
</ul>
</li>
<li><p>NÅ“ud Get Gmail Template:</p>
<ul class="simple">
<li><p>Configurer directement le Credential Gmail appropriÃ©</p></li>
<li><p>Utiliser lâ€™opÃ©ration Get ou List avec un filtre sur le Sujet</p></li>
</ul>
</li>
<li><p>NÅ“ud Inject Message into HTML (Code, si besoin):</p>
<ul class="simple">
<li><p>Prendre lâ€™HTML du template (Input 0) et le contenu personnalisÃ© (Input 1)</p></li>
<li><p>Remplacer un placeholder dans lâ€™HTML du template</p></li>
<li><p>Retourner lâ€™HTML final avec les autres donnÃ©es nÃ©cessaires</p></li>
</ul>
</li>
<li><p>NÅ“ud dâ€™Action Gmail (Create Draft - RecommandÃ© pour test):</p>
<ul class="simple">
<li><p>Configurer directement le Credential Gmail appropriÃ©</p></li>
<li><p>OpÃ©ration: Create</p></li>
<li><p>Resource: Draft</p></li>
<li><p>To: <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">$json.contactEmail</span> <span class="pre">}}</span></code></p></li>
<li><p>Subject: Le sujet souhaitÃ©</p></li>
<li><p>Message Body Type: HTML</p></li>
<li><p>Message: <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">$json.finalHtml</span> <span class="pre">}}</span></code></p></li>
</ul>
</li>
<li><p>NÅ“ud Notion (Update Page):</p>
<ul class="simple">
<li><p>Renommer en Update Notion Status</p></li>
<li><p>Configurer directement le Credential Notion appropriÃ©</p></li>
<li><p>OpÃ©ration: Update</p></li>
<li><p>Resource: Database Page</p></li>
<li><p>Page ID: <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">$json.notionPageId</span> <span class="pre">}}</span></code></p></li>
<li><p>PropriÃ©tÃ©s: Ajouter la propriÃ©tÃ© Ã  mettre Ã  jour (ex: Etat du mail)</p></li>
</ul>
</li>
<li><p>NÅ“ud Wait:</p>
<ul class="simple">
<li><p>Renommer en Wait Anti-Spam</p></li>
<li><p>Configurer le dÃ©lai souhaitÃ© (ex: 30 secondes)</p></li>
<li><p>Connecter aprÃ¨s Update Notion Status</p></li>
</ul>
</li>
<li><p>Nettoyage:</p>
<ul class="simple">
<li><p>Supprimer les nÅ“uds:</p>
<ul>
<li><p>RÃ©dac draft</p></li>
<li><p>verif dÃ©lai entre les envois</p></li>
<li><p>Envoi du msg ssi dÃ©lai respectÃ© avec attente rÃ©ponse</p></li>
<li><p>Fin Phase 1</p></li>
</ul>
</li>
</ul>
</li>
</ol>
</section>
</section>
</section>
<section id="phase-3-et-suivantes-structuration-pour-l-avenir">
<h2>Phase 3 et Suivantes: Structuration pour lâ€™Avenir<a class="headerlink" href="#phase-3-et-suivantes-structuration-pour-l-avenir" title="Link to this heading">ïƒ</a></h2>
<section id="id7">
<h3>Action<a class="headerlink" href="#id7" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>DÃ©limiter visuellement les phases futures.</p></li>
</ul>
</section>
<section id="id8">
<h3>ProblÃ¨me<a class="headerlink" href="#id8" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>Les nÅ“uds des phases 3+ sont prÃ©sents mais dÃ©connectÃ©s et mÃ©langÃ©s.</p></li>
</ul>
</section>
<section id="id9">
<h3>Solution<a class="headerlink" href="#id9" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>Regrouper physiquement les nÅ“uds par phase future</p></li>
<li><p>Utiliser des grands Sticky Notes colorÃ©s pour encadrer chaque groupe</p></li>
<li><p>Placer le nÅ“ud dÃ©clencheur prÃ©vu pour chaque phase au dÃ©but du groupe (dÃ©sactivÃ© pour lâ€™instant)</p></li>
</ul>
</section>
</section>
<section id="ameliorations-potentiel-ia">
<h2>AmÃ©liorations &amp; Potentiel IA<a class="headerlink" href="#ameliorations-potentiel-ia" title="Link to this heading">ïƒ</a></h2>
<section id="points-d-amelioration-par-ia-plus-avancee">
<h3>Points dâ€™amÃ©lioration par IA plus avancÃ©e<a class="headerlink" href="#points-d-amelioration-par-ia-plus-avancee" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p><strong>Analyse des RÃ©ponses</strong> (Phase 4 Future): Candidat idÃ©al pour intÃ©gration DeepSeek dans un nÅ“ud Code</p></li>
<li><p><strong>GÃ©nÃ©ration de Remerciements</strong> (Phase 9 Future): IA pour email personnalisÃ©</p></li>
<li><p><strong>Interactions complexes</strong>: Pour les phases nÃ©cessitant des dÃ©cisions sophistiquÃ©es</p></li>
</ul>
</section>
<section id="recommandation">
<h3>Recommandation<a class="headerlink" href="#recommandation" title="Link to this heading">ïƒ</a></h3>
<ul class="simple">
<li><p>ImplÃ©menter dâ€™abord le flux de base corrigÃ©</p></li>
<li><p>Attaquer ensuite lâ€™analyse des rÃ©ponses (Phase 4)</p></li>
</ul>
</section>
</section>
<section id="prochaines-etapes-immediates">
<h2>Prochaines Ã‰tapes ImmÃ©diates<a class="headerlink" href="#prochaines-etapes-immediates" title="Link to this heading">ïƒ</a></h2>
<ol class="simple">
<li><p>Appliquer les corrections des Phases 1 et 2 (DisponibilitÃ©s, GÃ©nÃ©ration/Envoi Email)</p></li>
<li><p>Tester soigneusement ce flux corrigÃ© de prospection:</p>
<ul class="simple">
<li><p>VÃ©rifier que les nÅ“uds GCal et Notion rÃ©cupÃ¨rent les bonnes donnÃ©es</p></li>
<li><p>VÃ©rifier que les bonnes disponibilitÃ©s sont calculÃ©es et utilisÃ©es dans le prompt IA</p></li>
<li><p>VÃ©rifier que le nÅ“ud IA utilise le bon modÃ¨le/credential et gÃ©nÃ¨re un message</p></li>
<li><p>VÃ©rifier que le message IA est correctement associÃ© Ã  chaque contact</p></li>
<li><p>VÃ©rifier que les brouillons Gmail sont crÃ©Ã©s correctement pour chaque contact</p></li>
<li><p>VÃ©rifier que le statut Notion est mis Ã  jour pour chaque contact</p></li>
<li><p>VÃ©rifier que le dÃ©lai Wait fonctionne entre les traitements</p></li>
</ul>
</li>
<li><p>Une fois la prospection stable, commencer Ã  connecter et implÃ©menter la Phase 3 (Suivi des RÃ©ponses)</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, EMAIL_SENDER_1 Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>