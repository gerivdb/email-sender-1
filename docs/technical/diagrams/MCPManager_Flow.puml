@startuml MCPManager Flow

skinparam backgroundColor white
skinparam handwritten false
skinparam monochrome false
skinparam shadowing false
skinparam defaultFontName Arial
skinparam defaultFontSize 12
skinparam roundCorner 8
skinparam dpi 300
skinparam arrowColor #2C3E50
skinparam activityBackgroundColor #3498DB
skinparam activityBorderColor #2C3E50
skinparam activityDiamondBackgroundColor #E74C3C
skinparam activityDiamondBorderColor #C0392B
skinparam noteBackgroundColor #FEF9E7
skinparam noteBorderColor #F39C12

title "Flux de gestion des serveurs MCP"

start

:Installer les dépendances;
note right: Install-MCPDependencies

:Rechercher les serveurs MCP existants;
note right: Find-MCPServers

if (Serveurs MCP trouvés?) then (oui)
  :Afficher la liste des serveurs;
else (non)
  :Créer une nouvelle configuration;
  note right: New-MCPConfiguration
endif

:Choisir une action;

split
  :Démarrer le gestionnaire MCP;
  note right: Start-MCPManager
  
  if (Mode agent?) then (oui)
    :Exécuter l'agent MCP;
    note right: mcp_agent.py
  else (non)
    :Exécuter le gestionnaire MCP;
    note right: mcp_manager.py
  endif
split again
  :Démarrer un serveur MCP spécifique;
  note right: Start-MCPServer
  
  if (Type de serveur?) then (local)
    :Démarrer un serveur MCP local;
  elseif (Type de serveur?) then (n8n)
    :Démarrer un serveur n8n;
  elseif (Type de serveur?) then (notion)
    :Démarrer un serveur Notion;
  elseif (Type de serveur?) then (gateway)
    :Démarrer un serveur Gateway;
  else (git-ingest)
    :Démarrer un serveur Git Ingest;
  endif
  
  :Initialiser la connexion avec le client MCP;
split again
  :Exécuter une commande MCP;
  note right: Invoke-MCPCommand
  
  if (Type de MCP?) then (standard)
    :Exécuter le MCP Standard;
  elseif (Type de MCP?) then (notion)
    :Exécuter le MCP Notion;
  elseif (Type de MCP?) then (gateway)
    :Exécuter le MCP Gateway;
  else (git-ingest)
    :Exécuter le MCP Git Ingest;
  endif
split again
  :Arrêter un serveur MCP;
  note right: Stop-MCPServer
  
  if (Type de serveur?) then (local)
    :Arrêter un serveur MCP local;
  elseif (Type de serveur?) then (n8n)
    :Arrêter un serveur n8n;
  elseif (Type de serveur?) then (notion)
    :Arrêter un serveur Notion;
  elseif (Type de serveur?) then (gateway)
    :Arrêter un serveur Gateway;
  else (git-ingest)
    :Arrêter un serveur Git Ingest;
  endif
end split

:Journaliser les actions;
note right: Write-MCPLog

stop

@enduml
